<?php
error_reporting ( E_ALL );
include 'PublicdetailController.php';
include ("library/PHPExcel/PHPEXCHelper.php");
include 'HelpFuncExportExcel.php';
/**
 * PHPExcel
 */
require_once 'library/PHPExcel/PHPExcel.php';
// include 'library/PHPExcel/PHPExcel/Reader/excel_reader2.php';
/**
 * PHPExcel_IOFactory
 */

// require_once 'Classes/PHPExcel/IOFactory.php';
require_once 'library/PHPExcel/PHPExcel/IOFactory.php';
require_once 'library/Zend/Session/Namespace.php';
require_once 'library/Zend/Session.php';
error_reporting ( E_ALL ^ E_NOTICE );

/**
 * Phadh
 * View bao cao
 */
class PrintviewController extends PublicdetailController {
	private $_MNhansu;
	private $_Namhoatdong;
	private $_ThongtincoquanId;
	private $_MNhanluc;
	private $_MHokhau;
	private $_MNhankhau;
	private $_MGiaykhaisinh;
	private $_MGiaykhaitu;
	private $_MTachkhau;
	private $_MVanglai;
	private $_MNhapthuoc;
	private $_MNhapthietbi;
	private $_MPhanbo;
	private $_MTieuhuy;
	private $_MKhambenh;
	private $_MCTXetnghiem;
	private $_MSieuam;
	private $_MCTSieuam;
	private $_MCapphatthuoc;
	private $_MSotret;
	private $_MHiv;
	private $_MTamthan;
	private $_MKhamthai;
	private $_MPhathai;
	private $_MSinhsan;
	private $_MKHHGD;
	private $_MUonvan;
	private $_MMiendich;
	private $_MMorong;
	private $_MChuyenvien;
	private $_MGiaychuyenvien;
	private $_MDaotaonhansu;
	private $_MDutruthuocbaohiem;
	private $_MTailieu;
	private $_MGiamsat;
	private $_MTruyenthong;
	private $_MChantaymieng;
	public function init() {
		$this->initValue ();
		$this->_MNhansu = new Model_Nhansu ();
		$this->_MNhanluc = new Model_Nhanlucthuocdiabanxa ();
		$this->_MHokhau = new Model_Hokhau ();
		$this->_MNhankhau = new Model_Nhankhau ();
		$this->_MGiaykhaisinh = new Model_Giaykhaisinh ();
		$this->_MGiaykhaitu = new Model_Giaykhaitu ();
		$this->_MTachkhau = new Model_Tachkhau ();
		$this->_MVanglai = new Model_Nhankhauvanglai ();
		$this->_MNhapthuoc = new Model_Nhapkho ();
		$this->_MNhapthietbi = new Model_Nhapthietbi ();
		$this->_MPhanbo = new Model_Phanbothuocvattu ();
		$this->_MTieuhuy = new Model_Tieuhuy ();
		$this->_MKhambenh = new Model_Khambenh ();
		$this->_MCTXetnghiem = new Model_CTXetnghiem ();
		$this->_MSieuam = new Model_Sieuam ();
		$this->_MCTSieuam = new Model_CTSieuam ();
		$this->_MCapphatthuoc = new Model_Capphatthuoc ();
		$this->_MSotret = new Model_Sotret ();
		$this->_MHiv = new Model_Hiv ();
		$this->_MTamthan = new Model_Tamthan ();
		$this->_MKhamthai = new Model_Khamthai ();
		$this->_MPhathai = new Model_Phathai ();
		$this->_MSinhsan = new Model_Sinhsan ();
		$this->_MKHHGD = new Model_Kehoachhoagiadinh ();
		$this->_MUonvan = new Model_Uonvan ();
		$this->_MMiendich = new Model_Tiemchungmiendich ();
		$this->_MMorong = new Model_Tiemchungmorong ();
		$this->_MChuyenvien = new Model_Chuyenvien ();
		$this->_MGiaychuyenvien = new Model_Giaychuyenvien ();
		$this->_MDaotaonhansu = new Model_Daotaonhansu();
		$this->_MDutruthuocbaohiem = new Model_Dutruthuocbaohiem();
		$this->_MTailieu = new Model_Tailieuchuyenmon();
		$this->_MGiamsat = new Model_Giamsatvsattp();
		$this->_MTruyenthong = new Model_Truyenthonggdsk();
		$this->_MChantaymieng = new Model_Chantaymieng();
		$this->_Namhoatdong = $this->TblThongtincoquanbyId [0] ['Namhoatdong'];
		$this->_ThongtincoquanId = $this->TblThongtincoquanbyId [0] ['Id'];
	}
	
	/**
	 * Phadh
	 * Tao file view bao cao
	 * Danh sach nhan su thuoc dia ban
	 */
	public function printviewdsnhansuAction() {
		$this->_helper->layout ()->disableLayout ();
		$helpExport = new HelpFuncExportExcel ();
		$objReader = PHPExcel_IOFactory::createReader ( "Excel5" );
		$hoten = $this->_getParam ( 'sHoten' );
		$chucvu = $this->_getParam ( 'sChucvu' );
		$gioitinh = $this->_getParam ( 'sGioitinh' );
		$diachi = $this->_getParam ( 'sDiachi' );
		$bophan = $this->_getParam ( 'sBophan' );
		$colIndex = '';
		$rowIndex = 0;
		
		$objPHPExcel = new PHPExcel ();
		$sheet = $objPHPExcel->getActiveSheet ();
		/*
		 * Bắt đầu set các giá trị, căn chỉnh style Bắt đầu set các giá trị
		 * tĩnh.
		 */
		$sheet->setCellValue ( 'A1', $this->TblThongtincoquanbyId [0] ['Tencoquan'] );
		$sheet->mergeCellsByColumnAndRow ( 0, 1, 3, 1 );
		$helpExport->setStyle_13_TNR_B_L ( $sheet, 'A1', 'C1' );
		$sheet->setCellValue ( 'A3', 'DANH SÁCH NHÂN LỰC THUỘC TRẠM' );
		$sheet->mergeCellsByColumnAndRow ( 0, 3, 6, 3 );
		$helpExport->setStyleTitleDoc ( $sheet, 'A3', 'G3' );
		
		$rowStart = 6;
		$colStart = 'A';
		$rowIndex = $rowStart;
		$colIndex = $colStart;
		$sheet = $objPHPExcel->getActiveSheet ();
		// BEGIN set width for column
		$sheet->getColumnDimension ( 'A' )->setWidth ( 5 );
		$sheet->getColumnDimension ( 'B' )->setWidth ( 20 );
		$sheet->getColumnDimension ( 'C' )->setWidth ( 10 );
		$sheet->getColumnDimension ( 'D' )->setWidth ( 15 );
		$sheet->getColumnDimension ( 'E' )->setWidth ( 15 );
		$sheet->getColumnDimension ( 'F' )->setWidth ( 10 );
		$sheet->getColumnDimension ( 'G' )->setWidth ( 20 );
		// END set width for column
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'STT', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Họ và tên', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Giới tính', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Ngày sinh', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Số CMND', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Chức vụ', $colIndex );
		;
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Địa chỉ', $colIndex );
		$helpExport->setStyle_13_TNR_B_C ( $sheet, $colStart . $rowIndex, $colIndex . ($rowIndex + 1) );
		// $helpExport->setStyleTitleTable ( $sheet, $colStart . $rowIndex,
		// $colIndex . ($rowIndex + 1) );
		// Lấy dữ liệu
		$jsonObj = $this->_MNhansu->getdanhsach ( $hoten, $chucvu, $gioitinh, $diachi, $bophan, $this->_ThongtincoquanId, $this->_Namhoatdong );
		$tong = $tong = count ( $jsonObj );
		$data_ds = array ();
		$rowCount = count ( $jsonObj );
		if (count ( $jsonObj ) > 0) {
			for($i = 0; $i < $rowCount; $i ++) {
				$data_ds [$i] = array (
						($i + 1),
						$jsonObj [$i] ['Hoten'],
						$jsonObj [$i] ['Gioitinh'],
						$jsonObj [$i] ['Ngaysinh'],
						$jsonObj [$i] ['Cmnd'],
						$jsonObj [$i] ['Tenchucvu'],
						$jsonObj [$i] ['Diachi'],
						$jsonObj [$i] ['Tenbophan'] 
				);
			}
			$helpExport->setStyle_13_TNR_B_C ( $sheet, $colStart . $rowIndex, $colIndex . ($rowIndex + 1) );
		}
		$rowIndex = $this->initRow ( $sheet, $helpExport, $data_ds, $rowIndex, 7 );
		$sheet->getStyle ( 'A' . $rowStart . ':' . 'G' . $rowIndex )->getBorders ()->getOutline ()->setBorderStyle ( PHPExcel_Style_Border::BORDER_THIN );
		$sheet->getStyle ( 'A' . $rowStart . ':' . 'G' . $rowIndex )->getBorders ()->getInside ()->setBorderStyle ( PHPExcel_Style_Border::BORDER_THIN );
		$rowIndex += 2;
		$sheet->setCellValue ( 'G' . $rowIndex, 'Tổng số nhân lực trong trạm: ' . $tong );
		$helpExport->setStyle_12_TNR_B_L ( $sheet, 'G' . ($rowIndex - 1), 'G' . $rowIndex );
		$objPHPExcel->getActiveSheet ()->setTitle ( 'Page 1' );
		$f = 'example.html';
		$objWriter = PHPExcel_IOFactory::createWriter ( $objPHPExcel, 'HTML' );
		$objWriter->save ( 'public/media/temp/' . $f );
		echo file_get_contents ( 'public/media/temp/' . $f );
	}
	public function initRow($_sheet, $_helpExport, $_data, $_rowIndex, $_numCol) {
		$helpExport = $_helpExport;
		$sheet = $_sheet;
		$rowIndex = $_rowIndex;
		$data = $_data;
		$numCol = $_numCol;
		$bp_center = '0';
		
		foreach ( $data as $item ) {
			if (($item [7]) != $bp_center) {
				$rowIndex += 1;
				$helpExport->setValueForSheet ( $sheet, 'A' . $rowIndex, $item [7], 'A' );
				$sheet->mergeCellsByColumnAndRow ( 0, $rowIndex, 6, $rowIndex );
				$helpExport->setStyle_13_TNR_B_L ( $sheet, 'A' . $rowIndex, 'G' . $rowIndex );
				$bp_center = ($item [7]);
				/*
				 * if ($rowFormatEnd != $_rowIndex) {
				 * $helpExport->setStyleRowDataTable ( $sheet, 'A' .
				 * $rowFormatStart, 'M' . $rowFormatEnd ); } $rowFormatStart =
				 * $rowIndex + 1; $rowFormatEnd = $rowIndex - 1;
				 */
			}
			$rowIndex += 1;
			$colIndex = 'A';
			for($i = 0; $i < $numCol; $i ++) {
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, (isset ( $item [$i] ) ? $item [$i] : ""), $colIndex );
			}
			$helpExport->setStyleRowDataTable ( $sheet, 'A' . $rowIndex, 'M' . $rowIndex );
		}
		return $rowIndex;
	}
	
	/**
	 * Phadh
	 * Tao file xem truoc bao cao
	 * Ho so nhan su thuoc dia ban
	 */
	public function printviewhosonhansuAction() {
		$this->_helper->layout ()->disableLayout ();
		$helpExport = new HelpFuncExportExcel ();
		$id = $this->_getParam ( 'idnhansu' );
		$objReader = PHPExcel_IOFactory::createReader ( "Excel5" );
		$jsonObj = null;
		$colIndex = '0';
		$rowIndex = '';
		
		if (isset ( $id ) && $id != '') {
			$jsonObj = $this->_MNhansu->getHoso ( $this->_ThongtincoquanId, $this->_Namhoatdong, $id );
			$objPHPExcel = $objReader->load ( "public/media/temp/Chitietdoituong.xls" );
			$sheet = $objPHPExcel->getActiveSheet ();
			$rowIndex = '3';
			$colIndex = 'D';
			foreach ( $jsonObj as $row ) {
				$sheet->setCellValue ( $colIndex . "3", $row ['Hoten'] );
				$sheet->setCellValue ( $colIndex . "4", $row ['Ngaysinh'] );
				$sheet->setCellValue ( "G" . "4", $row ['Gioitinh'] );
				$sheet->setCellValue ( $colIndex . "5", $row ['Cmnd'] );
				$sheet->setCellValue ( "G" . "5", $row ['Ngaycap'] );
				$sheet->setCellValue ( $colIndex . "6", $row ['Noicap'] );
				$sheet->setCellValue ( $colIndex . "7", $row ['Diachi'] );
				$sheet->setCellValue ( $colIndex . "8", $row ['Dienthoai'] );
				$sheet->setCellValue ( $colIndex . "9", $row ['Email'] );
				$sheet->setCellValue ( $colIndex . "10", $row ['Bophan'] );
				$sheet->setCellValue ( "G" . "10", $row ['Chucvu'] );
			}
		}
		
		$f = 'example.html';
		$objWriter = PHPExcel_IOFactory::createWriter ( $objPHPExcel, 'HTML' );
		$objWriter->save ( 'public/media/temp/' . $f );
		echo file_get_contents ( 'public/media/temp/' . $f );
	}
	
	/**
	 * Phadh
	 * Tao file xem truoc bao cao
	 * Danh sach nhan luc thuoc dia ban
	 */
	public function printviewdsnhanlucAction() {
		$this->_helper->layout ()->disableLayout ();
		$helpExport = new HelpFuncExportExcel ();
		$objReader = PHPExcel_IOFactory::createReader ( "Excel5" );
		$hoten = $this->_getParam ( 'sHoten' );
		$chucvu = $this->_getParam ( 'sChucvu' );
		$gioitinh = $this->_getParam ( 'sGioitinh' );
		$diachi = $this->_getParam ( 'sDiachi' );
		$colIndex = '';
		$rowIndex = 0;
		
		$objPHPExcel = new PHPExcel ();
		$sheet = $objPHPExcel->getActiveSheet ();
		/*
		 * Bắt đầu set các giá trị, căn chỉnh style Bắt đầu set các giá trị
		 * tĩnh.
		 */
		$sheet->setCellValue ( 'A1', $this->TblThongtincoquanbyId [0] ['Tencoquan'] );
		$sheet->mergeCellsByColumnAndRow ( 0, 1, 3, 1 );
		$helpExport->setStyle_13_TNR_B_L ( $sheet, 'A1', 'C1' );
		$sheet->setCellValue ( 'A3', 'DANH SÁCH NHÂN VIÊN Y TẾ KHÔNG THUỘC TRẠM Y TẾ' );
		$sheet->mergeCellsByColumnAndRow ( 0, 3, 7, 3 );
		$helpExport->setStyleTitleDoc ( $sheet, 'A3', 'G3' );
		
		$rowStart = 6;
		$colStart = 'A';
		$rowIndex = $rowStart;
		$colIndex = $colStart;
		$sheet = $objPHPExcel->getActiveSheet ();
		// BEGIN set width for column
		$sheet->getColumnDimension ( 'A' )->setWidth ( 5 );
		$sheet->getColumnDimension ( 'B' )->setWidth ( 20 );
		$sheet->getColumnDimension ( 'C' )->setWidth ( 15 );
		$sheet->getColumnDimension ( 'D' )->setWidth ( 15 );
		$sheet->getColumnDimension ( 'E' )->setWidth ( 15 );
		$sheet->getColumnDimension ( 'F' )->setWidth ( 15 );
		$sheet->getColumnDimension ( 'G' )->setWidth ( 25 );
		// END set width for column
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'STT', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Họ và tên', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Giới tính', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Ngày sinh', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Số CMND', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Ngày cấp', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Địa chỉ', $colIndex );
		$helpExport->setStyle_13_TNR_B_C ( $sheet, $colStart . $rowIndex, $colIndex . ($rowIndex + 1) );
		// $helpExport->setStyleTitleTable ( $sheet, $colStart . $rowIndex,
		// $colIndex . ($rowIndex + 1) );
		$rowIndex += 1;
		$colIndex = $colStart;
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, '1', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, '2', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, '3', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, '4', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, '5', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, '6', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, '7', $colIndex );
		
		$helpExport->setStyle_10_TNR_I_C ( $sheet, $colStart . $rowIndex, $colIndex . $rowIndex );
		// Lấy dữ liệu
		$jsonObj = $this->_MNhanluc->getdanhsach ( $hoten, $chucvu, $gioitinh, $diachi, $this->_ThongtincoquanId, $this->_Namhoatdong );
		$tong = $this->_MNhanluc->tong ( $hoten, $chucvu, $gioitinh, $diachi, $this->_ThongtincoquanId, $this->_Namhoatdong );
		if (count ( $jsonObj ) > 0) {
			$stt = 0;
			foreach ( $jsonObj as $row ) {
				$stt ++;
				$rowIndex ++;
				$colIndex = $colStart;
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $stt, $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Hoten'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Gioitinh'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Ngaysinh'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Cmnd'], $colIndex );
				if ($row ['Ngaycap'] != '00/00/0000') {
					$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Ngaycap'], $colIndex );
				} else {
					$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, '', $colIndex );
				}
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Diachi'], $colIndex );
				$helpExport->setStyle_13_TNR_N_L ( $sheet, $colStart . $rowIndex, $colIndex . $rowIndex );
			}
		}
		$sheet->getStyle ( 'A' . $rowStart . ':' . 'G' . $rowIndex )->getBorders ()->getOutline ()->setBorderStyle ( PHPExcel_Style_Border::BORDER_THIN );
		$sheet->getStyle ( 'A' . $rowStart . ':' . 'G' . $rowIndex )->getBorders ()->getInside ()->setBorderStyle ( PHPExcel_Style_Border::BORDER_THIN );
		$objPHPExcel->getActiveSheet ()->setTitle ( 'Page 1' );
		$rowIndex += 2;
		$sheet->setCellValue ( 'G' . $rowIndex, 'Tổng số nhân lực thuộc địa bàn: ' . $tong [0] ['Total'] );
		$helpExport->setStyle_12_TNR_B_L ( $sheet, 'G' . ($rowIndex - 1), 'G' . $rowIndex );
		$f = 'example.html';
		$objWriter = PHPExcel_IOFactory::createWriter ( $objPHPExcel, 'HTML' );
		$objWriter->save ( 'public/media/temp/' . $f );
		echo file_get_contents ( 'public/media/temp/' . $f );
	}
	
	/**
	 * Phadh
	 * Tao file xem truoc bao cao
	 * Ho so nhan luc khai bao
	 */
	public function printviewhosonhanlucAction() {
		$this->_helper->layout ()->disableLayout ();
		$helpExport = new HelpFuncExportExcel ();
		$id = $this->_getParam ( 'idnhansu' );
		$objReader = PHPExcel_IOFactory::createReader ( "Excel5" );
		$jsonObj = null;
		$colIndex = '0';
		$rowIndex = '';
		
		if (isset ( $id ) && $id != '') {
			$jsonObj = $this->_MNhanluc->getHoso ( $this->_ThongtincoquanId, $this->_Namhoatdong, $id );
			$objPHPExcel = $objReader->load ( "public/media/temp/Nhanlucthuocdiaban.xls" );
			$sheet = $objPHPExcel->getActiveSheet ();
			$rowIndex = '3';
			$colIndex = 'D';
			foreach ( $jsonObj as $row ) {
				// echo '<img style="width: 100px; height: 120px; border:
				// 1px solid #CCC;" src="data:image/jpeg;base64,' .
				// base64_encode( $row['Chandung'] ) . '" />';
				$sheet->setCellValue ( "A" . "3", $row ['Chandung'] );
				$sheet->setCellValue ( $colIndex . "3", $row ['Hoten'] );
				$sheet->setCellValue ( $colIndex . "4", $row ['Ngaysinh'] );
				$sheet->setCellValue ( "G" . "4", $row ['Gioitinh'] );
				$sheet->setCellValue ( $colIndex . "5", $row ['Cmnd'] );
				$sheet->setCellValue ( "G" . "5", $row ['Ngaycap'] );
				$sheet->setCellValue ( $colIndex . "6", $row ['Noicap'] );
				$sheet->setCellValue ( $colIndex . "7", $row ['Diachi'] );
				$sheet->setCellValue ( $colIndex . "8", $row ['Dienthoai'] );
				$sheet->setCellValue ( $colIndex . "9", $row ['Email'] );
				$sheet->setCellValue ( $colIndex . "10", $row ['Chucvu'] );
			}
		}
		$f = 'example.html';
		$objWriter = PHPExcel_IOFactory::createWriter ( $objPHPExcel, 'HTML' );
		$objWriter->save ( 'public/media/temp/' . $f );
		echo file_get_contents ( 'public/media/temp/' . $f );
	}
	
	/**
	 * Phadh
	 * Tao file xem truoc bao cao
	 * Danh sach ho khau
	 */
	
	/**
	 * Phadh
	 * Tao file xem truoc bao cao
	 * Danh sach nhan khau trong ho khau
	 */
	
	
	/**
	 * Phadh
	 * Tao file xem truoc bao cao
	 * Danh sach nhan khau
	 */
	
	public function printviewdsnhankhauAction() {
		$this->_helper->layout ()->disableLayout ();
		$helpExport = new HelpFuncExportExcel ();
		$objReader = PHPExcel_IOFactory::createReader ( "Excel5" );
		$jsonObj = null;
		$data = array ();
		$data ['sMank'] = $this->_getParam ( 'sMank' );
		$data ['sMahd'] = $this->_getParam ( 'sMahd' );
		$data ['sMabn'] = $this->_getParam ( 'sMabn' );
		$data ['sHoten'] = $this->_getParam ( 'sHoten' );
		$ngaysinh = $this->_getParam ( 'sNgaysinh' );
		$data ['sNgaysinh'] = (isset ( $ngaysinh ) && $ngaysinh != '') ? $this->convertDateSearch ( $ngaysinh ) : '';
		$data ['sGioitinh'] = $this->_getParam ( 'sGioitinh' );
		$data ['sCMND'] = $this->_getParam ( 'sCMND' );
		$data ['sDantoc'] = $this->_getParam ( 'sDantoc' );
		$data ['sThonto'] = $this->_getParam ( 'sThonto' );
		$data ['sDiachi'] = $this->_getParam ( 'sDiachi' );
		$colIndex = '';
		$rowIndex = 0;
	
		$objPHPExcel = new PHPExcel ();
		$sheet = $objPHPExcel->getActiveSheet ();
		/*
		 * Bắt đầu set các giá trị, căn chỉnh style Bắt đầu set các giá trị
		* tĩnh.
		*/
		// End Chứng từ
		$sheet->setCellValue ( 'A1', $this->TblThongtincoquanbyId [0] ['Tencoquan'] );
		$sheet->mergeCellsByColumnAndRow ( 0, 1, 3, 1 );
		$helpExport->setStyle_13_TNR_B_L ( $sheet, 'A1', 'C1' );
		$sheet->setCellValue ( 'A3', 'DANH SÁCH NHÂN KHẨU' );
		$sheet->mergeCellsByColumnAndRow ( 0, 3, 7, 3 );
		$helpExport->setStyleTitleDoc ( $sheet, 'A3', 'H3' );
		$sheet->setCellValue ( 'A4', date ( "d/m/Y" ) );
		$sheet->mergeCellsByColumnAndRow ( 0, 4, 7, 4 );
		$helpExport->setStyleDateDoc ( $sheet, 'A4', 'H4' );
		$rowStart = 7;
		$colStart = 'A';
		$rowIndex = $rowStart;
		$colIndex = $colStart;
		$sheet = $objPHPExcel->getActiveSheet ();
		$sheet->getColumnDimension ( 'A' )->setWidth ( 5 );
		$sheet->getColumnDimension ( 'B' )->setWidth ( 10 );
		$sheet->getColumnDimension ( 'C' )->setWidth ( 20 );
		$sheet->getColumnDimension ( 'D' )->setWidth ( 12 );
		$sheet->getColumnDimension ( 'E' )->setWidth ( 12 );
		$sheet->getColumnDimension ( 'F' )->setWidth ( 7 );
		$sheet->getColumnDimension ( 'G' )->setWidth ( 15 );
		$sheet->getColumnDimension ( 'H' )->setWidth ( 20 );
		// END set width for column
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'STT', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Mã nhân khẩu', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Họ tên', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Mã hộ dân', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Mã bệnh nhân', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Giới tính', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Ngày sinh', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Thôn tổ', $colIndex );
		$helpExport->setStyle_11_TNR_B_C ( $sheet, $colStart . $rowIndex, $colIndex . $rowIndex );
		$rowIndex += 1;
		$colIndex = $colStart;
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, '1', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, '2', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, '3', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, '4', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, '5', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, '6', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, '7', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, '8', $colIndex );
		$helpExport->setStyle_10_TNR_I_C ( $sheet, $colStart . $rowIndex, $colIndex . $rowIndex );
		$sheet->getStyle ( 'A' . $rowStart . ':' . 'H' . $rowIndex )->getBorders ()->getOutline ()->setBorderStyle ( PHPExcel_Style_Border::BORDER_THIN );
		$sheet->getStyle ( 'A' . $rowStart . ':' . 'H' . $rowIndex )->getBorders ()->getInside ()->setBorderStyle ( PHPExcel_Style_Border::BORDER_THIN );
		$jsonObj = $this->_MNhankhau->getdanhsach ( $data, $this->_ThongtincoquanId, $this->_Namhoatdong );
		$stt = 0;
		foreach ( $jsonObj as $row ) {
			$rowIndex += 1;
			$stt ++;
			$colIndex = $colStart;
			$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $stt, $colIndex );
			$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Manhankhau'], $colIndex );
			$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Hoten'], $colIndex );
			$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Mahodan'], $colIndex );
			$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Mabenhnhan'], $colIndex );
			$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Gioitinh'], $colIndex );
			$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Ngaysinh'], $colIndex );
			$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Thonto'], $colIndex );
			$helpExport->setStyle_11_TNR ( $sheet, $colStart . $rowIndex, $colIndex . $rowIndex );
		}
		// Lư Index để format.
		$sheet->getStyle ( 'A' . $rowStart . ':' . 'H' . $rowIndex )->getBorders ()->getOutline ()->setBorderStyle ( PHPExcel_Style_Border::BORDER_THIN );
		$sheet->getStyle ( 'A' . $rowStart . ':' . 'H' . $rowIndex )->getBorders ()->getInside ()->setBorderStyle ( PHPExcel_Style_Border::BORDER_THIN );
	
		$f = 'example.html';
		$objWriter = PHPExcel_IOFactory::createWriter ( $objPHPExcel, 'HTML' );
		$objWriter->save ( 'public/media/temp/' . $f );
		echo file_get_contents ( 'public/media/temp/' . $f );
	}
	
	
	public function initprintviewAction() {
		$this->_helper->layout ()->disableLayout ();
		$helpExport = new HelpFuncExportExcel ();
		$objReader = PHPExcel_IOFactory::createReader ( "Excel5" );
		$jsonObj = null;
		$colIndex = '';
		$rowIndex = 0;
		
		$objPHPExcel = new PHPExcel ();
		$sheet = $objPHPExcel->getActiveSheet ();
		/*
		 * Bắt đầu set các giá trị, căn chỉnh style Bắt đầu set các giá trị
		 * tĩnh.
		 */
		// End Chứng từ
		$sheet->setCellValue ( 'A1', $this->TblThongtincoquanbyId [0] ['Tencoquan'] );
		$sheet->mergeCellsByColumnAndRow ( 0, 1, 3, 1 );
		$helpExport->setStyle_13_TNR_B_L ( $sheet, 'A1', 'C1' );
		$sheet->setCellValue ( 'A3', 'DANH SÁCH NHÂN KHẨU' );
		$sheet->mergeCellsByColumnAndRow ( 0, 3, 7, 3 );
		$helpExport->setStyleTitleDoc ( $sheet, 'A3', 'H3' );
		$sheet->setCellValue ( 'A4', date ( "d/m/Y" ) );
		$sheet->mergeCellsByColumnAndRow ( 0, 4, 7, 4 );
		$helpExport->setStyleDateDoc ( $sheet, 'A4', 'H4' );
		$rowStart = 7;
		$colStart = 'A';
		$rowIndex = $rowStart;
		$colIndex = $colStart;
		$sheet = $objPHPExcel->getActiveSheet ();
		$sheet->getColumnDimension ( 'A' )->setWidth ( 5 );
		$sheet->getColumnDimension ( 'B' )->setWidth ( 10 );
		$sheet->getColumnDimension ( 'C' )->setWidth ( 20 );
		$sheet->getColumnDimension ( 'D' )->setWidth ( 12 );
		$sheet->getColumnDimension ( 'E' )->setWidth ( 12 );
		$sheet->getColumnDimension ( 'F' )->setWidth ( 7 );
		$sheet->getColumnDimension ( 'G' )->setWidth ( 15 );
		$sheet->getColumnDimension ( 'H' )->setWidth ( 20 );
		// END set width for column
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'STT', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Mã nhân khẩu', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Họ tên', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Mã hộ dân', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Mã bệnh nhân', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Giới tính', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Ngày sinh', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Thôn tổ', $colIndex );
		$helpExport->setStyle_11_TNR_B_C ( $sheet, $colStart . $rowIndex, $colIndex . $rowIndex );
		$rowIndex += 1;
		$colIndex = $colStart;
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, '1', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, '2', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, '3', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, '4', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, '5', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, '6', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, '7', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, '8', $colIndex );
		$helpExport->setStyle_10_TNR_I_C ( $sheet, $colStart . $rowIndex, $colIndex . $rowIndex );
		$sheet->getStyle ( 'A' . $rowStart . ':' . 'H' . $rowIndex )->getBorders ()->getOutline ()->setBorderStyle ( PHPExcel_Style_Border::BORDER_THIN );
		$sheet->getStyle ( 'A' . $rowStart . ':' . 'H' . $rowIndex )->getBorders ()->getInside ()->setBorderStyle ( PHPExcel_Style_Border::BORDER_THIN );
		
		// Lư Index để format.
		$sheet->getStyle ( 'A' . $rowStart . ':' . 'H' . $rowIndex )->getBorders ()->getOutline ()->setBorderStyle ( PHPExcel_Style_Border::BORDER_THIN );
		$sheet->getStyle ( 'A' . $rowStart . ':' . 'H' . $rowIndex )->getBorders ()->getInside ()->setBorderStyle ( PHPExcel_Style_Border::BORDER_THIN );
		
		$f = 'example.html';
		$objWriter = PHPExcel_IOFactory::createWriter ( $objPHPExcel, 'HTML' );
		$objWriter->save ( 'public/media/temp/' . $f );
		echo file_get_contents ( 'public/media/temp/' . $f );
	}
	
	/**
	 * Phadh
	 * Tao file xem truoc bao cao
	 * Ho so nhan khau
	 */
	
	/**
	 * Phadh
	 * Tao file xem truoc bao cao
	 * Danh sach giay khai sinh
	 */
	
	
	/**
	 * Phadh
	 * Tao file xem truoc bao cao
	 * Chi tiet giay khai sinh
	 */
	
	
	/**
	 * Phadh
	 * Tao file xem truoc bao cao
	 * Danh sach giay khai tu
	 */
	
	
	/**
	 * Phadh
	 * Tao file xem truoc bao cao
	 * Danh sach tach khau
	 */
	
	/**
	 * Phadh
	 * Tao file xem truoc bao cao
	 * Danh sach nhan khau vang lai
	 */
	
	
	/**
	 * Phadh
	 * Tao file xem truoc bao cao
	 * Chi tiet phieu nhap thuoc
	 */
	public function printviewchitietnhapthuocAction() {
		$this->_helper->layout ()->disableLayout ();
		$helpExport = new HelpFuncExportExcel ();
		$id = $this->_getParam ( 'maphieunhap' );
		$objReader = PHPExcel_IOFactory::createReader ( "Excel5" );
		$jsonObj = null;
		$colIndex = '';
		$rowIndex = 0;
		$jsonObj = $this->_MNhapthuoc->getchitiet ( $this->_ThongtincoquanId, $this->_Namhoatdong, $id );
		
		$objPHPExcel = new PHPExcel ();
		$sheet = $objPHPExcel->getActiveSheet ();
		/*
		 * Bắt đầu set các giá trị, căn chỉnh style Bắt đầu set các giá trị
		 * tĩnh.
		 */
		
		// Begin Chứng từ
		$sheet->setCellValue ( 'A1', $this->TblThongtincoquanbyId [0] ['Tencoquan'] );
		$sheet->mergeCellsByColumnAndRow ( 0, 1, 2, 1 );
		$helpExport->setStyle_13_TNR_B_L ( $sheet, 'A1', 'D1' );
		// End Chứng từ
		$sheet->setCellValue ( 'A3', 'PHIẾU CHI TIẾT NHẬP THUỐC ( ' . $id . ' )' );
		$sheet->mergeCellsByColumnAndRow ( 0, 3, 7, 3 );
		$helpExport->setStyle_15_TNR_B_C ( $sheet, 'A3', 'E3' );
		
		$sheet->setCellValue ( 'A5', 'Người nhập: ' . $jsonObj [0] ['Nguoinhapxuat'] );
		$sheet->mergeCellsByColumnAndRow ( 0, 5, 2, 5 );
		$sheet->setCellValue ( 'E5', 'Ngày nhập: ' . $jsonObj [0] ['Ngaynhapxuat'] );
		$sheet->mergeCellsByColumnAndRow ( 4, 5, 6, 5 );
		$sheet->setCellValue ( 'A6', 'Bộ phận nhận: ' . $jsonObj [0] ['Bophan'] );
		$sheet->mergeCellsByColumnAndRow ( 0, 6, 2, 6 );
		$sheet->setCellValue ( 'E6', 'Kê khai: ' . $jsonObj [0] ['TT'] );
		$sheet->mergeCellsByColumnAndRow ( 4, 6, 6, 6 );
		$helpExport->setStyle_13_TNR ( $sheet, 'A5', 'E6' );
		$rowStart = 8;
		$colStart = 'A';
		$rowIndex = $rowStart;
		$colIndex = $colStart;
		$sheet = $objPHPExcel->getActiveSheet ();
		$sheet->getColumnDimension ( 'A' )->setWidth ( 6 );
		$sheet->getColumnDimension ( 'B' )->setWidth ( 20 );
		$sheet->getColumnDimension ( 'C' )->setWidth ( 8 );
		$sheet->getColumnDimension ( 'D' )->setWidth ( 12 );
		$sheet->getColumnDimension ( 'E' )->setWidth ( 12 );
		$sheet->getColumnDimension ( 'F' )->setWidth ( 10 );
		$sheet->getColumnDimension ( 'G' )->setWidth ( 13 );
		$sheet->getColumnDimension ( 'H' )->setWidth ( 17 );
		// END set width for column
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'STT', $colIndex );
		$sheet->mergeCellsByColumnAndRow ( 0, $rowIndex, 0, ($rowIndex + 1) );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Tên thuốc', $colIndex );
		$sheet->mergeCellsByColumnAndRow ( 1, $rowIndex, 1, ($rowIndex + 1) );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Đơn vị', $colIndex );
		$sheet->mergeCellsByColumnAndRow ( 2, $rowIndex, 2, ($rowIndex + 1) );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Số lượng', $colIndex );
		$sheet->mergeCellsByColumnAndRow ( 3, $rowIndex, 3, ($rowIndex + 1) );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Đơn giá (VNĐ)', $colIndex );
		$sheet->mergeCellsByColumnAndRow ( 4, $rowIndex, 4, ($rowIndex + 1) );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Thành tiền', $colIndex );
		$sheet->mergeCellsByColumnAndRow ( 5, $rowIndex, 5, ($rowIndex + 1) );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Hạn dùng', $colIndex );
		$sheet->mergeCellsByColumnAndRow ( 6, $rowIndex, 6, ($rowIndex + 1) );
		$helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Ghi chú', $colIndex );
		$sheet->mergeCellsByColumnAndRow ( 7, $rowIndex, 7, ($rowIndex + 1) );
		$helpExport->setStyle_11_TNR_B_C ( $sheet, $colStart . $rowIndex, $colIndex . ($rowIndex + 1) );
		
		$rowIndex += 1;
		// Lấy dữ liệu
		if (count ( $jsonObj ) > 0) {
			
			$count = 0;
			$Tongsoluong = 0;
			$Tongthanhtien = 0;
			foreach ( $jsonObj as $row ) {
				$rowIndex += 1;
				$count += 1;
				$colIndex = $colStart;
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $count, $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Tenthuoc'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Tendonvi'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Soluong'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, number_format ( $row ['Dongia'], "0", ",", "," ), $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, number_format ( $row ['Thanhtien'], "0", ",", "," ), $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Hansudung'], $colIndex );
				$helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Ghichu'], $colIndex );
				$helpExport->setStyle_11_TNR_N_C ( $sheet, $colStart . $rowIndex, $colIndex . $rowIndex );
				$helpExport->setStyle_Align_Center ( $sheet, 'A' . $rowIndex, 'A' . $rowIndex );
				$helpExport->setStyle_Align_Center ( $sheet, 'G' . $rowIndex, 'G' . $rowIndex );
				$helpExport->setStyle_Align_Right ( $sheet, 'F' . $rowIndex, 'F' . $rowIndex );
				$helpExport->setStyle_Align_Right ( $sheet, 'E' . $rowIndex, 'E' . $rowIndex );
				$Tongsoluong += $row ['Soluong'];
				$Tongthanhtien += $row ['Thanhtien'];
			}
		}
		$rowIndex += 1;
		$count += 1;
		$sheet->setCellValue ( 'A' . $rowIndex, $count );
		$sheet->setCellValue ( 'B' . $rowIndex, 'Cộng' );
		$sheet->setCellValue ( 'D' . $rowIndex, number_format ( $Tongsoluong, "0", ",", "," ) );
		$sheet->setCellValue ( 'F' . $rowIndex, number_format ( $Tongthanhtien, "0", ",", "," ) );
		// $sheet->setCellValue('H'.$rowIndex,
		// $Tongtonkho);//$jsonObj[0]['Tongtonkho']);
		$helpExport->setStyle_13_TNR_B_C ( $sheet, $colStart . $rowIndex, $colIndex . $rowIndex );
		// Lư Index để format.
		$sheet->getStyle ( 'A' . $rowStart . ':' . 'H' . $rowIndex )->getBorders ()->getOutline ()->setBorderStyle ( PHPExcel_Style_Border::BORDER_THIN );
		$sheet->getStyle ( 'A' . $rowStart . ':' . 'H' . $rowIndex )->getBorders ()->getInside ()->setBorderStyle ( PHPExcel_Style_Border::BORDER_THIN );
		$rowIndex += 2; /*
		                 * $sheet->setCellValue ( 'A4', date ( "d/m/Y" ) );
		                 * $sheet->mergeCellsByColumnAndRow ( 0, 4, 5, 4 );
		                 * $helpExport->setStyleDateDoc ( $sheet, 'A7', 'G7' );
		                 */
		$sheet->setCellValue ( 'G' . $rowIndex, 'Ngày ' . date ( "d" ) . ' tháng ' . date ( "m" ) . ' năm ' . date ( "Y" ) );
		$sheet->mergeCellsByColumnAndRow ( 6, $rowIndex, 7, $rowIndex );
		$helpExport->setStyle_13_TNR_I_C ( $sheet, 'G' . $rowIndex, 'H' . $rowIndex );
		$rowIndex += 1;
		$sheet->setCellValue ( 'G' . $rowIndex, 'Nhân viên in phiếu' );
		$sheet->mergeCellsByColumnAndRow ( 6, $rowIndex, 7, $rowIndex );
		$helpExport->setStyle_13_TNR_B_C ( $sheet, 'G' . $rowIndex, 'H' . $rowIndex );
		$rowIndex += 1;
		$sheet->setCellValue ( 'G' . $rowIndex, '(Ký tên)' );
		$sheet->mergeCellsByColumnAndRow ( 6, $rowIndex, 7, $rowIndex );
		$helpExport->setStyle_13_TNR_I_C ( $sheet, 'G' . $rowIndex, 'H' . $rowIndex );
		$objPHPExcel->getActiveSheet ()->setTitle ( 'Phiếu nhập' );
		
		$f = 'example.html';
		$objWriter = PHPExcel_IOFactory::createWriter ( $objPHPExcel, 'HTML' );
		$objWriter->save ( 'public/media/temp/' . $f );
		echo file_get_contents ( 'public/media/temp/' . $f );
	}
	
	/**
	 * Phadh
	 * Tao file xem truoc bao cao
	 * Chi tiet phieu nhap thiet bi
	 */
	public function printviewchitietnhaptbAction() {
		$this->_helper->layout ()->disableLayout ();
		$helpExport = new HelpFuncExportExcel ();
		$id = $this->_getParam ( 'maphieunhap' );
		$objReader = PHPExcel_IOFactory::createReader ( "Excel5" );
		$jsonObj = null;
		$colIndex = '';
		$rowIndex = 0;
		$jsonObj = $this->_MNhapthietbi->getchitiet ( $this->_ThongtincoquanId, $this->_Namhoatdong, $id );
		
		$objPHPExcel = new PHPExcel ();
		$sheet = $objPHPExcel->getActiveSheet ();
		/*
		 * Bắt đầu set các giá trị, căn chỉnh style Bắt đầu set các giá trị
		 * tĩnh.
		 */
		
		// Begin Chứng từ
		$sheet->setCellValue ( 'A1', $this->TblThongtincoquanbyId [0] ['Tencoquan'] );
		$sheet->mergeCellsByColumnAndRow ( 0, 1, 2, 1 );
		$helpExport->setStyle_13_TNR_B_L ( $sheet, 'A1', 'D1' );
		// End Chứng từ
		$sheet->setCellValue ( 'A3', 'PHIẾU CHI TIẾT NHẬP THIẾT BỊ (' . $id . ')' );
		$sheet->mergeCellsByColumnAndRow ( 0, 3, 7, 3 );
		$helpExport->setStyle_15_TNR_B_C ( $sheet, 'A3', 'H3' );
		
		$sheet->setCellValue ( 'A5', 'Người nhập: ' . $jsonObj [0] ['Nguoinhapxuat'] );
		$sheet->mergeCellsByColumnAndRow ( 0, 5, 2, 5 );
		$sheet->setCellValue ( 'E5', 'Ngày nhập: ' . $jsonObj [0] ['Ngaynhapxuat'] );
		$sheet->mergeCellsByColumnAndRow ( 4, 5, 6, 5 );
		$sheet->setCellValue ( 'A6', 'Bộ phận nhận: ' . $jsonObj [0] ['Bophan'] );
		$sheet->mergeCellsByColumnAndRow ( 0, 6, 2, 6 );
		$sheet->setCellValue ( 'E6', 'Kê khai: ' . $jsonObj [0] ['TT'] );
		$sheet->mergeCellsByColumnAndRow ( 4, 6, 5, 6 );
		$helpExport->setStyle_13_TNR ( $sheet, 'A5', 'G6' );
		
		$rowStart = 8;
		$colStart = 'A';
		$rowIndex = $rowStart;
		$colIndex = $colStart;
		$sheet = $objPHPExcel->getActiveSheet ();
		$sheet->getColumnDimension ( 'A' )->setWidth ( 6 );
		$sheet->getColumnDimension ( 'B' )->setWidth ( 20 );
		$sheet->getColumnDimension ( 'C' )->setWidth ( 8 );
		$sheet->getColumnDimension ( 'D' )->setWidth ( 8 );
		$sheet->getColumnDimension ( 'E' )->setWidth ( 14 );
		$sheet->getColumnDimension ( 'F' )->setWidth ( 15 );
		$sheet->getColumnDimension ( 'G' )->setWidth ( 13 );
		$sheet->getColumnDimension ( 'H' )->setWidth ( 17 );
		// END set width for column
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'STT', $colIndex );
		$sheet->mergeCellsByColumnAndRow ( 0, $rowIndex, 0, ($rowIndex + 1) );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Tên thiết bị', $colIndex );
		$sheet->mergeCellsByColumnAndRow ( 1, $rowIndex, 1, ($rowIndex + 1) );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Đơn vị', $colIndex );
		$sheet->mergeCellsByColumnAndRow ( 2, $rowIndex, 2, ($rowIndex + 1) );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Số lượng', $colIndex );
		$sheet->mergeCellsByColumnAndRow ( 3, $rowIndex, 3, ($rowIndex + 1) );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Đơn giá (VNĐ)', $colIndex );
		$sheet->mergeCellsByColumnAndRow ( 4, $rowIndex, 4, ($rowIndex + 1) );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Thành tiền', $colIndex );
		$sheet->mergeCellsByColumnAndRow ( 5, $rowIndex, 5, ($rowIndex + 1) );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Hạn dùng', $colIndex );
		$sheet->mergeCellsByColumnAndRow ( 6, $rowIndex, 6, ($rowIndex + 1) );
		$helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Ghi chú', $colIndex );
		$sheet->mergeCellsByColumnAndRow ( 7, $rowIndex, 7, ($rowIndex + 1) );
		$helpExport->setStyle_11_TNR_B_C ( $sheet, $colStart . $rowIndex, $colIndex . ($rowIndex + 1) );
		
		// Lấy dữ liệu
		if (count ( $jsonObj ) > 0) {
			$rowIndex += 1;
			$count = 0;
			$Tongsoluong = 0;
			$Tongthanhtien = 0;
			foreach ( $jsonObj as $row ) {
				$rowIndex += 1;
				$count += 1;
				$colIndex = $colStart;
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $count, $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Tenthietbi'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Tendonvi'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Soluong'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, number_format ( $row ['Dongia'], "0", ",", "," ), $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, number_format ( $row ['Thanhtien'], "0", ",", "," ), $colIndex );
				if ($row ['Hansudung'] != '00/00/0000') {
					$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Hansudung'], $colIndex );
				} else {
					$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, '', $colIndex );
				}
				$helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Ghichu'], $colIndex );
				$helpExport->setStyle_11_TNR_N_C ( $sheet, $colStart . $rowIndex, $colIndex . $rowIndex );
				$helpExport->setStyle_Align_Center ( $sheet, 'A' . $rowIndex, 'A' . $rowIndex );
				$helpExport->setStyle_Align_Center ( $sheet, 'G' . $rowIndex, 'G' . $rowIndex );
				$helpExport->setStyle_Align_Right ( $sheet, 'F' . $rowIndex, 'F' . $rowIndex );
				$helpExport->setStyle_Align_Right ( $sheet, 'E' . $rowIndex, 'E' . $rowIndex );
				$Tongsoluong += $row ['Soluong'];
				$Tongthanhtien += $row ['Thanhtien'];
			}
		}
		$rowIndex += 1;
		$count += 1;
		$sheet->setCellValue ( 'A' . $rowIndex, $count );
		$sheet->setCellValue ( 'B' . $rowIndex, 'Cộng' );
		$sheet->setCellValue ( 'D' . $rowIndex, number_format ( $Tongsoluong, "0", ",", "," ) );
		$sheet->setCellValue ( 'F' . $rowIndex, number_format ( $Tongthanhtien, "0", ",", "," ) );
		$helpExport->setStyle_13_TNR_B_C ( $sheet, $colStart . $rowIndex, $colIndex . $rowIndex );
		// Lư Index để format.
		$sheet->getStyle ( 'A' . $rowStart . ':' . 'H' . $rowIndex )->getBorders ()->getOutline ()->setBorderStyle ( PHPExcel_Style_Border::BORDER_THIN );
		$sheet->getStyle ( 'A' . $rowStart . ':' . 'H' . $rowIndex )->getBorders ()->getInside ()->setBorderStyle ( PHPExcel_Style_Border::BORDER_THIN );
		$rowIndex += 2;
		$sheet->setCellValue ( 'G' . $rowIndex, 'Ngày ' . date ( "d" ) . ' tháng ' . date ( "m" ) . ' năm ' . date ( "Y" ) );
		$sheet->mergeCellsByColumnAndRow ( 6, $rowIndex, 7, $rowIndex );
		$helpExport->setStyle_13_TNR_I_C ( $sheet, 'G' . $rowIndex, 'H' . $rowIndex );
		$rowIndex += 1;
		$sheet->setCellValue ( 'G' . $rowIndex, 'Nhân viên in phiếu' );
		$sheet->mergeCellsByColumnAndRow ( 6, $rowIndex, 7, $rowIndex );
		$helpExport->setStyle_13_TNR_B_C ( $sheet, 'G' . $rowIndex, 'H' . $rowIndex );
		$rowIndex += 1;
		$sheet->setCellValue ( 'G' . $rowIndex, '(Ký tên)' );
		$sheet->mergeCellsByColumnAndRow ( 6, $rowIndex, 7, $rowIndex );
		$helpExport->setStyle_13_TNR_I_C ( $sheet, 'G' . $rowIndex, 'H' . $rowIndex );
		$objPHPExcel->getActiveSheet ()->setTitle ( 'Phiếu nhập' );
		
		$f = 'example.html';
		$objWriter = PHPExcel_IOFactory::createWriter ( $objPHPExcel, 'HTML' );
		$objWriter->save ( 'public/media/temp/' . $f );
		echo file_get_contents ( 'public/media/temp/' . $f );
	}
	
	/**
	 * Phadh
	 * Tao file xem truoc bao cao
	 * Chi tiet phieu trang cap - Phan bo
	 */
	public function printviewchitiettcpbAction() {
		$this->_helper->layout ()->disableLayout ();
		$helpExport = new HelpFuncExportExcel ();
		$id = $this->_getParam ( 'maphieunhap' );
		$objReader = PHPExcel_IOFactory::createReader ( "Excel5" );
		$jsonObj = null;
		$colIndex = '';
		$rowIndex = 0;
		$jsonObj = $this->_MPhanbo->getchitiet ( $this->_ThongtincoquanId, $this->_Namhoatdong, $id );
		
		$objPHPExcel = new PHPExcel ();
		$sheet = $objPHPExcel->getActiveSheet ();
		/*
		 * Bắt đầu set các giá trị, căn chỉnh style Bắt đầu set các giá trị
		 * tĩnh.
		 */
		
		// Begin Chứng từ
		$sheet->setCellValue ( 'A1', $this->TblThongtincoquanbyId [0] ['Tencoquan'] );
		$sheet->mergeCellsByColumnAndRow ( 0, 1, 1, 1 );
		$helpExport->setStyle_13_TNR_B_L ( $sheet, 'A1', 'D1' );
		// End Chứng từ
		$sheet->setCellValue ( 'A3', 'CHI TIẾT PHIẾU PHÂN BỔ' );
		$sheet->mergeCellsByColumnAndRow ( 0, 3, 4, 3 );
		$helpExport->setStyleTitleDoc ( $sheet, 'A3', 'E3' );
		
		$sheet->setCellValue ( 'A5', 'Mã phiếu phân bổ: ' . $jsonObj [0] ['Mahoadon'] );
		$sheet->mergeCellsByColumnAndRow ( 0, 5, 1, 5 );
		if ($jsonObj [0] ['Ngaynhapxuat'] != '00/00/0000') {
			$sheet->setCellValue ( 'D5', 'Ngày phân bổ: ' . $jsonObj [0] ['Ngaynhapxuat'] );
		} else {
			$sheet->setCellValue ( 'D5', 'Ngày phân bổ: ' );
		}
		$sheet->mergeCellsByColumnAndRow ( 3, 5, 4, 5 );
		$sheet->setCellValue ( 'A6', 'Người phân bổ: ' . $jsonObj [0] ['Nguoinhapxuat'] );
		$sheet->mergeCellsByColumnAndRow ( 0, 6, 1, 6 );
		$sheet->setCellValue ( 'D6', 'Bộ phận: ' . $jsonObj [0] ['Bophan'] );
		$sheet->mergeCellsByColumnAndRow ( 3, 6, 4, 6 );
		$helpExport->setStyle_13_TNR ( $sheet, 'A5', 'E6' );
		
		$rowStart = 8;
		$colStart = 'A';
		$rowIndex = $rowStart;
		$colIndex = $colStart;
		$sheet = $objPHPExcel->getActiveSheet ();
		$sheet->getColumnDimension ( 'A' )->setWidth ( 6 );
		$sheet->getColumnDimension ( 'B' )->setWidth ( 30 );
		$sheet->getColumnDimension ( 'C' )->setWidth ( 15 );
		$sheet->getColumnDimension ( 'D' )->setWidth ( 15 );
		$sheet->getColumnDimension ( 'E' )->setWidth ( 24 );
		// END set width for column
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'STT', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Thuốc - Thiết bị', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Đơn vị tính', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Số lượng', $colIndex );
		$helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Ghi chú', $colIndex );
		$helpExport->setStyle_11_TNR_B_C ( $sheet, $colStart . $rowIndex, $colIndex . $rowIndex );
		$sheet->getStyle ( 'A' . $rowStart . ':' . 'E' . $rowIndex )->getBorders ()->getOutline ()->setBorderStyle ( PHPExcel_Style_Border::BORDER_THIN );
		$sheet->getStyle ( 'A' . $rowStart . ':' . 'E' . $rowIndex )->getBorders ()->getInside ()->setBorderStyle ( PHPExcel_Style_Border::BORDER_THIN );
		// Lấy dữ liệu
		foreach ( $jsonObj as $row ) {
			$rowIndex += 1;
			$colIndex = $colStart;
			$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $rowIndex - $rowStart, $colIndex );
			$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Tenthuoc'], $colIndex );
			$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Tendonvi'], $colIndex );
			$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Soluong'], $colIndex );
			$helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Ghichu'], $colIndex );
			$helpExport->setStyle_11_TNR_N_C ( $sheet, $colStart . $rowIndex, $colIndex . $rowIndex );
			$helpExport->setStyle_Align_Center ( $sheet, 'A' . $rowIndex, 'A' . $rowIndex );
		}
		// Lư Index để format.
		$sheet->getStyle ( 'A' . $rowStart . ':' . 'E' . $rowIndex )->getBorders ()->getOutline ()->setBorderStyle ( PHPExcel_Style_Border::BORDER_THIN );
		$sheet->getStyle ( 'A' . $rowStart . ':' . 'E' . $rowIndex )->getBorders ()->getInside ()->setBorderStyle ( PHPExcel_Style_Border::BORDER_THIN );
		$rowIndex += 2;
		$sheet->setCellValue ( 'D' . $rowIndex, 'Ngày ' . date ( "d" ) . ' tháng ' . date ( "m" ) . ' năm ' . date ( "Y" ) );
		$sheet->mergeCellsByColumnAndRow ( 3, $rowIndex, 4, $rowIndex );
		$helpExport->setStyle_13_TNR_I_C ( $sheet, 'D' . $rowIndex, 'E' . $rowIndex );
		$rowIndex += 1;
		$sheet->setCellValue ( 'D' . $rowIndex, 'Nhân viên in phiếu' );
		$sheet->mergeCellsByColumnAndRow ( 3, $rowIndex, 4, $rowIndex );
		$helpExport->setStyle_13_TNR_B_C ( $sheet, 'D' . $rowIndex, 'E' . $rowIndex );
		$rowIndex += 1;
		$sheet->setCellValue ( 'D' . $rowIndex, '(Ký tên)' );
		$sheet->mergeCellsByColumnAndRow ( 3, $rowIndex, 4, $rowIndex );
		$helpExport->setStyle_13_TNR_I_C ( $sheet, 'D' . $rowIndex, 'E' . $rowIndex );
		$objPHPExcel->getActiveSheet ()->setTitle ( 'Page 1' );
		
		$f = 'example.html';
		$objWriter = PHPExcel_IOFactory::createWriter ( $objPHPExcel, 'HTML' );
		$objWriter->save ( 'public/media/temp/' . $f );
		echo file_get_contents ( 'public/media/temp/' . $f );
	}
	
	/**
	 * Phadh
	 * Tao file xem truoc bao cao
	 * Chitiet phieu tieu huy
	 */
	public function printviewchitiettieuhuyAction() {
		$this->_helper->layout ()->disableLayout ();
		$helpExport = new HelpFuncExportExcel ();
		$id = $this->_getParam ( 'maphieunhap' );
		$objReader = PHPExcel_IOFactory::createReader ( "Excel5" );
		$jsonObj = null;
		$colIndex = '';
		$rowIndex = 0;
		$jsonObj = $this->_MTieuhuy->getchitiet ( $this->_ThongtincoquanId, $this->_Namhoatdong, $id );
		
		$objPHPExcel = new PHPExcel ();
		$sheet = $objPHPExcel->getActiveSheet ();
		/*
		 * Bắt đầu set các giá trị, căn chỉnh style Bắt đầu set các giá trị
		 * tĩnh.
		 */
		
		// Begin Chứng từ
		$sheet->setCellValue ( 'A1', $this->TblThongtincoquanbyId [0] ['Tencoquan'] );
		$sheet->mergeCellsByColumnAndRow ( 0, 1, 1, 1 );
		$helpExport->setStyle_13_TNR_B_L ( $sheet, 'A1', 'B1' );
		// End Chứng từ
		$sheet->setCellValue ( 'A3', 'CHI TIẾT PHIẾU TIÊU HỦY THUỐC - THIẾT BỊ' );
		$sheet->mergeCellsByColumnAndRow ( 0, 3, 4, 3 );
		$helpExport->setStyle_15_TNR_B_C ( $sheet, 'A3', 'E3' );
		
		$sheet->setCellValue ( 'A5', 'Mã phiếu tiêu hủy: ' . $jsonObj [0] ['Mahoadon'] );
		$sheet->mergeCellsByColumnAndRow ( 0, 5, 1, 5 );
		$sheet->setCellValue ( 'C5', 'Ngày tiêu hủy: ' . $jsonObj [0] ['Ngaynhapxuat'] );
		$sheet->mergeCellsByColumnAndRow ( 2, 5, 3, 5 );
		$sheet->setCellValue ( 'A6', 'Người tiêu hủy: ' . $jsonObj [0] ['Nguoinhapxuat'] );
		$sheet->mergeCellsByColumnAndRow ( 0, 6, 1, 6 );
		$sheet->setCellValue ( 'C6', 'Bộ phận: ' . $jsonObj [0] ['Bophan'] );
		$sheet->mergeCellsByColumnAndRow ( 2, 6, 3, 6 );
		$helpExport->setStyle_13_TNR ( $sheet, 'A5', 'E6' );
		
		$rowStart = 8;
		$colStart = 'A';
		$rowIndex = $rowStart;
		$colIndex = $colStart;
		$sheet = $objPHPExcel->getActiveSheet ();
		$sheet->getColumnDimension ( 'A' )->setWidth ( 6 );
		$sheet->getColumnDimension ( 'B' )->setWidth ( 30 );
		$sheet->getColumnDimension ( 'C' )->setWidth ( 15 );
		$sheet->getColumnDimension ( 'D' )->setWidth ( 15 );
		$sheet->getColumnDimension ( 'E' )->setWidth ( 24 );
		// END set width for column
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'STT', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Thuốc - Thiết bị', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Đơn vị tính', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Số lượng', $colIndex );
		$helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Ghi chú', $colIndex );
		$helpExport->setStyle_11_TNR_B_C ( $sheet, $colStart . $rowIndex, $colIndex . $rowIndex );
		$sheet->getStyle ( 'A' . $rowStart . ':' . 'E' . $rowIndex )->getBorders ()->getOutline ()->setBorderStyle ( PHPExcel_Style_Border::BORDER_THIN );
		$sheet->getStyle ( 'A' . $rowStart . ':' . 'E' . $rowIndex )->getBorders ()->getInside ()->setBorderStyle ( PHPExcel_Style_Border::BORDER_THIN );
		// Lấy dữ liệu
		foreach ( $jsonObj as $row ) {
			$rowIndex += 1;
			$colIndex = $colStart;
			$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $rowIndex - $rowStart, $colIndex );
			$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Tenthuoc'], $colIndex );
			$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Tendonvi'], $colIndex );
			$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Soluong'], $colIndex );
			$helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Ghichu'], $colIndex );
			$helpExport->setStyle_11_TNR_N_C ( $sheet, $colStart . $rowIndex, $colIndex . $rowIndex );
			$helpExport->setStyle_Align_Center ( $sheet, 'A' . $rowIndex, 'A' . $rowIndex );
		}
		// Lư Index để format.
		$sheet->getStyle ( 'A' . $rowStart . ':' . 'E' . $rowIndex )->getBorders ()->getOutline ()->setBorderStyle ( PHPExcel_Style_Border::BORDER_THIN );
		$sheet->getStyle ( 'A' . $rowStart . ':' . 'E' . $rowIndex )->getBorders ()->getInside ()->setBorderStyle ( PHPExcel_Style_Border::BORDER_THIN );
		$rowIndex += 2;
		$sheet->setCellValue ( 'D' . $rowIndex, 'Ngày ' . date ( "d" ) . ' tháng ' . date ( "m" ) . ' năm ' . date ( "Y" ) );
		$sheet->mergeCellsByColumnAndRow ( 3, $rowIndex, 4, $rowIndex );
		$helpExport->setStyle_13_TNR_I_C ( $sheet, 'D' . $rowIndex, 'E' . $rowIndex );
		$rowIndex += 1;
		$sheet->setCellValue ( 'D' . $rowIndex, 'Nhân viên in phiếu' );
		$sheet->mergeCellsByColumnAndRow ( 3, $rowIndex, 4, $rowIndex );
		$helpExport->setStyle_13_TNR_B_C ( $sheet, 'D' . $rowIndex, 'E' . $rowIndex );
		$rowIndex += 1;
		$sheet->setCellValue ( 'D' . $rowIndex, '(Ký tên)' );
		$sheet->mergeCellsByColumnAndRow ( 3, $rowIndex, 4, $rowIndex );
		$helpExport->setStyle_13_TNR_I_C ( $sheet, 'D' . $rowIndex, 'E' . $rowIndex );
		$objPHPExcel->getActiveSheet ()->setTitle ( 'Page 1' );
		
		$f = 'example.html';
		$objWriter = PHPExcel_IOFactory::createWriter ( $objPHPExcel, 'HTML' );
		$objWriter->save ( 'public/media/temp/' . $f );
		echo file_get_contents ( 'public/media/temp/' . $f );
	}
	
	/**
	 * Phadh
	 * Tao file xem truoc bao cao
	 * Danh sach thuoc vat tu ton kho
	 */
	public function printviewdstonkhoAction() {
		$this->_helper->layout ()->disableLayout ();
		$helpExport = new HelpFuncExportExcel ();
		$objReader = PHPExcel_IOFactory::createReader ( "Excel5" );
		$sTendoituong = $this->_getParam ( 'sTendoituong' );
		$Tungay = $this->_getParam ( 'sTungay' );
		$Denngay = $this->_getParam ( 'sDenngay' );
		if ($Tungay != '') {
			$Tungay = $this->convertDateSearch ( $Tungay );
		}
		if ($Denngay != '') {
			$Denngay = $this->convertDateSearch ( $Denngay );
		}
		$Luachon = $this->_getParam ( 'Luachon' );
		$colIndex = '';
		$rowIndex = 0;
		
		$objPHPExcel = new PHPExcel ();
		$sheet = $objPHPExcel->getActiveSheet ();
		/*
		 * Bắt đầu set các giá trị, căn chỉnh style Bắt đầu set các giá trị
		 * tĩnh.
		 */
		$sheet->setCellValue ( 'A1', $this->TblThongtincoquanbyId [0] ['Tencoquan'] );
		$sheet->mergeCellsByColumnAndRow ( 0, 1, 1, 1 );
		$helpExport->setStyle_13_TNR_B_L ( $sheet, 'A1', 'B1' );
		$sheet->setCellValue ( 'A3', 'DANH SÁCH THUỐC VẬT TƯ TỒN KHO' );
		$sheet->mergeCellsByColumnAndRow ( 0, 3, 5, 3 );
		$helpExport->setStyleTitleDoc ( $sheet, 'A3', 'F3' );
		$sheet->setCellValue ( 'A4', date ( "d/m/Y" ) );
		$sheet->mergeCellsByColumnAndRow ( 0, 4, 5, 4 );
		$helpExport->setStyleDateDoc ( $sheet, 'A4', 'F4' );
		
		$rowStart = 7;
		$colStart = 'A';
		$rowIndex = $rowStart;
		$colIndex = $colStart;
		$sheet = $objPHPExcel->getActiveSheet ();
		// BEGIN set width for column
		$sheet->getColumnDimension ( 'A' )->setWidth ( 5 );
		$sheet->getColumnDimension ( 'B' )->setWidth ( 25 );
		$sheet->getColumnDimension ( 'C' )->setWidth ( 10 );
		$sheet->getColumnDimension ( 'D' )->setWidth ( 10 );
		$sheet->getColumnDimension ( 'E' )->setWidth ( 15 );
		$sheet->getColumnDimension ( 'F' )->setWidth ( 15 );
		// END set width for column
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'STT', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Tên thuốc - vật tư', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Số lượng', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Đơn vị', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Hạn dùng', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Mục', $colIndex );
		$helpExport->setStyle_11_TNR_B_C ( $sheet, $colStart . $rowIndex, $colIndex . $rowIndex );
		$rowIndex += 1;
		$colIndex = $colStart;
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, '1', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, '2', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, '3', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, '4', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, '5', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, '6', $colIndex );
		
		$helpExport->setStyle_10_TNR_I_C ( $sheet, $colStart . $rowIndex, $colIndex . $rowIndex );
		// Lấy dữ liệu
		$jsonObj = $this->_MTieuhuy->get_ds_tonkho ( $Tungay, $Denngay, $Luachon, $sTendoituong, $this->_ThongtincoquanId, $this->_Namhoatdong );
		if (count ( $jsonObj ) > 0) {
			$stt = 0;
			foreach ( $jsonObj as $row ) {
				$rowIndex += 1;
				$stt ++;
				$colIndex = $colStart;
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $stt, $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Tenthuocvattu'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Soluong'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Tendonvitinh'], $colIndex );
				if ($row ['Hansudung'] != '00/00/0000') {
					$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Hansudung'], $colIndex );
				} else {
					$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, '', $colIndex );
				}
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Doituong'], $colIndex );
				$helpExport->setStyle_11_TNR_N_L ( $sheet, $colStart . $rowIndex, $colIndex . $rowIndex );
			}
		}
		// $rowIndex = $this->initRow ( $sheet, $helpExport, $data_ds,
		// $rowIndex, 5 );
		$sheet->getStyle ( 'A' . $rowStart . ':' . 'F' . $rowIndex )->getBorders ()->getOutline ()->setBorderStyle ( PHPExcel_Style_Border::BORDER_THIN );
		$sheet->getStyle ( 'A' . $rowStart . ':' . 'F' . $rowIndex )->getBorders ()->getInside ()->setBorderStyle ( PHPExcel_Style_Border::BORDER_THIN );
		$objPHPExcel->getActiveSheet ()->setTitle ( 'Page 1' );
		$f = 'example.html';
		$objWriter = PHPExcel_IOFactory::createWriter ( $objPHPExcel, 'HTML' );
		$objWriter->save ( 'public/media/temp/' . $f );
		echo file_get_contents ( 'public/media/temp/' . $f );
	}
	
	/**
	 * Phadh
	 * Tao file xem truoc bao cao
	 * Danh sach phieu kham benh
	 */
	public function printviewdskhambenhAction() {
		$this->_helper->layout ()->disableLayout ();
		$helpExport = new HelpFuncExportExcel ();
		$objReader = PHPExcel_IOFactory::createReader ( "Excel5" );
		$sgioitinh = $this->_getParam ( 'sgioitinh' );
		$sThonto = $this->_getParam ( 'sThonto' );
		
		$NoWhere = $this->_getParam ( 'NoWhere' );
		$Maphieu = $this->_getParam ( 'Maphieu' );
		$Ngaylap = $this->_getParam ( 'Ngaylap' );
		$Nguoikham = $this->_getParam ( 'Nguoikham' );
		$Nguoibenh = $this->_getParam ( 'Nguoibenh' );
		$Benhdich = $this->_getParam ( 'Benhdich' );
		if ($Ngaylap != '') {
			$Ngaylap = $this->convertDateSearch ( $Ngaylap );
		}
		$colIndex = '';
		$rowIndex = 0;
		
		$objPHPExcel = new PHPExcel ();
		$sheet = $objPHPExcel->getActiveSheet ();
		$this->_Dskb = new Model_Khambenh ();
		
		$jsonObj = $this->_Dskb->getDs ( $NoWhere, $sgioitinh, $sThonto, $Maphieu, $Ngaylap, $Nguoikham, $Nguoibenh, $Benhdich, $this->_Namhoatdong, $this->_ThongtincoquanId );
		/*
		 * Bắt đầu set các giá trị, căn chỉnh style Bắt đầu set các giá trị
		 * tĩnh.
		 */
		$sheet->setCellValue ( 'A1', $this->TblThongtincoquanbyId [0] ['Tencoquan'] );
		$sheet->mergeCellsByColumnAndRow ( 0, 1, 8, 1 );
		$helpExport->setStyle_13_TNR_B_L ( $sheet, 'A1' . $colIndex, 'A1' . $colIndex );
		$sheet->setCellValue ( 'A3', 'DANH SÁCH BỆNH NHÂN KHÁM BỆNH TẠI TRẠM' );
		$helpExport->setStyle_15_TNR_B_C ( $sheet, 'A3' . $colIndex, 'A3' . $colIndex );
		$sheet->mergeCellsByColumnAndRow ( 0, 3, 8, 3 );
		$sheet->setCellValue ( 'A4', 'Năm  ' . $this->_Namhoatdong );
		$helpExport->setStyle_13_TNR_B_C ( $sheet, 'A4' . $colIndex, 'A4' . $colIndex );
		$sheet->mergeCellsByColumnAndRow ( 0, 4, 8, 4 );
		$sheet->setCellValue ( 'G6', 'Tổng số phiếu khám bênh :  ' . (count ( $jsonObj )) );
		$helpExport->setStyle_11_TNR_B_C ( $sheet, 'G6' . $colIndex, 'G6' . $colIndex );
		$sheet->mergeCellsByColumnAndRow ( 6, 6, 7, 6 );
		
		$rowStart = 7;
		$colStart = 'A';
		$rowIndex = $rowStart;
		$colIndex = $colStart;
		$sheet = $objPHPExcel->getActiveSheet ();
		// BEGIN set width for column
		$sheet->getColumnDimension ( 'A' )->setWidth ( 5 );
		$sheet->getColumnDimension ( 'B' )->setWidth ( 10 );
		$sheet->getColumnDimension ( 'C' )->setWidth ( 13 );
		$sheet->getColumnDimension ( 'D' )->setWidth ( 22 );
		$sheet->getColumnDimension ( 'E' )->setWidth ( 15 );
		$sheet->getColumnDimension ( 'F' )->setWidth ( 25 );
		$sheet->getColumnDimension ( 'G' )->setWidth ( 15 );
		$sheet->getColumnDimension ( 'H' )->setWidth ( 20 );
		$sheet->getColumnDimension ( 'I' )->setWidth ( 10.5 );
		
		// END set width for column
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'STT', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Số PKB', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Ngày khám', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Họ tên', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Địa chỉ', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Bệnh dịch', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Chu trình điều trị', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Bác sĩ', $colIndex );
		$helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Ghi chú', $colIndex );
		$helpExport->setStyle_11_TNR_B_C ( $sheet, 'A7', 'I7' );
		
		if (count ( $jsonObj ) > 0) {
			$tempIndex = $rowIndex + 1;
			foreach ( $jsonObj as $row ) {
				$rowIndex += 1;
				$colIndex = $colStart;
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $rowIndex - $rowStart, $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Sophieukcb'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Ngaylapphieu'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Hoten'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Tenthonto'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Benhdich'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Trangthai'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Nguoikham'], $colIndex );
				$helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Ghichu'], $colIndex );
				$helpExport->setStyle_11_TNR_N_L ( $sheet, $colStart . $rowIndex, $colIndex . $rowIndex );
			}
		}
		$sheet->getStyle ( 'A' . $rowStart . ':' . 'I' . $rowIndex )->getBorders ()->getOutline ()->setBorderStyle ( PHPExcel_Style_Border::BORDER_THIN );
		$sheet->getStyle ( 'A' . $rowStart . ':' . 'I' . $rowIndex )->getBorders ()->getInside ()->setBorderStyle ( PHPExcel_Style_Border::BORDER_THIN );
		$objPHPExcel->getActiveSheet ()->setTitle ( 'Page 1' );
		$f = 'example.html';
		$objWriter = PHPExcel_IOFactory::createWriter ( $objPHPExcel, 'HTML' );
		$objWriter->save ( 'public/media/temp/' . $f );
		echo file_get_contents ( 'public/media/temp/' . $f );
	}
	
	/**
	 * Phadh
	 * Tao file xem truoc bao cao
	 * Danh sach phieu xet nghiem
	 */
	public function printviewdsxetnghiemAction() {
		$this->_helper->layout ()->disableLayout ();
		$helpExport = new HelpFuncExportExcel ();
		$objReader = PHPExcel_IOFactory::createReader ( "Excel5" );
		$sgioitinh = $this->_getParam ( 'sgioitinh' );
		$sThonto = $this->_getParam ( 'sThonto' );
		
		$Maphieu = $this->_getParam ( 'Maphieu' );
		$Ngaythang = $this->_getParam ( 'Ngaythang' );
		$Nguoikham = $this->_getParam ( 'Nguoikham' );
		$Nguoibenh = $this->_getParam ( 'Nguoibenh' );
		$Mauxn = $this->_getParam ( 'Mauxn' );
		
		if ($Ngaythang != '') {
			$Ngaythang = $this->convertDateSearch ( $Ngaythang );
		}
		$colIndex = '0';
		$rowIndex = '';
		$objPHPExcel = new PHPExcel ();
		$sheet = $objPHPExcel->getActiveSheet ();
		/*
		 * Bắt đầu set các giá trị, căn chỉnh style Bắt đầu set các giá trị
		 * tĩnh.
		 */
		$sheet->setCellValue ( 'A1', $this->TblThongtincoquanbyId [0] ['Tencoquan'] );
		$sheet->mergeCellsByColumnAndRow ( 0, 1, 3, 1 );
		$helpExport->setStyle_13_TNR_B_L ( $sheet, 'A1', 'C1' );
		$sheet->setCellValue ( 'A4', 'DANH SÁCH XÉT NGHIỆM' );
		$sheet->mergeCellsByColumnAndRow ( 0, 4, 4, 4 );
		$helpExport->setStyleTitleDoc ( $sheet, 'A4', 'D4' );
		
		$sheet->setCellValue ( 'A5', '' );
		$sheet->mergeCellsByColumnAndRow ( 0, 5, 5, 5 );
		
		$rowStart = 6;
		$colStart = 'A';
		$rowIndex = $rowStart;
		$colIndex = $colStart;
		$sheet = $objPHPExcel->getActiveSheet ();
		// BEGIN set width for column
		$sheet->getColumnDimension ( 'A' )->setWidth ( 5 );
		$sheet->getColumnDimension ( 'B' )->setWidth ( 11 );
		$sheet->getColumnDimension ( 'C' )->setWidth ( 20 );
		$sheet->getColumnDimension ( 'D' )->setWidth ( 25 );
		$sheet->getColumnDimension ( 'E' )->setWidth ( 20 );
		
		// END set width for column
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'STT', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Mã số phiếu', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Ngày xét nghiệm', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Người bệnh', $colIndex );
		$helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Người khám', $colIndex );
		$helpExport->setStyle_11_TNR_B_C ( $sheet, $colStart . $rowIndex, $colIndex . ($rowIndex + 1) );
		
		// Lấy dữ liệu
		
		$this->_Dsxn = new Model_Xetnghiem ();
		$jsonObj = $this->_Dsxn->getDspxn ( $sgioitinh, $sThonto, $Maphieu, $Ngaythang, $Nguoikham, $Nguoibenh, $Mauxn, $this->_Namhoatdong, $this->_ThongtincoquanId );
		// = $this->_Dsxn->tong ( $sgioitinh, $sThonto, $Maphieu, $Ngaythang,
		// $Nguoikham, $Nguoibenh, $Mauxn, $this->_Namhoatdong,
		// $this->_ThongtincoquanId );
		$tempIndex = $rowIndex + 1;
		if (count ( $jsonObj ) > 0) {
			foreach ( $jsonObj as $row ) {
				$rowIndex += 1;
				$colIndex = $colStart;
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $rowIndex - $rowStart, $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Maphieukham'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Ngayxetnghiem'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Benhnhan'], $colIndex );
				$helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Nguoikham'], $colIndex );
				$helpExport->setStyle_11_TNR_N_L ( $sheet, $colStart . $rowIndex, $colIndex . $rowIndex );
			}
			// $helpExport->setStyleRowDataTable ( $sheet, 'A' . $tempIndex, 'E'
			// . $rowIndex );
			// $helpExport->setStyle_Align_Center ( $sheet, $colStart .
			// $rowStart, $colStart . $rowIndex );
		}
		$sheet->getStyle ( 'A' . $rowStart . ':' . 'E' . $rowIndex )->getBorders ()->getOutline ()->setBorderStyle ( PHPExcel_Style_Border::BORDER_THIN );
		$sheet->getStyle ( 'A' . $rowStart . ':' . 'E' . $rowIndex )->getBorders ()->getInside ()->setBorderStyle ( PHPExcel_Style_Border::BORDER_THIN );
		$objPHPExcel->getActiveSheet ()->setTitle ( 'Page 1' );
		
		$rowIndex += 2;
		$sheet->setCellValue ( 'D' . $rowIndex, 'Tổng số người xét nghiệm: ' . (count ( $jsonObj )) );
		$helpExport->setStyle_12_TNR_B_C ( $sheet, 'D' . ($rowIndex - 1), 'D' . $rowIndex );
		$sheet->mergeCellsByColumnAndRow ( 3, $rowIndex, 4, $rowIndex );
		$rowIndex += 2;
		$sheet->setCellValue ( 'E' . $rowIndex, 'Nhân viên in phiếu:' );
		
		$rowIndex += 1;
		$sheet->setCellValue ( 'E' . $rowIndex, 'Ký tên' );
		
		$helpExport->setStyleTitleTable ( $sheet, 'E' . ($rowIndex - 1), 'E' . $rowIndex );
		$objPHPExcel->getActiveSheet ()->setTitle ( 'Người in phiếu' );
		
		$f = 'example.html';
		$objWriter = PHPExcel_IOFactory::createWriter ( $objPHPExcel, 'HTML' );
		$objWriter->save ( 'public/media/temp/' . $f );
		echo file_get_contents ( 'public/media/temp/' . $f );
	}
	
	/**
	 * Phadh
	 * Tao file xem truoc bao cao
	 * Chi tiet phieu xet nghiem
	 */
	public function printviewchitietxetnghiemAction() {
		$this->_helper->layout ()->disableLayout ();
		$helpExport = new HelpFuncExportExcel ();
		$id = $this->_getParam ( 'id' );
		$objReader = PHPExcel_IOFactory::createReader ( "Excel5" );
		$jsonObj = null;
		$colIndex = '0';
		$rowIndex = '';
		$nhansu = new Model_Nhansu ();
		
		if (isset ( $id ) && $id != '') {
			$this->_Ctxn = new Model_CTXetnghiem ();
			$jsonObj = $this->_Ctxn->getFetObjByXetnghiemId ( $id, $this->TblThongtincoquanbyId [0] ['Id'] );
			$objPHPExcel = new PHPExcel ();
			$sheet = $objPHPExcel->getActiveSheet ();
			/*
			 * Bắt đầu set các giá trị, căn chỉnh style Bắt đầu set các giá trị
			 * tĩnh.
			 */
			$sheet->setCellValue ( 'A2', $this->TblThongtincoquanbyId [0] ['Tencoquan'] );
			$sheet->mergeCellsByColumnAndRow ( 0, 2, 2, 2 );
			$helpExport->setStyle_12_TNR_B_L ( $sheet, 'A2', 'D2' );
			$sheet->setCellValue ( 'A4', 'CHI TIẾT PHIẾU XÉT NGHIỆM' );
			$sheet->mergeCellsByColumnAndRow ( 0, 4, 3, 4 );
			$helpExport->setStyleTitleDoc ( $sheet, 'A4', 'D4' );
			
			$sheet->setCellValue ( 'A5', '' );
			$sheet->mergeCellsByColumnAndRow ( 0, 5, 3, 5 );
			
			$sheet->setCellValue ( 'A6', 'Tên bệnh nhân: ' . $jsonObj [0] ['Nhankhau'] );
			$sheet->mergeCellsByColumnAndRow ( 0, 6, 2, 6 );
			$helpExport->setStyle_12_TNR_B_L ( $sheet, 'A6', 'D6' );
			$sheet->setCellValue ( 'A7', 'Ngày xét nghiệm: ' . $jsonObj [0] ['Ngayxetnghiem'] );
			$sheet->mergeCellsByColumnAndRow ( 0, 7, 2, 7 );
			$helpExport->setStyle_12_TNR_B_L ( $sheet, 'A7', 'D7' );
			$sheet->setCellValue ( 'A8', 'Người xét nghiệm: ' . $jsonObj [0] ['Nhansu'] );
			$sheet->mergeCellsByColumnAndRow ( 0, 8, 2, 8 );
			$helpExport->setStyle_12_TNR_B_L ( $sheet, 'A8', 'D8' );
			
			$rowStart = 10;
			$colStart = 'A';
			$rowIndex = $rowStart;
			$colIndex = $colStart;
			$sheet = $objPHPExcel->getActiveSheet ();
			// BEGIN set width for column
			$sheet->getColumnDimension ( 'A' )->setWidth ( 5 );
			$sheet->getColumnDimension ( 'B' )->setWidth ( 15 );
			$sheet->getColumnDimension ( 'C' )->setWidth ( 30 );
			$sheet->getColumnDimension ( 'D' )->setWidth ( 20 );
			
			// END set width for column
			$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'STT', $colIndex );
			$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Mã số phiếu', $colIndex );
			$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Tên mục xét nghiệm', $colIndex );
			$helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Kết quả', $colIndex );
			$helpExport->setStyle_11_TNR_B_C ( $sheet, $colStart . $rowIndex, $colIndex . ($rowIndex + 1) );
			
			// Lấy dữ liệu
			
			if (count ( $jsonObj ) > 0) {
				foreach ( $jsonObj as $row ) {
					$rowIndex += 1;
					$colIndex = $colStart;
					$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $rowIndex - $rowStart, $colIndex );
					$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Masophieu'], $colIndex );
					$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Tenmucxetnghiem'], $colIndex );
					$helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Ketqua'], $colIndex );
					$helpExport->setStyle_11_TNR_N_L ( $sheet, $colStart . $rowIndex, $colIndex . ($rowIndex + 1) );
				}
			}
			$sheet->getStyle ( 'A' . $rowStart . ':' . 'D' . $rowIndex )->getBorders ()->getOutline ()->setBorderStyle ( PHPExcel_Style_Border::BORDER_THIN );
			$sheet->getStyle ( 'A' . $rowStart . ':' . 'D' . $rowIndex )->getBorders ()->getInside ()->setBorderStyle ( PHPExcel_Style_Border::BORDER_THIN );
			$objPHPExcel->getActiveSheet ()->setTitle ( 'Page 1' );
			
			$rowIndex += 2;
			$sheet->setCellValue ( 'D' . $rowIndex, 'Nhân viên in phiếu:' );
			$sheet->mergeCellsByColumnAndRow ( 5, $rowIndex, 6, $rowIndex );
			$rowIndex += 1;
			$sheet->setCellValue ( 'D' . $rowIndex, 'Ký tên' );
			$sheet->mergeCellsByColumnAndRow ( 5, $rowIndex, 6, $rowIndex );
			$helpExport->setStyleTitleTable ( $sheet, 'D' . ($rowIndex - 1), 'D' . $rowIndex );
			$objPHPExcel->getActiveSheet ()->setTitle ( 'Người in phiếu' );
			
			$f = 'example.html';
			$objWriter = PHPExcel_IOFactory::createWriter ( $objPHPExcel, 'HTML' );
			$objWriter->save ( 'public/media/temp/' . $f );
			echo file_get_contents ( 'public/media/temp/' . $f );
		}
	}
	
	/**
	 * Phadh
	 * Tao file xem truoc bao cao
	 * Danh sach phieu sieu am
	 */
	public function printviewdssieuamAction() {
		$this->_helper->layout ()->disableLayout ();
		$helpExport = new HelpFuncExportExcel ();
		$objReader = PHPExcel_IOFactory::createReader ( "Excel5" );
		$Maphieu = $this->_getParam ( 'Maphieu' );
		$Ngaysa = $this->_getParam ( 'Ngaysa' );
		$Nguoikham = $this->_getParam ( 'Nguoikham' );
		$Nguoibenh = $this->_getParam ( 'Nguoibenh' );
		$sgioitinh = $this->_getParam ( 'sgioitinh' );
		$sThonto = $this->_getParam ( 'sThonto' );
		
		if ($Ngaysa != '') {
			$Ngaysa = $this->convertDateSearch ( $Ngaysa );
		}
		$colIndex = '';
		$rowIndex = 0;
		
		$objPHPExcel = new PHPExcel ();
		$sheet = $objPHPExcel->getActiveSheet ();
		/*
		 * Bắt đầu set các giá trị, căn chỉnh style Bắt đầu set các giá trị
		 * tĩnh.
		 */
		$sheet->setCellValue ( 'A1', $this->TblThongtincoquanbyId [0] ['Tencoquan'] );
		$sheet->mergeCellsByColumnAndRow ( 0, 1, 3, 1 );
		$helpExport->setStyle_13_TNR_B_L ( $sheet, 'A1', 'C1' );
		$sheet->setCellValue ( 'A3', 'DANH SÁCH SIÊU ÂM' );
		$sheet->mergeCellsByColumnAndRow ( 0, 3, 4, 3 );
		$helpExport->setStyleTitleDoc ( $sheet, 'A3', 'E3' );
		$sheet->setCellValue ( 'A4', 'Năm' . $this->TblThongtincoquanbyId [0] ['Namhoatdong'] );
		$sheet->mergeCellsByColumnAndRow ( 0, 4, 4, 4 );
		$helpExport->setStyle_13_TNR_B_C ( $sheet, 'A4', 'E4' );
		
		$sheet->setCellValue ( 'A5', '' );
		$sheet->mergeCellsByColumnAndRow ( 0, 3, 5, 3 );
		
		$rowStart = 6;
		$colStart = 'A';
		$rowIndex = $rowStart;
		$colIndex = $colStart;
		$sheet = $objPHPExcel->getActiveSheet ();
		// BEGIN set width for column
		$sheet->getColumnDimension ( 'A' )->setWidth ( 5 );
		$sheet->getColumnDimension ( 'B' )->setWidth ( 11 );
		$sheet->getColumnDimension ( 'C' )->setWidth ( 20 );
		$sheet->getColumnDimension ( 'D' )->setWidth ( 30 );
		$sheet->getColumnDimension ( 'E' )->setWidth ( 30 );
		
		// END set width for column
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'STT', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Mã số phiếu', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Ngày siêu âm', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Người bệnh', $colIndex );
		$helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Người khám', $colIndex );
		$helpExport->setStyle_11_TNR_B_C ( $sheet, $colStart . $rowIndex, $colIndex . ($rowIndex + 1) );
		
		// Lấy dữ liệu
		$jsonObj = $this->_MSieuam->getDssa ( $sgioitinh, $sThonto, $Maphieu, $Ngaysa, $Nguoikham, $Nguoibenh, $this->_Namhoatdong, $this->_ThongtincoquanId );
		// $tong = $this->_MSieuam->tong ( $sgioitinh, $sThonto, $Maphieu,
		// $Ngaysa, $Nguoikham, $Nguoibenh, $this->_Namhoatdong,
		// $this->_ThongtincoquanId );
		$tempIndex = $rowIndex + 1;
		if (count ( $jsonObj ) > 0) {
			foreach ( $jsonObj as $row ) {
				$rowIndex += 1;
				$colIndex = $colStart;
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $rowIndex - $rowStart, $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Maphieukham'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Ngaysieuam'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Benhnhan'], $colIndex );
				$helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Nguoikham'], $colIndex );
				$helpExport->setStyle_11_TNR_N_L ( $sheet, $colStart . $rowIndex, $colIndex . ($rowIndex + 1) );
			}
			// $helpExport->setStyleRowDataTable ( $sheet, 'A' . $tempIndex, 'E'
			// . $rowIndex );
			// $helpExport->setStyle_Align_Center ( $sheet, $colStart .
			// $rowStart, $colStart . $rowIndex );
		}
		$sheet->getStyle ( 'A' . $rowStart . ':' . 'E' . $rowIndex )->getBorders ()->getOutline ()->setBorderStyle ( PHPExcel_Style_Border::BORDER_THIN );
		$sheet->getStyle ( 'A' . $rowStart . ':' . 'E' . $rowIndex )->getBorders ()->getInside ()->setBorderStyle ( PHPExcel_Style_Border::BORDER_THIN );
		$objPHPExcel->getActiveSheet ()->setTitle ( 'Page 1' );
		
		$rowIndex += 2;
		$sheet->setCellValue ( 'E' . $rowIndex, 'Tổng số người siêu âm: ' . (count ( $jsonObj )) );
		$helpExport->setStyle_12_TNR_B_L ( $sheet, 'E' . ($rowIndex - 1), 'E' . $rowIndex );
		$rowIndex += 2;
		$sheet->setCellValue ( 'E' . $rowIndex, 'Nhân viên in phiếu:' );
		
		$rowIndex += 1;
		$sheet->setCellValue ( 'E' . $rowIndex, 'Ký tên' );
		
		$helpExport->setStyleTitleTable ( $sheet, 'E' . ($rowIndex - 1), 'E' . $rowIndex );
		$objPHPExcel->getActiveSheet ()->setTitle ( 'Người in phiếu' );
		$f = 'example.html';
		$objWriter = PHPExcel_IOFactory::createWriter ( $objPHPExcel, 'HTML' );
		$objWriter->save ( 'public/media/temp/' . $f );
		echo file_get_contents ( 'public/media/temp/' . $f );
	}
	
	/**
	 * Phadh
	 * Tao file xem truoc bao cao
	 * Chi tiet phieu sieu am
	 */
	public function printviewchitietsieuamAction() {
		$this->_helper->layout ()->disableLayout ();
		$helpExport = new HelpFuncExportExcel ();
		// $maphieusieuam = 11;
		$maphieusieuam = $this->_getParam ( 'maphieusieuam' );
		$objReader = PHPExcel_IOFactory::createReader ( "Excel5" );
		$colIndex = '';
		$rowIndex = 0;
		
		$jsonObj = $this->_MCTSieuam->getFetObjBySieuamId ( $this->TblThongtincoquanbyId [0] ['Id'], $maphieusieuam );
		$objPHPExcel = new PHPExcel ();
		$sheet = $objPHPExcel->getActiveSheet ();
		/*
		 * Bắt đầu set các giá trị, căn chỉnh style Bắt đầu set các giá trị
		 * tĩnh.
		 */
		$sheet->setCellValue ( 'A2', $this->TblThongtincoquanbyId [0] ['Tencoquan'] );
		$sheet->mergeCellsByColumnAndRow ( 0, 2, 3, 2 );
		$helpExport->setStyle_12_TNR_B_L ( $sheet, 'A2' . $colIndex, 'A2' . $colIndex );
		$sheet->setCellValue ( 'A4', 'CHI TIẾT PHIẾU SIÊU ÂM' );
		$helpExport->setStyle_12_TNR_B_C ( $sheet, 'A4' . $colIndex, 'A4' . $colIndex );
		$sheet->mergeCellsByColumnAndRow ( 0, 4, 3, 4 );
		
		$sheet->setCellValue ( 'A5', '' );
		$sheet->mergeCellsByColumnAndRow ( 0, 5, 5, 5 );
		
		$sheet->setCellValue ( 'A6', 'Tên bệnh nhân: ' . $jsonObj [0] ['Benhnhan'] );
		$sheet->mergeCellsByColumnAndRow ( 0, 6, 2, 6 );
		$helpExport->setStyle_12_TNR_B_L ( $sheet, 'A6', 'D6' );
		$sheet->setCellValue ( 'A7', 'Ngày siêu âm: ' . $jsonObj [0] ['Ngaysieuam'] );
		$sheet->mergeCellsByColumnAndRow ( 0, 7, 2, 7 );
		$helpExport->setStyle_12_TNR_B_L ( $sheet, 'A7', 'D7' );
		$sheet->setCellValue ( 'A8', 'Người siêu âm: ' . $jsonObj [0] ['Nhansu'] );
		$sheet->mergeCellsByColumnAndRow ( 0, 8, 2, 8 );
		$helpExport->setStyle_12_TNR_B_L ( $sheet, 'A8', 'D8' );
		
		$rowStart = 10;
		$colStart = 'A';
		$rowIndex = $rowStart;
		$colIndex = $colStart;
		$sheet = $objPHPExcel->getActiveSheet ();
		// BEGIN set width for column
		$sheet->getColumnDimension ( 'A' )->setWidth ( 5 );
		$sheet->getColumnDimension ( 'B' )->setWidth ( 15 );
		$sheet->getColumnDimension ( 'C' )->setWidth ( 20 );
		$sheet->getColumnDimension ( 'D' )->setWidth ( 20 );
		
		// END set width for column
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'STT', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Mã số phiếu', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Tên mục siêu âm', $colIndex );
		$helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Kết quả', $colIndex );
		$helpExport->setStyle_11_TNR_B_C ( $sheet, $colStart . $rowIndex, $colIndex . ($rowIndex + 1) );
		
		// Lấy dữ liệu
		
		if (count ( $jsonObj ) > 0) {
			foreach ( $jsonObj as $row ) {
				$rowIndex += 1;
				$colIndex = $colStart;
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $rowIndex - $rowStart, $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Sophieu'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['cMucsieuam'], $colIndex );
				// $colIndex = $helpExport->setValueForSheet ( $sheet,
				// $colIndex . $rowIndex, $row ['Benhnhan'], $colIndex
				// );
				$helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['cKetqua'], $colIndex );
				$helpExport->setStyle_11_TNR_N_L ( $sheet, $colStart . $rowIndex, $colIndex . ($rowIndex + 1) );
			}
			
			/*
			 * $helpExport->setStyleRowDataTable ( $sheet, 'A' . ($rowStart +
			 * 5), 'D' . $rowIndex ); $helpExport->setStyle_Align_Center (
			 * $sheet, $colStart . $rowStart, $colStart . $rowIndex );
			 * $helpExport->setStyle_10_TNR_NO_C ( $sheet, $colStart .
			 * $rowIndex, $colIndex . $rowIndex );
			 */
		}
		$sheet->getStyle ( 'A' . $rowStart . ':' . 'D' . $rowIndex )->getBorders ()->getOutline ()->setBorderStyle ( PHPExcel_Style_Border::BORDER_THIN );
		$sheet->getStyle ( 'A' . $rowStart . ':' . 'D' . $rowIndex )->getBorders ()->getInside ()->setBorderStyle ( PHPExcel_Style_Border::BORDER_THIN );
		$objPHPExcel->getActiveSheet ()->setTitle ( 'Page 1' );
		
		$rowIndex += 2;
		$sheet->setCellValue ( 'D' . $rowIndex, 'Nhân viên in phiếu:' );
		$sheet->mergeCellsByColumnAndRow ( 5, $rowIndex, 6, $rowIndex );
		$rowIndex += 1;
		$sheet->setCellValue ( 'D' . $rowIndex, 'Ký tên' );
		$sheet->mergeCellsByColumnAndRow ( 5, $rowIndex, 6, $rowIndex );
		$helpExport->setStyleTitleTable ( $sheet, 'D' . ($rowIndex - 1), 'D' . $rowIndex );
		$objPHPExcel->getActiveSheet ()->setTitle ( 'Người in phiếu' );
		
		$f = 'example.html';
		$objWriter = PHPExcel_IOFactory::createWriter ( $objPHPExcel, 'HTML' );
		$objWriter->save ( 'public/media/temp/' . $f );
		echo file_get_contents ( 'public/media/temp/' . $f );
	}
	
	/**
	 * Phadh
	 * Tao file xem truoc bao cao
	 * Don thuoc
	 */
	public function printviewdonthuocAction() {
		$this->_helper->layout ()->disableLayout ();
		$helpExport = new HelpFuncExportExcel ();
		$id = $this->_getParam ( 'mahoadon' );
		$objReader = PHPExcel_IOFactory::createReader ( "Excel5" );
		$jsonObj = null;
		$colIndex = '';
		$rowIndex = 0;
		$chitiet = new Model_Capphatthuoc ();
		$jsonObj = $chitiet->getthongtindtObj ( $this->TblThongtincoquanbyId [0] ['Id'], $id, $this->_Namhoatdong );
		
		$data_thuoc = $chitiet->getctphieunhapdtObj ( $this->TblThongtincoquanbyId [0] ['Id'], $id );
		// $data_thuoc = array();
		
		$ketquaxetnghiem = $chitiet->ketquaxetnghiemObj ( $this->TblThongtincoquanbyId [0] ['Id'], $id, $this->_Namhoatdong );
		
		$ketquasieuam = $chitiet->ketquasieuamObj ( $this->TblThongtincoquanbyId [0] ['Id'], $id, $this->_Namhoatdong );
		
		$diachi = $chitiet->diachiObj ( $this->TblThongtincoquanbyId [0] ['Id'], $id, $this->_Namhoatdong );
		$objPHPExcel = new PHPExcel ();
		$sheet = $objPHPExcel->getActiveSheet ();
		/*
		 * Bắt đầu set các giá trị, căn chỉnh style Bắt đầu set các giá trị
		 * tĩnh.
		 */
		
		$sheet->setCellValue ( 'A1', 'SỞ Y TẾ ' . mb_strtoupper ( $this->TblTinhbytramId ['0'] ['Tentinh'], "utf8" ) );
		$sheet->mergeCellsByColumnAndRow ( 0, 1, 2, 1 );
		$sheet->setCellValue ( 'A2', $this->TblThongtincoquanbyId [0] ['Tencoquan'] );
		$sheet->mergeCellsByColumnAndRow ( 0, 2, 2, 2 );
		$helpExport->setStyle_13_TNR_B_L ( $sheet, 'A1', 'D2' );
		
		$sheet->setCellValue ( 'A4', 'ĐƠN CẤP THUỐC BHYT ' );
		$sheet->mergeCellsByColumnAndRow ( 0, 4, 6, 4 );
		$helpExport->setStyle_15_TNR_B_C ( $sheet, 'A4', 'F4' );
		
		$sheet->setCellValue ( 'A6', 'Họ tên bệnh nhân: ' . $jsonObj [0] ['Hoten'] );
		$sheet->mergeCellsByColumnAndRow ( 0, 6, 2, 6 );
		$sheet->setCellValue ( 'E6', ' Giới tính:  ' . $jsonObj [0] ['Gioitinh'] );
		$sheet->mergeCellsByColumnAndRow ( 4, 6, 6, 6 );
		$sheet->setCellValue ( 'A7', 'Tuổi: ' . $jsonObj [0] ['Tuoi'] );
		$sheet->setCellValue ( 'A8', 'Địa chỉ: ' . $diachi [0] ['Tenthonto'] . '-' . $diachi [0] ['Tenxa'] . '-' . $diachi [0] ['Tenhuyen'] . '-' . $diachi [0] ['Tentinh'] );
		$sheet->mergeCellsByColumnAndRow ( 0, 8, 6, 8 );
		$sheet->setCellValue ( 'A9', 'Số thẻ BHYT: ' . $jsonObj [0] ['Sothebhyt'] );
		$sheet->mergeCellsByColumnAndRow ( 0, 9, 6, 9 );
		$sheet->setCellValue ( 'A10', 'Giá trị từ: .../.../...... Đến: .../.../.....' );
		$sheet->mergeCellsByColumnAndRow ( 0, 10, 6, 10 );
		$sheet->setCellValue ( 'A11', 'Chuẩn đoán: ' . $jsonObj [0] ['Chuandoan'] );
		$sheet->mergeCellsByColumnAndRow ( 0, 11, 6, 11 );
		$helpExport->setStyle_13_TNR ( $sheet, 'A6', 'G11' );
		$sheet->mergeCellsByColumnAndRow ( 0, 18, 1, 18 );
		$sheet->mergeCellsByColumnAndRow ( 0, 19, 2, 19 );
		$sheet->mergeCellsByColumnAndRow ( 3, 19, 6, 19 );
		$sheet->mergeCellsByColumnAndRow ( 0, 20, 6, 20 );
		$sheet->mergeCellsByColumnAndRow ( 0, 21, 6, 21 );
		$rowStart = 12;
		$colStart = 'A';
		$rowIndex = $rowStart;
		$colIndex = $colStart;
		$sheet = $objPHPExcel->getActiveSheet ();
		$sheet->getColumnDimension ( 'A' )->setWidth ( 6 );
		$sheet->getColumnDimension ( 'B' )->setWidth ( 23.13 );
		$sheet->getColumnDimension ( 'C' )->setWidth ( 9 );
		$sheet->getColumnDimension ( 'D' )->setWidth ( 9 );
		$sheet->getColumnDimension ( 'E' )->setWidth ( 9 );
		$sheet->getColumnDimension ( 'F' )->setWidth ( 9 );
		$sheet->getColumnDimension ( 'G' )->setWidth ( 15 );
		// END set width for column
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'STT', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Thuốc', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Đơn vị', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Số lượng', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Đơn giá (VNĐ)', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Thành tiền', $colIndex );
		$helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Liều dùng', $colIndex );
		$helpExport->setStyle_11_TNR_B_C ( $sheet, $colStart . $rowIndex, $colIndex . $rowIndex );
		// Lấy dữ liệu
		$count = 0;
		if (count ( $jsonObj ) > 0) {
			foreach ( $data_thuoc as $row ) {
				$count += 1;
				$rowIndex += 1;
				$colIndex = $colStart;
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $count, $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Tenthuoc'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Tendonvi'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Soluong'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, number_format ( $row ['Dongia'], "0", ",", "," ), $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, number_format ( $row ['Thanhtien'], "0", ",", "," ), $colIndex );
				$helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Cachsudung'], $colIndex );
				$helpExport->setStyle_11_TNR_N_C ( $sheet, $colStart . $rowIndex, $colIndex . $rowIndex );
			}
		}
		// Lư Index để format.
		$rowIndex += 1;
		$sheet->setCellValue ( 'A' . $rowIndex, 'Cộng thuốc' );
		$helpExport->setStyle_11_TNR_N_C ( $sheet, $colStart . $rowIndex, $colIndex . $rowIndex );
		$sheet->mergeCellsByColumnAndRow ( 0, $rowIndex, 2, $rowIndex );
		$sheet->setCellValue ( 'D' . $rowIndex, $data_thuoc [0] ['Congthuoc'] );
		$sheet->setCellValue ( 'F' . $rowIndex, '' . number_format ( $data_thuoc [0] ['Congtien'], "0", ",", "," ) );
		$helpExport->setStyle_11_TNR_N_C ( $sheet, $colStart . $rowIndex, $colIndex . $rowIndex );
		$sheet->getStyle ( 'A' . $rowStart . ':' . 'G' . $rowIndex )->getBorders ()->getOutline ()->setBorderStyle ( PHPExcel_Style_Border::BORDER_THIN );
		$sheet->getStyle ( 'A' . $rowStart . ':' . 'G' . $rowIndex )->getBorders ()->getInside ()->setBorderStyle ( PHPExcel_Style_Border::BORDER_THIN );
		
		$rowIndex += 1;
		$sheet->setCellValue ( 'A' . $rowIndex, 'Tiền công khám: ' . number_format ( $this->TblDongia [0] ['Giatien'], "0", ",", "," ) );
		$helpExport->setStyle_13_TNR ( $sheet, 'A' . $rowIndex, 'G' . $rowIndex );
		$rowIndex += 1;
		$sheet->setCellValue ( 'A' . $rowIndex, 'Tiền thủ thuật: ' . number_format ( $this->TblDongia [0] ['Tienthuthuat'], "0", ",", "," ) );
		$helpExport->setStyle_13_TNR ( $sheet, 'A' . $rowIndex, 'G' . $rowIndex );
		$rowIndex += 1;
		foreach ( $ketquaxetnghiem as $rows ) {
			$this->ketqua .= $rows ['Ketqua'] . ', ';
		}
		$this->ketqua = rtrim ( $this->ketqua, "," );
		$sheet->setCellValue ( 'A' . $rowIndex, 'XN: ' . $this->ketqua );
		$sheet->mergeCellsByColumnAndRow ( 0, 17, 2, 17 );
		foreach ( $ketquasieuam as $get ) {
			$this->kt .= $get ['Ketqua'] . ', ';
		}
		$this->kt = rtrim ( $this->kt, "," );
		$sheet->setCellValue ( 'D' . $rowIndex, 'Chuẩn đoán HA: ' . $this->kt );
		$sheet->mergeCellsByColumnAndRow ( 3, 17, 4, 17 );
		$helpExport->setStyle_13_TNR ( $sheet, 'A' . $rowIndex, 'G' . $rowIndex );
		$rowIndex += 1;
		$sheet->setCellValue ( 'A' . $rowIndex, 'VTYTTH: ' );
		$helpExport->setStyle_13_TNR ( $sheet, 'A' . $rowIndex, 'G' . $rowIndex );
		$rowIndex += 1;
		$tongtien = $data_thuoc [0] ['Congtien'] + $this->TblDongia [0] ['Giatien'] + $this->TblDongia [0] ['Tienthuthuat'];
		$sheet->setCellValue ( 'A' . $rowIndex, 'Tổng cộng: ' . number_format ( $tongtien, "0", ",", "," ) );
		$helpExport->setStyle_13_TNR ( $sheet, 'A' . $rowIndex, 'G' . $rowIndex );
		$rowIndex += 2;
		$sheet->setCellValue ( 'A' . $rowIndex, 'BN đã nhận đủ ' . ' loại thuốc' );
		$sheet->mergeCellsByColumnAndRow ( 0, $rowIndex, 1, $rowIndex );
		$sheet->setCellValue ( 'E' . $rowIndex, 'Ngày ' . date ( "d" ) . ' tháng ' . date ( "m" ) . ' năm ' . date ( "Y" ) );
		$sheet->mergeCellsByColumnAndRow ( 4, $rowIndex, 6, $rowIndex );
		$helpExport->setStyle_13_TNR_N_C ( $sheet, 'A' . $rowIndex, 'G' . $rowIndex );
		$rowIndex += 1;
		$sheet->setCellValue ( 'A' . $rowIndex, 'Bệnh nhân' );
		$sheet->mergeCellsByColumnAndRow ( 0, $rowIndex, 1, $rowIndex );
		$sheet->setCellValue ( 'E' . $rowIndex, 'Y, Bác sỹ khám bệnh' );
		$sheet->mergeCellsByColumnAndRow ( 4, $rowIndex, 6, $rowIndex );
		$helpExport->setStyle_13_TNR_B_C ( $sheet, 'A' . $rowIndex, 'G' . $rowIndex );
		$rowIndex += 1;
		$sheet->setCellValue ( 'A' . $rowIndex, '(Họ và tên)' );
		$sheet->mergeCellsByColumnAndRow ( 0, $rowIndex, 1, $rowIndex );
		$sheet->setCellValue ( 'E' . $rowIndex, '(Họ và tên)' );
		$sheet->mergeCellsByColumnAndRow ( 4, $rowIndex, 6, $rowIndex );
		$helpExport->setStyle_13_TNR_B_C ( $sheet, 'A' . $rowIndex, 'G' . $rowIndex );
		
		$rowIndex += 3;
		$sheet->setCellValue ( 'A' . $rowIndex, $jsonObj [0] ['Hoten'] );
		$sheet->mergeCellsByColumnAndRow ( 0, $rowIndex, 1, $rowIndex );
		$sheet->setCellValue ( 'E' . $rowIndex, $jsonObj [0] ['Nhansu'] );
		$sheet->mergeCellsByColumnAndRow ( 4, $rowIndex, 6, $rowIndex );
		$helpExport->setStyle_13_TNR_B_C ( $sheet, 'A' . $rowIndex, 'G' . $rowIndex );
		
		$objPHPExcel->getActiveSheet ()->setTitle ( 'Đơn thuốc' );
		$objPHPExcel->getActiveSheet ()->getPageSetup ()->setOrientation ( PHPExcel_Worksheet_PageSetup::ORIENTATION_PORTRAIT );
		$objPHPExcel->getActiveSheet ()->getPageSetup ()->setPaperSize ( PHPExcel_Worksheet_PageSetup::PAPERSIZE_A4 );
		$pageMargin = $sheet->getPageMargins ();
		$pageMargin->setTop ( .5 );
		$pageMargin->setLeft ( .7 );
		$pageMargin->setRight ( .61 );
		
		$f = 'example.html';
		$objWriter = PHPExcel_IOFactory::createWriter ( $objPHPExcel, 'HTML' );
		$objWriter->save ( 'public/media/temp/' . $f );
		echo file_get_contents ( 'public/media/temp/' . $f );
	}
	
	/**
	 * Phadh
	 * Tao file xem truoc bao cao
	 * Danh sach sot ret
	 */
	public function printviewdssotretAction() {
		$this->_helper->layout ()->disableLayout ();
		$helpExport = new HelpFuncExportExcel ();
		
		$objReader = PHPExcel_IOFactory::createReader ( "Excel5" );
		$sgioitinh = $this->_getParam ( 'sgioitinh' );
		$sThonto = $this->_getParam ( 'sThonto' );
		
		$snbenh = $this->_getParam ( 'sNbenh' );
		$snkham = $this->_getParam ( 'sNkham' );
		$snguoikham = $this->_getParam ( 'sNguoikham' );
		
		if ($snkham != '') {
			$snkham = $this->convertDateSearch ( $snkham );
		}
		$colIndex = '';
		$rowIndex = 0;
		
		$objPHPExcel = new PHPExcel ();
		$sheet = $objPHPExcel->getActiveSheet ();
		/*
		 * Bắt đầu set các giá trị, căn chỉnh style Bắt đầu set các giá trị
		 * tĩnh.
		 */
		$sheet->setCellValue ( 'A1', $this->TblThongtincoquanbyId [0] ['Tencoquan'] );
		$sheet->mergeCellsByColumnAndRow ( 0, 1, 3, 1 );
		$helpExport->setStyle_13_TNR_B_L ( $sheet, 'A1', 'C1' );
		$sheet->setCellValue ( 'A3', 'DANH SÁCH BỆNH NHÂN SỐT RÉT' );
		$sheet->mergeCellsByColumnAndRow ( 0, 3, 6, 3 );
		$helpExport->setStyleTitleDoc ( $sheet, 'A3', 'G3' );
		$sheet->setCellValue ( 'A4', 'Năm  ' . $this->_Namhoatdong );
		$sheet->mergeCellsByColumnAndRow ( 0, 4, 6, 4 );
		$helpExport->setStyleTitleDoc ( $sheet, 'A4', 'G4' );
		
		$sheet->setCellValue ( 'A5', '' );
		$sheet->mergeCellsByColumnAndRow ( 0, 5, 6, 5 );
		
		$rowStart = 6;
		$colStart = 'A';
		$rowIndex = $rowStart;
		$colIndex = $colStart;
		$sheet = $objPHPExcel->getActiveSheet ();
		// BEGIN set width for column
		$sheet->getColumnDimension ( 'A' )->setWidth ( 5 );
		$sheet->getColumnDimension ( 'B' )->setWidth ( 20 );
		$sheet->getColumnDimension ( 'C' )->setWidth ( 12 );
		$sheet->getColumnDimension ( 'D' )->setWidth ( 6 );
		$sheet->getColumnDimension ( 'E' )->setWidth ( 15 );
		$sheet->getColumnDimension ( 'F' )->setWidth ( 20 );
		$sheet->getColumnDimension ( 'G' )->setWidth ( 10 );
		
		// END set width for column
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'STT', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Họ tên', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Ngày tiêm', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Sốt', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Chuẩn đoán', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Bác sĩ khám', $colIndex );
		$helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Ghi chú', $colIndex );
		$helpExport->setStyle_11_TNR_B_C ( $sheet, $colStart . $rowIndex, $colIndex . ($rowIndex + 1) );
		
		$this->_Dssr = new Model_Sotret ();
		$jsonObj = $this->_Dssr->getDssr ( $sgioitinh, $sThonto, $snbenh, $snkham, $snguoikham, $this->_ThongtincoquanId, $this->_Namhoatdong );
		// $tong = $this->_Dssr->tong ( $sgioitinh, $sThonto, $snbenh, $snkham,
		// $snguoikham, $this->_ThongtincoquanId, $this->_Namhoatdong );
		
		if (count ( $jsonObj ) > 0) {
			// $tempIndex = $rowIndex + 1;
			foreach ( $jsonObj as $row ) {
				$rowIndex += 1;
				$colIndex = $colStart;
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $rowIndex - $rowStart, $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Hoten'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Ngaythang'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Sot'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Chuandoan'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Nhansu'], $colIndex );
				$helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Ghichu'], $colIndex );
				$helpExport->setStyle_11_TNR_N_C ( $sheet, $colStart . $rowIndex, $colIndex . ($rowIndex + 1) );
			}
			
			// $helpExport->setStyleRowDataTable ( $sheet, 'A' . $tempIndex, 'G'
			// . $rowIndex );
			// $helpExport->setStyle_Align_Center ( $sheet, $colStart .
			// $rowStart, $colStart . $rowIndex );
		}
		$sheet->getStyle ( 'A' . $rowStart . ':' . 'G' . $rowIndex )->getBorders ()->getOutline ()->setBorderStyle ( PHPExcel_Style_Border::BORDER_THIN );
		$sheet->getStyle ( 'A' . $rowStart . ':' . 'G' . $rowIndex )->getBorders ()->getInside ()->setBorderStyle ( PHPExcel_Style_Border::BORDER_THIN );
		$objPHPExcel->getActiveSheet ()->setTitle ( 'Page 1' );
		
		$rowIndex += 2;
		$sheet->setCellValue ( 'E' . $rowIndex, 'Tổng số người mắc bệnh: ' . (count ( $jsonObj )) );
		$helpExport->setStyle_12_TNR_B_C ( $sheet, 'E' . ($rowIndex - 1), 'E' . $rowIndex );
		$sheet->mergeCellsByColumnAndRow ( 4, $rowIndex, 6, $rowIndex );
		$rowIndex += 2;
		$sheet->setCellValue ( 'F' . $rowIndex, 'Nhân viên in phiếu:' );
		$sheet->mergeCellsByColumnAndRow ( 5, $rowIndex, 6, $rowIndex );
		$rowIndex += 1;
		$sheet->setCellValue ( 'F' . $rowIndex, 'Ký tên' );
		$helpExport->setStyleTitleTable ( $sheet, 'F' . ($rowIndex - 1), 'F' . $rowIndex );
		$objPHPExcel->getActiveSheet ()->setTitle ( 'Người in phiếu' );
		$sheet->mergeCellsByColumnAndRow ( 5, $rowIndex, 6, $rowIndex );
		$f = 'example.html';
		$objWriter = PHPExcel_IOFactory::createWriter ( $objPHPExcel, 'HTML' );
		$objWriter->save ( 'public/media/temp/' . $f );
		echo file_get_contents ( 'public/media/temp/' . $f );
	}
	
	/**
	 * Phadh
	 * Tao file xem truoc bao cao
	 * Chi tiet sot ret
	 */
	public function printviewchitietsotretAction() {
		$this->_helper->layout ()->disableLayout ();
		$helpExport = new HelpFuncExportExcel ();
		$maphieusotret = $this->_getParam ( 'Id' );
		$colIndex = '';
		$rowIndex = 0;
		$this->_Ctsr = new Model_Sotret ();
		$objPHPExcel = new PHPExcel ();
		$sheet = $objPHPExcel->getActiveSheet ();
		$jsonObj = $this->_Ctsr->getFetObjBySotretId ( $maphieusotret, $this->_Namhoatdong, $this->_ThongtincoquanId );
		/*
		 * Bắt đầu set các giá trị, căn chỉnh style Bắt đầu set các giá trị
		 * tĩnh.
		 */
		$sheet->setCellValue ( 'A2', $this->TblThongtincoquanbyId [0] ['Tencoquan'] );
		$sheet->mergeCellsByColumnAndRow ( 0, 2, 2, 2 );
		$helpExport->setStyle_12_TNR_B_L ( $sheet, 'A2' . $colIndex, 'A2' . $colIndex );
		$sheet->setCellValue ( 'A3', 'CHI TIẾT BỆNH NHÂN SỐT RÉT' );
		$helpExport->setStyle_12_TNR_B_C ( $sheet, 'A3' . $colIndex, 'A3' . $colIndex );
		$sheet->mergeCellsByColumnAndRow ( 0, 3, 9, 3 );
		$sheet->setCellValue ( 'A4', 'Năm  ' . $this->_Namhethong );
		$helpExport->setStyle_12_TNR_B_C ( $sheet, 'A4' . $colIndex, 'A4' . $colIndex );
		$sheet->mergeCellsByColumnAndRow ( 0, 4, 9, 4 );
		
		$sheet->setCellValue ( 'A5', '' );
		$sheet->mergeCellsByColumnAndRow ( 0, 5, 9, 5 );
		
		$sheet->setCellValue ( 'A6', 'Họ và tên: ' . $jsonObj [0] ['Hoten'] );
		$helpExport->setStyle_12_TNR_N_L ( $sheet, 'A6' . $colIndex, 'A6' . $colIndex );
		$sheet->mergeCellsByColumnAndRow ( 0, 6, 3, 6 );
		$sheet->setCellValue ( 'A7', 'Địa chỉ: ' . $jsonObj [0] ['Thonto'].'-'.$jsonObj[0]['Tenxa'].'-'.$jsonObj[0]['Tenhuyen'].'-'.$jsonObj[0]['Tentinh'] );
		$helpExport->setStyle_12_TNR_N_L ( $sheet, 'A7' . $colIndex, 'A7' . $colIndex );
		$sheet->mergeCellsByColumnAndRow ( 0, 7, 3, 7 );
		$sheet->setCellValue ( 'A8', 'Nơi phát hiện: ' . $jsonObj [0] ['Noiphathien'] );
		$helpExport->setStyle_12_TNR_N_L ( $sheet, 'A8' . $colIndex, 'A8' . $colIndex );
		$sheet->mergeCellsByColumnAndRow ( 0, 8, 3, 8 );
		$sheet->setCellValue ( 'A9', 'Kết quả ĐT: ' . $jsonObj [0] ['Ketquadieutri'] );
		$helpExport->setStyle_12_TNR_N_L ( $sheet, 'A9' . $colIndex, 'A9' . $colIndex );
		$sheet->mergeCellsByColumnAndRow ( 0, 9, 3, 9 );
		$sheet->setCellValue ( 'G6', 'Bác sỹ khám: ' . $jsonObj [0] ['Bacsi'] );
		$helpExport->setStyle_12_TNR_N_L ( $sheet, 'G6' . $colIndex, 'G6' . $colIndex );
		$sheet->mergeCellsByColumnAndRow ( 6, 6, 9, 6 );
		$sheet->setCellValue ( 'G7', 'Ngày tháng: ' . $jsonObj [0] ['Ngaythang'] );
		$helpExport->setStyle_12_TNR_N_L ( $sheet, 'G7' . $colIndex, 'G7' . $colIndex );
		$sheet->mergeCellsByColumnAndRow ( 6, 7, 9, 7 );
		
		$rowStart = 11;
		$colStart = 'A';
		$rowIndex = $rowStart;
		$colIndex = $colStart;
		$sheet = $objPHPExcel->getActiveSheet ();
		
		$sheet->getColumnDimension ( 'A' )->setWidth ( 15 );
		$sheet->getColumnDimension ( 'B' )->setWidth ( 17 );
		$sheet->getColumnDimension ( 'C' )->setWidth ( 5 );
		$sheet->getColumnDimension ( 'D' )->setWidth ( 12 );
		$sheet->getColumnDimension ( 'E' )->setWidth ( 12 );
		$sheet->getColumnDimension ( 'F' )->setWidth ( 7 );
		$sheet->getColumnDimension ( 'G' )->setWidth ( 7 );
		$sheet->getColumnDimension ( 'H' )->setWidth ( 7 );
		$sheet->getColumnDimension ( 'I' )->setWidth ( 12 );
		$sheet->getColumnDimension ( 'J' )->setWidth ( 15 );
		
		// END set width for column
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Biểu hiện', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Chuẩn đoán', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Sốt', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'XN Lam', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Kết quả XN', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Có thai', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'SRAT', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'KST', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Thuốc ĐTSR', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Thuốc tự ĐT', $colIndex );
		$helpExport->setStyle_11_TNR_B_C ( $sheet, $colStart . $rowIndex, $colIndex . ($rowIndex + 1) );
		
		// Lay du lieu
		if (count ( $jsonObj ) > 0) {
			foreach ( $jsonObj as $row ) {
				$rowIndex += 1;
				$colIndex = $colStart;
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Bieuhien'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Chuandoan'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Sot'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Xetnghiemlamquethu'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Ketquaxetnghiem'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Cothai'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['SRAT'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['SKT'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['ThuocSRdieutri'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['ThuocSRtudieutri'], $colIndex );
				$helpExport->setStyle_11_TNR_N_C ( $sheet, $colStart . $rowIndex, $colIndex . ($rowIndex + 1) );
			}
		}
		$sheet->getStyle ( 'A' . $rowStart . ':' . 'J' . $rowIndex )->getBorders ()->getOutline ()->setBorderStyle ( PHPExcel_Style_Border::BORDER_THIN );
		$sheet->getStyle ( 'A' . $rowStart . ':' . 'J' . $rowIndex )->getBorders ()->getInside ()->setBorderStyle ( PHPExcel_Style_Border::BORDER_THIN );
		$objPHPExcel->getActiveSheet ()->setTitle ( 'Page 1' );
		
		$rowIndex += 2;
		$sheet->setCellValue ( 'I' . $rowIndex, 'Nhân viên in phiếu:' );
		$sheet->mergeCellsByColumnAndRow ( 8, $rowIndex, 9, $rowIndex );
		$rowIndex += 1;
		$sheet->setCellValue ( 'I' . $rowIndex, 'Ký tên' );
		$sheet->mergeCellsByColumnAndRow ( 8, $rowIndex, 9, $rowIndex );
		$helpExport->setStyleTitleTable ( $sheet, 'I' . ($rowIndex - 1), 'I' . $rowIndex );
		$objPHPExcel->getActiveSheet ()->setTitle ( 'Người in phiếu' );
		$f = 'example.html';
		$objWriter = PHPExcel_IOFactory::createWriter ( $objPHPExcel, 'HTML' );
		$objWriter->save ( 'public/media/temp/' . $f );
		echo file_get_contents ( 'public/media/temp/' . $f );
	}
	
	/**
	 * Phadh
	 * Tao file xem truoc bao cao
	 * Danh sach nguoi nhiem hiv
	 */
	public function printviewdshivAction() {
		$this->_helper->layout ()->disableLayout ();
		$helpExport = new HelpFuncExportExcel ();
		$objReader = PHPExcel_IOFactory::createReader ( "Excel5" );
		$sgioitinh = $this->_getParam ( 'sgioitinh' );
		$sThonto = $this->_getParam ( 'sThonto' );
		
		$snguoibenh = $this->_getParam ( 'sTnb' );
		$snguoikham = $this->_getParam ( 'sNs' );
		$sngaythang = $this->_getParam ( 'Ngaythang' );
		
		if ($sngaythang != '') {
			$sngaythang = $this->convertDateSearch ( $sngaythang );
		}
		$colIndex = '';
		$rowIndex = 0;
		
		$objPHPExcel = new PHPExcel ();
		$sheet = $objPHPExcel->getActiveSheet ();
		/*
		 * Bắt đầu set các giá trị, căn chỉnh style Bắt đầu set các giá trị
		 * tĩnh.
		 */
		$sheet->setCellValue ( 'A1', $this->TblThongtincoquanbyId [0] ['Tencoquan'] );
		$sheet->mergeCellsByColumnAndRow ( 0, 1, 3, 1 );
		$helpExport->setStyle_13_TNR_B_L ( $sheet, 'A1', 'C1' );
		$sheet->setCellValue ( 'A3', 'DANH SÁCH BỆNH NHÂN HIV' );
		$sheet->mergeCellsByColumnAndRow ( 0, 3, 6, 3 );
		$helpExport->setStyleTitleDoc ( $sheet, 'A3', 'G3' );
		$sheet->setCellValue ( 'A4', 'Năm ' . $this->_Namhoatdong );
		$sheet->mergeCellsByColumnAndRow ( 0, 4, 6, 4 );
		$helpExport->setStyleTitleDoc ( $sheet, 'A4', 'G4' );
		
		$sheet->setCellValue ( 'A5', '' );
		$sheet->mergeCellsByColumnAndRow ( 0, 5, 6, 5 );
		
		$rowStart = 6;
		$colStart = 'A';
		$rowIndex = $rowStart;
		$colIndex = $colStart;
		$sheet = $objPHPExcel->getActiveSheet ();
		// BEGIN set width for column
		$sheet->getColumnDimension ( 'A' )->setWidth ( 5 );
		$sheet->getColumnDimension ( 'B' )->setWidth ( 20 );
		$sheet->getColumnDimension ( 'C' )->setWidth ( 10 );
		$sheet->getColumnDimension ( 'D' )->setWidth ( 10 );
		$sheet->getColumnDimension ( 'E' )->setWidth ( 20 );
		$sheet->getColumnDimension ( 'F' )->setWidth ( 15 );
		$sheet->getColumnDimension ( 'G' )->setWidth ( 10 );
		
		// END set width for column
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'STT', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Họ tên', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Trạng thái', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Hiện mắc', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Bác sĩ', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Ngày tháng', $colIndex );
		$helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Ghi chú', $colIndex );
		$helpExport->setStyle_11_TNR_B_C ( $sheet, $colStart . $rowIndex, $colIndex . ($rowIndex + 1) );
		
		// Lấy dữ liệu
		
		$jsonObj = $this->_MHiv->getDs ( $snguoibenh, $snguoikham, $sngaythang, $sgioitinh, $sThonto, $this->TblThongtincoquanbyId [0] ['Id'], $this->TblThongtincoquanbyId [0] ['Namhoatdong'] );
		// $tong = $this->_MHiv->tong ( $snguoibenh, $snguoikham, $sngaythang,
		// $sgioitinh, $sThonto, $this->TblThongtincoquanbyId [0] ['Id'],
		// $this->TblThongtincoquanbyId [0] ['Namhoatdong'] );
		
		if (count ( $jsonObj ) > 0) {
			// $tempIndex = $rowIndex + 1;
			foreach ( $jsonObj as $row ) {
				$rowIndex += 1;
				$colIndex = $colStart;
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $rowIndex - $rowStart, $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Nhankhau'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Trangthai'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Hienmac'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Hoten'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Ngaythang'], $colIndex );
				$helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Ghichu'], $colIndex );
				$helpExport->setStyle_11_TNR_N_C ( $sheet, $colStart . $rowIndex, $colIndex . ($rowIndex + 1) );
			}
			
			// $helpExport->setStyleRowDataTable ( $sheet, 'A' . $tempIndex, 'G'
			// . $rowIndex );
			// $helpExport->setStyle_Align_Center ( $sheet, $colStart .
			// $rowStart, $colStart . $rowIndex );
		}
		$sheet->getStyle ( 'A' . $rowStart . ':' . 'G' . $rowIndex )->getBorders ()->getOutline ()->setBorderStyle ( PHPExcel_Style_Border::BORDER_THIN );
		$sheet->getStyle ( 'A' . $rowStart . ':' . 'G' . $rowIndex )->getBorders ()->getInside ()->setBorderStyle ( PHPExcel_Style_Border::BORDER_THIN );
		$objPHPExcel->getActiveSheet ()->setTitle ( 'Page 1' );
		
		$rowIndex += 2;
		$sheet->setCellValue ( 'F' . $rowIndex, 'Tổng số người mắc bệnh: ' . (count ( $jsonObj )) );
		$helpExport->setStyle_12_TNR_B_L ( $sheet, 'F' . ($rowIndex - 1), 'F' . $rowIndex );
		$sheet->mergeCellsByColumnAndRow ( 5, $rowIndex, 6, $rowIndex );
		$rowIndex += 2;
		$sheet->setCellValue ( 'F' . $rowIndex, 'Nhân viên in phiếu:' );
		$sheet->mergeCellsByColumnAndRow ( 5, $rowIndex, 6, $rowIndex );
		$rowIndex += 1;
		$sheet->setCellValue ( 'F' . $rowIndex, 'Ký tên' );
		$helpExport->setStyleTitleTable ( $sheet, 'F' . ($rowIndex - 1), 'F' . $rowIndex );
		$objPHPExcel->getActiveSheet ()->setTitle ( 'Người in phiếu' );
		$sheet->mergeCellsByColumnAndRow ( 5, $rowIndex, 6, $rowIndex );
		$f = 'example.html';
		$objWriter = PHPExcel_IOFactory::createWriter ( $objPHPExcel, 'HTML' );
		$objWriter->save ( 'public/media/temp/' . $f );
		echo file_get_contents ( 'public/media/temp/' . $f );
	}
	
	/**
	 * Phadh
	 * Tao file xem truoc bao cao
	 * Chi tiet HIV
	 */
	public function printviewchitiethivAction() {
		$this->_helper->layout ()->disableLayout ();
		$helpExport = new HelpFuncExportExcel ();
		$maphieuhiv = $this->_getParam ( 'Id' );
		$objReader = PHPExcel_IOFactory::createReader ( "Excel5" );
		$colIndex = '';
		$rowIndex = 0;
		$jsonObj = $this->_MHiv->getCt ( $maphieuhiv, $this->_ThongtincoquanId, $this->_Namhoatdong );
		$objPHPExcel = new PHPExcel ();
		$objPHPExcel = $objReader->load ( "public/media/temp/chitiethiv.xls" );
		$sheet = $objPHPExcel->getActiveSheet ();
		/*
		 * Bắt đầu set các giá trị, căn chỉnh style Bắt đầu set các giá trị
		 * tĩnh.
		 */
		foreach ( $jsonObj as $row ) {
			$sheet->setCellValue ( "A" . "1", $this->TblThongtincoquanbyId [0] ['Tencoquan'] );
			$sheet->setCellValue ( "B" . "4", $jsonObj [0] ['Mahodan'] );
			$sheet->setCellValue ( "B" . "5", $jsonObj [0] ['Hoten'] );
			$sheet->setCellValue ( "B" . "6", $jsonObj [0] ['Diachi'] );
			$sheet->setCellValue ( "B" . "7", $jsonObj [0] ['Trangthai'] );
			$sheet->setCellValue ( "G" . "7", $jsonObj [0] ['Hienmac'] );
			$sheet->setCellValue ( "B" . "8", $jsonObj [0] ['Tenbophan'] );
			$sheet->setCellValue ( "G" . "8", $jsonObj [0] ['Bacsi'] );
			$sheet->setCellValue ( "B" . "9", $jsonObj [0] ['Ngaythang'] );
			$sheet->setCellValue ( "B" . "10", $jsonObj [0] ['Ghichu'] );
		}
		$f = 'example.html';
		$objWriter = PHPExcel_IOFactory::createWriter ( $objPHPExcel, 'HTML' );
		$objWriter->save ( 'public/media/temp/' . $f );
		echo file_get_contents ( 'public/media/temp/' . $f );
	}
	
	/**
	 * Phadh
	 * Tao file xem truoc bao cao
	 * Danh sach tam than
	 */
	public function printviewdstamthanAction() {
		$this->_helper->layout ()->disableLayout ();
		$helpExport = new HelpFuncExportExcel ();
		$objReader = PHPExcel_IOFactory::createReader ( "Excel5" );
		$snguoibenh = $this->_getParam ( 'sTnb' );
		$snguoikham = $this->_getParam ( 'sNs' );
		$sngaythang = $this->_getParam ( 'Ngaythang' );
		$sgioitinh = $this->_getParam ( 'sgioitinh' );
		$sThonto = $this->_getParam ( 'sThonto' );
		if ($sngaythang != '') {
			$sngaythang = $this->convertDateSearch ( $sngaythang );
		}
		$colIndex = '';
		$rowIndex = 0;
		$objPHPExcel = new PHPExcel ();
		$sheet = $objPHPExcel->getActiveSheet ();
		/*
		 * Bắt đầu set các giá trị, căn chỉnh style Bắt đầu set các giá trị
		 * tĩnh.
		 */
		$sheet->setCellValue ( 'A2', $this->TblThongtincoquanbyId [0] ['Tencoquan'] );
		$sheet->mergeCellsByColumnAndRow ( 0, 2, 6, 2 );
		$helpExport->setStyle_13_TNR_B_L ( $sheet, 'A2' . $colIndex, 'A2' . $colIndex );
		$sheet->setCellValue ( 'A4', 'DANH SÁCH BỆNH NHÂN TÂM THẦN' );
		$helpExport->setStyle_15_TNR_B_C ( $sheet, 'A4' . $colIndex, 'A4' . $colIndex );
		$sheet->mergeCellsByColumnAndRow ( 0, 4, 7, 4 );
		
		$sheet->setCellValue ( 'A5', 'Năm' . $this->TblThongtincoquanbyId [0] ['Namhoatdong'] );
		$sheet->mergeCellsByColumnAndRow ( 0, 5, 7, 5 );
		$helpExport->setStyle_13_TNR_B_C ( $sheet, 'A5' . $colIndex, 'A5' . $colIndex );
		
		$rowStart = 8;
		$colStart = 'A';
		$rowIndex = $rowStart;
		$colIndex = $colStart;
		$sheet = $objPHPExcel->getActiveSheet ();
		// BEGIN set width for column
		$sheet->getColumnDimension ( 'A' )->setWidth ( 6 );
		$sheet->getColumnDimension ( 'B' )->setWidth ( 22 );
		$sheet->getColumnDimension ( 'C' )->setWidth ( 10 );
		$sheet->getColumnDimension ( 'D' )->setWidth ( 20 );
		$sheet->getColumnDimension ( 'E' )->setWidth ( 10 );
		$sheet->getColumnDimension ( 'F' )->setWidth ( 10 );
		$sheet->getColumnDimension ( 'G' )->setWidth ( 10 );
		$sheet->getColumnDimension ( 'H' )->setWidth ( 20 );
		$sheet->getRowDimension ( '4' )->setRowHeight ( 30 );
		
		// END set width for column
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'STT', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Họ tên', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Ngày tháng', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Bác sĩ', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Trạng thái', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Đang điều trị', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Quản lý', $colIndex );
		$helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Ghi chú', $colIndex );
		$helpExport->setStyle_11_TNR_B_C ( $sheet, $colStart . $rowIndex, $colIndex . $rowIndex );
		
		// Lấy dữ liệu
		$this->_Dstt = new Model_Tamthan ();
		$jsonObj = $this->_Dstt->getDs ( $snguoibenh, $snguoikham, $sngaythang, $sgioitinh, $sThonto, $this->_ThongtincoquanId, $this->_Namhoatdong );
		// $tong = $this->_Dstt->tong ( $snguoibenh, $snguoikham, $sngaythang,
		// $sgioitinh, $sThonto, $this->_ThongtincoquanId, $this->_Namhoatdong
		// );
		
		if (count ( $jsonObj ) > 0) {
			$tempIndex = $rowIndex + 1;
			foreach ( $jsonObj as $row ) {
				$rowIndex += 1;
				$colIndex = $colStart;
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $rowIndex - $rowStart, $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Hoten'], $colIndex );
				if ($row ['Ngaythang'] != '00/00/0000') {
					$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Ngaythang'], $colIndex );
				} else {
					$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, '', $colIndex );
				}
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Nhansu'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Trangthai1'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Dangdieutri1'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Quanly'], $colIndex );
				$helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Ghichu'], $colIndex );
				$helpExport->setStyle_11_TNR_N_C ( $sheet, $colStart . $rowIndex, $colIndex . $rowIndex );
			}
			
			$helpExport->setStyle_Align_Center ( $sheet, 'E' . $rowStart, 'G' . $rowIndex );
			// $helpExport->setStyle_Align_Center ( $sheet, $colStart .
			// $rowStart, $colStart . $rowIndex );
		}
		$sheet->getStyle ( 'A' . $rowStart . ':' . 'H' . $rowIndex )->getBorders ()->getOutline ()->setBorderStyle ( PHPExcel_Style_Border::BORDER_THIN );
		$sheet->getStyle ( 'A' . $rowStart . ':' . 'H' . $rowIndex )->getBorders ()->getInside ()->setBorderStyle ( PHPExcel_Style_Border::BORDER_THIN );
		$objPHPExcel->getActiveSheet ()->setTitle ( 'Page 1' );
		
		$rowIndex += 1;
		$sheet->setCellValue ( 'F' . $rowIndex, 'Tổng số người mắc Tâm thần: ' . (count ( $jsonObj )) );
		$helpExport->setStyle_11_TNR_B_C ( $sheet, 'F' . $rowIndex, 'H' . $rowIndex );
		$sheet->mergeCellsByColumnAndRow ( 5, $rowIndex, 7, $rowIndex );
		$rowIndex += 2;
		$sheet->setCellValue ( 'F' . $rowIndex, 'Ngày... tháng... năm ' . $this->_Namhoatdong );
		$helpExport->setStyle_11_TNR_N_C ( $sheet, $colStart . $rowIndex, 'F' . $rowIndex );
		$sheet->mergeCellsByColumnAndRow ( 5, $rowIndex, 7, $rowIndex );
		$rowIndex += 1;
		$sheet->setCellValue ( 'F' . $rowIndex, 'Nhân viên in phiếu' );
		$helpExport->setStyle_11_TNR_B_C ( $sheet, 'F' . $rowIndex, 'F' . $rowIndex );
		$sheet->mergeCellsByColumnAndRow ( 5, $rowIndex, 7, $rowIndex );
		$rowIndex += 1;
		$sheet->setCellValue ( 'F' . $rowIndex, '(Ký ghi rõ họ tên)' );
		$helpExport->setStyle_11_TNR_I_C ( $sheet, 'F' . $rowIndex, 'F' . $rowIndex );
		$sheet->mergeCellsByColumnAndRow ( 5, $rowIndex, 7, $rowIndex );
		$f = 'example.html';
		$objWriter = PHPExcel_IOFactory::createWriter ( $objPHPExcel, 'HTML' );
		$objWriter->save ( 'public/media/temp/' . $f );
		echo file_get_contents ( 'public/media/temp/' . $f );
	}
	
	/**
	 * Phadh
	 * Tao file xem truoc bao cao
	 * Danh sach kahm thai
	 */
	public function printviewdskhamthaiAction() {
		$this->_helper->layout ()->disableLayout ();
		$helpExport = new HelpFuncExportExcel ();
		$sThonto = $this->_getParam ( 'sThonto' );
		
		$Maphieu = $this->_getParam ( 'Maphieu' );
		$Ngaythang = $this->_getParam ( 'Ngaythang' );
		$Nguoibenh = $this->_getParam ( 'Nguoibenh' );
		
		if ($Ngaythang != '') {
			$Ngaythang = $this->convertDateSearch ( $Ngaythang );
		}
		$objReader = PHPExcel_IOFactory::createReader ( "Excel5" );
		$colIndex = '';
		$rowIndex = 0;
		
		$objPHPExcel = new PHPExcel ();
		$sheet = $objPHPExcel->getActiveSheet ();
		/*
		 * Bắt đầu set các giá trị, căn chỉnh style Bắt đầu set các giá trị
		 * tĩnh.
		 */
		$sheet->setCellValue ( 'A1', $this->TblThongtincoquanbyId [0] ['Tencoquan'] );
		$sheet->mergeCellsByColumnAndRow ( 0, 1, 7, 1 );
		$helpExport->setStyle_13_TNR_B_L ( $sheet, 'A1' . $colIndex, 'A1' . $colIndex );
		$sheet->setCellValue ( 'A3', 'DANH SÁCH BỆNH NHÂN KHÁM THAI' );
		$helpExport->setStyle_15_TNR_B_C ( $sheet, 'A3' . $colIndex, 'A3' . $colIndex );
		$sheet->mergeCellsByColumnAndRow ( 0, 3, 7, 3 );
		$sheet->setCellValue ( 'A4', 'Năm' . $this->_Namhoatdong );
		$helpExport->setStyle_15_TNR_B_C ( $sheet, 'A4' . $colIndex, 'A4' . $colIndex );
		$sheet->mergeCellsByColumnAndRow ( 0, 4, 7, 4 );
		$sheet->setCellValue ( 'A5', '' );
		$sheet->mergeCellsByColumnAndRow ( 0, 5, 7, 5 );
		
		$rowStart = 6;
		$colStart = 'A';
		$rowIndex = $rowStart;
		$colIndex = $colStart;
		$sheet = $objPHPExcel->getActiveSheet ();
		// BEGIN set width for column
		$sheet->getColumnDimension ( 'A' )->setWidth ( 6 );
		$sheet->getColumnDimension ( 'B' )->setWidth ( 6 );
		$sheet->getColumnDimension ( 'C' )->setWidth ( 18 );
		$sheet->getColumnDimension ( 'D' )->setWidth ( 6 );
		$sheet->getColumnDimension ( 'E' )->setWidth ( 6 );
		$sheet->getColumnDimension ( 'F' )->setWidth ( 15 );
		$sheet->getColumnDimension ( 'G' )->setWidth ( 15 );
		$sheet->getColumnDimension ( 'H' )->setWidth ( 10 );
		$sheet->getRowDimension ( '3' )->setRowHeight ( 30 );
		
		// END set width for column
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'STT', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Số sổ khám thai', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Họ tên', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Số con hiện có', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Lần có thai thứ', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Ngày kinh cuối', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Tiền sử sức khỏe và sinh sản', $colIndex );
		$helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Ghi chú', $colIndex );
		$helpExport->setStyle_11_TNR_B_C ( $sheet, 'A6', 'H6' );
		
		// Lấy dữ liệu
		$this->_Dskt = new Model_Khamthai ();
		$jsonObj = $this->_Dskt->getDs ( $sThonto, $Maphieu, $Ngaythang, $Nguoibenh, $this->_ThongtincoquanId, $this->_Namhoatdong );
		// $tong = $this->_Dskt->tong ( $sThonto, $Maphieu, $Ngaythang,
		// $Nguoibenh, $this->_ThongtincoquanId, $this->_Namhoatdong );
		
		if (count ( $jsonObj ) > 0) {
			$tempIndex = $rowIndex + 1;
			foreach ( $jsonObj as $row ) {
				$rowIndex += 1;
				$colIndex = $colStart;
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $rowIndex - $rowStart, $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Sosokhamthai'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Hoten'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Soconhienco'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Lancothaithu'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Ngaykinhcuoi'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Tiensuckhoevasinhde'], $colIndex );
				$helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, null, $colIndex );
			}
			
			$helpExport->setStyle_11_TNR_N_C ( $sheet, 'A' . $tempIndex, 'H' . $rowIndex );
			$helpExport->setStyle_Align_Center ( $sheet, $colStart . $rowStart, $colStart . $rowIndex );
		}
		$sheet->getStyle ( 'A' . $rowStart . ':' . 'H' . $rowIndex )->getBorders ()->getOutline ()->setBorderStyle ( PHPExcel_Style_Border::BORDER_THIN );
		$sheet->getStyle ( 'A' . $rowStart . ':' . 'H' . $rowIndex )->getBorders ()->getInside ()->setBorderStyle ( PHPExcel_Style_Border::BORDER_THIN );
		$objPHPExcel->getActiveSheet ()->setTitle ( 'Page 1' );
		
		$rowIndex += 2;
		$sheet->setCellValue ( 'F' . $rowIndex, 'Tổng số người khám thai: ' . (count ( $jsonObj )) );
		$helpExport->setStyle_13_TNR_B_C ( $sheet, 'F' . ($rowIndex - 1), 'F' . $rowIndex );
		$sheet->mergeCellsByColumnAndRow ( 5, $rowIndex, 7, $rowIndex );
		$rowIndex += 2;
		$sheet->setCellValue ( 'F' . $rowIndex, 'Ngày... tháng... năm ' . $this->_Namhoatdong );
		$helpExport->setStyle_13_TNR_N_C ( $sheet, 'F' . $rowIndex, 'F' . $rowIndex );
		$sheet->mergeCellsByColumnAndRow ( 5, $rowIndex, 7, $rowIndex );
		$rowIndex += 1;
		$sheet->setCellValue ( 'F' . $rowIndex, 'Nhân viên in phiếu' );
		$helpExport->setStyle_13_TNR_B_C ( $sheet, 'F' . $rowIndex, 'F' . $rowIndex );
		$sheet->mergeCellsByColumnAndRow ( 5, $rowIndex, 7, $rowIndex );
		$rowIndex += 1;
		$sheet->setCellValue ( 'F' . $rowIndex, '(Ký tên)' );
		$helpExport->setStyle_13_TNR_I_C ( $sheet, 'F' . $rowIndex, 'F' . $rowIndex );
		$sheet->mergeCellsByColumnAndRow ( 5, $rowIndex, 7, $rowIndex );
		$objPHPExcel->getActiveSheet ()->setTitle ( 'Danh sách khám thai' );
		$f = 'example.html';
		$objWriter = PHPExcel_IOFactory::createWriter ( $objPHPExcel, 'HTML' );
		$objWriter->save ( 'public/media/temp/' . $f );
		echo file_get_contents ( 'public/media/temp/' . $f );
	}
	
	/**
	 * Phadh
	 * Tao file xem truoc bao cao
	 * Chi tiet kham thai
	 */
	public function printviewchitietkhamthaiAction() {
		$this->_helper->layout ()->disableLayout ();
		$helpExport = new HelpFuncExportExcel ();
		$sosokhamthai = $this->_getParam ( 'Id' );
		
		$objReader = PHPExcel_IOFactory::createReader ( "Excel5" );
		$colIndex = '';
		$rowIndex = 0;
		
		$objPHPExcel = new PHPExcel ();
		$sheet = $objPHPExcel->getActiveSheet ();
		$this->_Ctkt = new Model_Khamthai ();
		$jsonObj = $this->_Ctkt->getCtkt ( $sosokhamthai, $this->_ThongtincoquanId, $this->_Namhoatdong );
		$info = $this->_Ctkt->getCtktinfo ( $sosokhamthai, $this->_ThongtincoquanId, $this->_Namhoatdong );
		/*
		 * Bắt đầu set các giá trị, căn chỉnh style Bắt đầu set các giá trị
		 * tĩnh.
		 */
		$sheet->setCellValue ( 'A1', $this->TblThongtincoquanbyId [0] ['Tencoquan'] );
		$helpExport->setStyle_13_TNR_B_L ( $sheet, 'A1', 'A1' );
		$sheet->mergeCellsByColumnAndRow ( 0, 1, 5, 1 );
		$helpExport->setStyle_13_TNR ( $sheet, 'A2' . $colIndex, 'A2' . $colIndex );
		$sheet->setCellValue ( 'A3', 'KẾT QUẢ KHÁM THAI' );
		$sheet->mergeCellsByColumnAndRow ( 0, 3, 17, 3 );
		$helpExport->setStyle_15_TNR_B_C ( $sheet, 'A3', 'Q3' );
		$sheet->setCellValue ( 'A5', 'Số sổ:  ' . $info [0] ['Sosokhamthai'] );
		$helpExport->setStyle_13_TNR ( $sheet, 'A5' . $colIndex, 'Q9' . $colIndex );
		$sheet->mergeCellsByColumnAndRow ( 0, 5, 3, 5 );
		$sheet->setCellValue ( 'A6', 'Họ tên: ' . $info [0] ['Hoten'] );
		$sheet->mergeCellsByColumnAndRow ( 0, 6, 5, 6 );
		$sheet->setCellValue ( 'G6', 'Năm sinh: ' . $info [0] ['Namsinh'] );
		$sheet->mergeCellsByColumnAndRow ( 6, 6, 10, 6 );
		$sheet->setCellValue ( 'L6', 'Giới tính: ' . $info [0] ['Gioitinh'] );
		$sheet->mergeCellsByColumnAndRow ( 11, 6, 16, 6 );
		$sheet->setCellValue ( 'A7', 'Địa chỉ:  ' . $info [0] ['Tenthonto'] . '-' . $info [0] ['Tenxa'] . '-' . $info [0] ['Tenhuyen'] . '-' . $info [0] ['Tentinh'] );
		$sheet->mergeCellsByColumnAndRow ( 0, 7, 16, 7 );
		$sheet->setCellValue ( 'A9', 'KẾT QUẢ:  ' );
		$sheet->mergeCellsByColumnAndRow ( 0, 9, 16, 9 );
		$helpExport->setStyle_15_TNR ( $sheet, 'A9', 'Q9' );
		
		$rowStart = 11;
		$colStart = 'A';
		$rowIndex = $rowStart;
		$colIndex = $colStart;
		$sheet = $objPHPExcel->getActiveSheet ();
		// BEGIN set width for column
		$sheet->getColumnDimension ( 'A' )->setWidth ( 4 );
		$sheet->getColumnDimension ( 'B' )->setWidth ( 10 );
		$sheet->getColumnDimension ( 'C' )->setWidth ( 6 );
		$sheet->getColumnDimension ( 'D' )->setWidth ( 10 );
		$sheet->getColumnDimension ( 'E' )->setWidth ( 8 );
		$sheet->getColumnDimension ( 'F' )->setWidth ( 8 );
		$sheet->getColumnDimension ( 'G' )->setWidth ( 5 );
		$sheet->getColumnDimension ( 'H' )->setWidth ( 7 );
		$sheet->getColumnDimension ( 'I' )->setWidth ( 7 );
		$sheet->getColumnDimension ( 'J' )->setWidth ( 7 );
		$sheet->getColumnDimension ( 'K' )->setWidth ( 9 );
		$sheet->getColumnDimension ( 'L' )->setWidth ( 7 );
		$sheet->getColumnDimension ( 'M' )->setWidth ( 7 );
		$sheet->getColumnDimension ( 'N' )->setWidth ( 5 );
		$sheet->getColumnDimension ( 'O' )->setWidth ( 6 );
		$sheet->getColumnDimension ( 'P' )->setWidth ( 7 );
		$sheet->getColumnDimension ( 'Q' )->setWidth ( 14 );
		$sheet->getColumnDimension ( 'R' )->setWidth ( 14 );
		
		// END set width for column
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'STT', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Ngày khám', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Tuần thai', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Dự kiến ngày sinh ', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Trọng lượng mẹ', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Vòng bụng', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Cao TC', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Khung chậu', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Protein Niệu', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Huyết áp', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Tình trạng thiếu máu', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Uống viên sắt', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Đẻ thường', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Tim thai', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Ngôi thai', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Có nguy cơ', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Bác sĩ khám', $colIndex );
		$helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Ghi chú', $colIndex );
		$helpExport->setStyle_11_TNR_B_C ( $sheet, 'A11', 'R11' );
		
		// Lấy dữ liệu
		
		if (count ( $jsonObj ) > 0) {
			$tempIndex = $rowIndex + 1;
			foreach ( $jsonObj as $row ) {
				$rowIndex += 1;
				$colIndex = $colStart;
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $rowIndex - $rowStart, $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Ngaykham'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Tuanthai'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Dukienngaysinh'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Trongluongme'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Vongbung'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['CaoTC'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Khungchau'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Proteinnieu'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Huyetap'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Tinhtrangthieumau'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Uongviensat'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Dethuong'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Timthai'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Ngoithai'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Conguyco'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Nhansu'], $colIndex );
				$helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Ghichu'], $colIndex );
			}
			$helpExport->setStyle_11_TNR ( $sheet, 'A' . $tempIndex, 'R' . $rowIndex );
			$helpExport->setStyle_Align_Center ( $sheet, $colStart . $rowStart, 'M' . $rowIndex );
		}
		$sheet->getStyle ( 'A' . $rowStart . ':' . 'R' . $rowIndex )->getBorders ()->getOutline ()->setBorderStyle ( PHPExcel_Style_Border::BORDER_THIN );
		$sheet->getStyle ( 'A' . $rowStart . ':' . 'R' . $rowIndex )->getBorders ()->getInside ()->setBorderStyle ( PHPExcel_Style_Border::BORDER_THIN );
		$objPHPExcel->getActiveSheet ()->setTitle ( 'Page 1' );
		
		$rowIndex += 2;
		$sheet->setCellValue ( 'M' . $rowIndex, 'Ngày... tháng... năm ' . $this->_Namhoatdong );
		$helpExport->setStyle_11_TNR_N_C ( $sheet, 'M' . $rowIndex, 'M' . $rowIndex );
		$sheet->mergeCellsByColumnAndRow ( 12, $rowIndex, 16, $rowIndex );
		$rowIndex += 1;
		$sheet->setCellValue ( 'M' . $rowIndex, 'Nhân viên in phiếu:' );
		$helpExport->setStyle_11_TNR_B_C ( $sheet, 'M' . $rowIndex, 'M' . $rowIndex );
		$sheet->mergeCellsByColumnAndRow ( 12, $rowIndex, 16, $rowIndex );
		$rowIndex += 1;
		$sheet->setCellValue ( 'M' . $rowIndex, '(Ký tên)' );
		$helpExport->setStyle_11_TNR_I_C ( $sheet, 'M' . $rowIndex, 'M' . $rowIndex );
		$sheet->mergeCellsByColumnAndRow ( 12, $rowIndex, 16, $rowIndex );
		$objPHPExcel->getActiveSheet ()->setTitle ( 'Người in phiếu' );
		
		$objPHPExcel->setActiveSheetIndex ( 0 );
		/* Redirect output to a clientâ€™s web browser (Excel5) */
		
		$objPHPExcel->getActiveSheet ()->getPageSetup ()->setOrientation ( PHPExcel_Worksheet_PageSetup::ORIENTATION_LANDSCAPE );
		$objPHPExcel->getActiveSheet ()->getPageSetup ()->setPaperSize ( PHPExcel_Worksheet_PageSetup::PAPERSIZE_A4 );
		$pageMargin = $sheet->getPageMargins ();
		$pageMargin->setLeft ( .3 );
		$pageMargin->setRight ( .2 );
		$pageMargin->setTop ( .5 );
		$f = 'example.html';
		$objWriter = PHPExcel_IOFactory::createWriter ( $objPHPExcel, 'HTML' );
		$objWriter->save ( 'public/media/temp/' . $f );
		echo file_get_contents ( 'public/media/temp/' . $f );
	}
	
	/**
	 * Phadh
	 * Tao file xem truoc bao cao
	 * Danh sach pha thai
	 */
	public function printviewdsphathaiAction() {
		$this->_helper->layout ()->disableLayout ();
		$helpExport = new HelpFuncExportExcel ();
		$objReader = PHPExcel_IOFactory::createReader ( "Excel5" );
		$colIndex = '';
		$rowIndex = 0;
		
		$shoten = $this->_getParam ( 'sHt' );
		$sThonto = $this->_getParam ( 'sThonto' );
		$sngaypha = $this->_getParam ( 'sNp' );
		$snguoikham = $this->_getParam ( 'sNs' );
		$ssocon = $this->_getParam ( 'sSc' );
		if ($sngaypha != '') {
			$sngaypha = $this->convertDateSearch ( $sngaypha );
		}
		$objPHPExcel = new PHPExcel ();
		$sheet = $objPHPExcel->getActiveSheet ();
		/*
		 * Bắt đầu set các giá trị, căn chỉnh style Bắt đầu set các giá trị
		 * tĩnh.
		 */
		$sheet->setCellValue ( 'A2', $this->TblThongtincoquanbyId [0] ['Tencoquan'] );
		$sheet->mergeCellsByColumnAndRow ( 0, 2, 6, 2 );
		$helpExport->setStyle_13_TNR_B_L ( $sheet, 'A2', 'C2' );
		$sheet->setCellValue ( 'A4', 'DANH SÁCH PHÁ THAI' );
		$helpExport->setStyle_15_TNR_B_C ( $sheet, 'A4' . $colIndex, 'A4' . $colIndex );
		$sheet->mergeCellsByColumnAndRow ( 0, 4, 6, 4 );
		
		$sheet->setCellValue ( 'A5', '' );
		$sheet->mergeCellsByColumnAndRow ( 0, 5, 4, 5 );
		
		$rowStart = 6;
		$colStart = 'A';
		$rowIndex = $rowStart;
		$colIndex = $colStart;
		$sheet = $objPHPExcel->getActiveSheet ();
		// BEGIN set width for column
		$sheet->getColumnDimension ( 'A' )->setWidth ( 6 );
		$sheet->getColumnDimension ( 'B' )->setWidth ( 25 );
		$sheet->getColumnDimension ( 'C' )->setWidth ( 15 );
		$sheet->getColumnDimension ( 'D' )->setWidth ( 15 );
		$sheet->getColumnDimension ( 'E' )->setWidth ( 15 );
		$sheet->getColumnDimension ( 'F' )->setWidth ( 10 );
		$sheet->getColumnDimension ( 'G' )->setWidth ( 25 );
		
		// END set width for column
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'STT', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Họ tên', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Ngày phá', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Số con hiện có', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Xét nghiệm thai', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Tuần thai', $colIndex );
		$helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Bác sĩ khám', $colIndex );
		$helpExport->setStyle_13_TNR_B_C ( $sheet, $colStart . $rowIndex, $colIndex . $rowIndex );
		// Lấy dữ liệu
		$sort = isset ( $_POST ['sort'] ) ? strval ( $_POST ['sort'] ) : 'Id';
		$order = isset ( $_POST ['order'] ) ? strval ( $_POST ['order'] ) : 'desc';
		
		$jsonObj = $this->_MPhathai->getDs ( $sThonto, $shoten, $sngaypha, $snguoikham, $ssocon, $sort, $order, $this->TblThongtincoquanbyId [0] ['Id'], $this->TblThongtincoquanbyId [0] ['Namhoatdong'] );
		
		if (count ( $jsonObj ) > 0) {
			$tempIndex = $rowIndex + 1;
			foreach ( $jsonObj as $row ) {
				$rowIndex += 1;
				$colIndex = $colStart;
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $rowIndex - $rowStart, $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Hoten'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Ngaypha'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Soconhienco'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Xetnghiemthai'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Tuanthai'], $colIndex );
				$helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Nhansu'], $colIndex );
			}
			$helpExport->setStyle_13_TNR ( $sheet, 'A' . $tempIndex, 'G' . $rowIndex );
			$helpExport->setStyle_Align_Center ( $sheet, $colStart . $rowStart, $colStart . $rowIndex );
		}
		
		$sheet->getStyle ( 'A' . $rowStart . ':' . 'G' . $rowIndex )->getBorders ()->getOutline ()->setBorderStyle ( PHPExcel_Style_Border::BORDER_THIN );
		$sheet->getStyle ( 'A' . $rowStart . ':' . 'G' . $rowIndex )->getBorders ()->getInside ()->setBorderStyle ( PHPExcel_Style_Border::BORDER_THIN );
		
		$rowIndex += 2;
		$sheet->setCellValue ( 'E' . $rowIndex, 'Tổng số người phá thai: ' . (count ( $jsonObj )) );
		$helpExport->setStyle_13_TNR_B_C ( $sheet, 'E' . ($rowIndex - 1), 'E' . $rowIndex );
		$sheet->mergeCellsByColumnAndRow ( 4, $rowIndex, 6, $rowIndex );
		$rowIndex += 2;
		$sheet->setCellValue ( 'F' . $rowIndex, 'Ngày... tháng... năm ' . $this->TblThongtincoquanbyId [0] ['Namhoatdong'] );
		$helpExport->setStyle_13_TNR_N_C ( $sheet, 'F' . $rowIndex, 'G' . $rowIndex );
		$sheet->mergeCellsByColumnAndRow ( 5, $rowIndex, 6, $rowIndex );
		$rowIndex += 1;
		$sheet->setCellValue ( 'F' . $rowIndex, 'Nhân viên in' );
		$helpExport->setStyle_13_TNR_B_C ( $sheet, 'F' . $rowIndex, 'G' . $rowIndex );
		$sheet->mergeCellsByColumnAndRow ( 5, $rowIndex, 6, $rowIndex );
		$rowIndex += 1;
		$sheet->setCellValue ( 'F' . $rowIndex, '(Ký tên)' );
		$helpExport->setStyle_13_TNR_I_C ( $sheet, 'F' . $rowIndex, 'G' . $rowIndex );
		$sheet->mergeCellsByColumnAndRow ( 5, $rowIndex, 6, $rowIndex );
		$objPHPExcel->getActiveSheet ()->setTitle ( 'DS phá thai' );
		$f = 'example.html';
		$objWriter = PHPExcel_IOFactory::createWriter ( $objPHPExcel, 'HTML' );
		$objWriter->save ( 'public/media/temp/' . $f );
		echo file_get_contents ( 'public/media/temp/' . $f );
	}
	
	/**
	 * Phadh
	 * Tao file xem truoc bao cao
	 * Chi tiet pha thai
	 */
	public function printviewchitietphathaiAction() {
		$this->_helper->layout ()->disableLayout ();
		$helpExport = new HelpFuncExportExcel ();
		// $maphieusieuam = 11;
		$manhansu = $this->_getParam ( 'Manhansu' );
		$objReader = PHPExcel_IOFactory::createReader ( "Excel5" );
		$colIndex = '';
		$rowIndex = 0;
		$objPHPExcel = new PHPExcel ();
		$sheet = $objPHPExcel->getActiveSheet ();
		/*
		 * Bắt đầu set các giá trị, căn chỉnh style Bắt đầu set các giá trị
		 * tĩnh.
		 */
		$sheet->setCellValue ( 'A1', $this->TblThongtincoquanbyId [0] ['Tencoquan'] );
		$helpExport->setStyle_13_TNR ( $sheet, 'A1', 'B1' );
		$sheet->setCellValue ( 'A4', 'CHI TIẾT PHIẾU PHÁ THAI' );
		$helpExport->setStyle_15_TNR_B_C ( $sheet, 'A4' . $colIndex, 'A4' . $colIndex );
		$sheet->mergeCellsByColumnAndRow ( 0, 4, 1, 4 );
		$sheet->setCellValue ( 'A5', '' );
		$sheet->mergeCellsByColumnAndRow ( 0, 5, 1, 5 );
		
		$rowStart = 6;
		$colStart = 'A';
		$rowIndex = $rowStart;
		$colIndex = $colStart;
		$sheet = $objPHPExcel->getActiveSheet ();
		// BEGIN set width for column
		$sheet->getColumnDimension ( 'A' )->setWidth ( 40 );
		$sheet->getColumnDimension ( 'B' )->setWidth ( 35 );
		
		// Lấy dữ liệu
		
		$jsonObj = $this->_MPhathai->getObjById ( $manhansu );
		$formatIndex = $rowIndex + 1;
		if (count ( $jsonObj ) > 0) {
			$data [0] = array (
					'Họ và tên: ' . $jsonObj [0] ['Hoten'],
					'Sinh năm: ' . $jsonObj [0] ['Namsinh'] 
			);
			$data [1] = array (
					'Cán bộ phụ trách:  ' . $jsonObj [0] ['Nhansu'] 
			);
			$data [2] = array (
					'...............................................' 
			);
			$data [3] = array (
					'Xét nghiệm thai:  ' . $jsonObj [0] ['Xetnghiemthai'],
					'Tuần thai:  ' . $jsonObj [0] ['Tuanthai'] 
			);
			$data [4] = array (
					'Tình trạng hôn nhân:  ' . $jsonObj [0] ['Tinhtranghonnhan'],
					'Ngày kinh cuối:  ' . $jsonObj [0] ['Ngaykinhcuoi'] 
			);
			$data [5] = array (
					'Ngày phá:  ' . $jsonObj [0] ['Ngaypha'],
					'Số con hiện có:  ' . $jsonObj [0] ['Soconhienco'] 
			);
			$data [6] = array (
					'Phương pháp phá:  ' . $jsonObj [0] ['Phuongphappha'] 
			);
			$data [7] = array (
					'..............................................' 
			);
			$data [8] = array (
					'Kết quả soi mổ:  ' . $jsonObj [0] ['Ketquasoimo'],
					'Khám lại sau 24 tuần:  ' . $jsonObj [0] ['Khamlaisau2tuan'] 
			);
			$data [9] = array (
					'Tai biến:  ' . $jsonObj [0] ['Taibien'],
					'Chuyển tuyến:  ' . $jsonObj [0] ['Chuyentuyen'] 
			);
			$data [10] = array (
					'Ghi chú:  ' . $jsonObj [0] ['Ghichu'] 
			);
			$data [11] = array (
					'.................................................' 
			);
		} else {
			$data [0] = array (
					'Họ và tên: ' . '..................................................',
					'Sinh năm: ' . '..........................................' 
			);
			$data [1] = array (
					'Cán bộ phụ trách:  ' . '..................................................................................................' 
			);
			$data [2] = array (
					'..................................................................................................................................' 
			);
			$data [3] = array (
					'Xét nghiệm thai:  ' . '.............................................',
					'Tuần thai:  ' . '.........................................' 
			);
			$data [4] = array (
					'Tình trạng hôn nhân:  ' . '..........................................',
					'Ngày kinh cuối:  ' . '...............................' 
			);
			$data [5] = array (
					'Ngày phá:  ' . '..................................................',
					'Số con hiện có:  ' . '...............................' 
			);
			$data [6] = array (
					'Phương pháp phá:  ' . '.................................................................................................' 
			);
			$data [7] = array (
					'..................................................................................................................................' 
			);
			$data [8] = array (
					'Kết quả soi mổ:  ' . '........................................',
					'Khám lại sau 24 tuần:  ' . '......................' 
			);
			$data [9] = array (
					'Tai biến:  ' . '....................................................',
					'Chuyển tuyến:  ' . '..................................' 
			);
			$data [10] = array (
					'Ghi chú:  ' . '.................................................................................................................' 
			);
			$data [11] = array (
					'..................................................................................................................................' 
			);
		}
		
		$rowIndex = $this->initRow ( $sheet, $helpExport, $data, $rowIndex, 7 );
		$helpExport->setStyle_13_TNR ( $sheet, 'A' . $formatIndex, 'B' . $rowIndex );
		
		// $sheet->getStyle ( 'A' . $rowStart . ':' . 'K' . $rowIndex
		// )->getBorders ()->getOutline ()->setBorderStyle (
		// PHPExcel_Style_Border::BORDER_THIN );
		// $sheet->getStyle ( 'A' . $rowStart . ':' . 'K' . $rowIndex
		// )->getBorders ()->getInside ()->setBorderStyle (
		// PHPExcel_Style_Border::BORDER_THIN );
		$objPHPExcel->getActiveSheet ()->setTitle ( 'Page 1' );
		
		$rowIndex += 2;
		$sheet->setCellValue ( 'B' . $rowIndex, 'Ngày... tháng... năm ' . $this->TblThongtincoquanbyId [0] ['Namhoatdong'] );
		$helpExport->setStyle_13_TNR_N_C ( $sheet, 'B' . $rowIndex, 'B' . $rowIndex );
		$rowIndex += 1;
		$sheet->setCellValue ( 'B' . $rowIndex, 'Nhân viên in phiếu' );
		$helpExport->setStyle_13_TNR_B_C ( $sheet, 'B' . $rowIndex, 'B' . $rowIndex );
		$rowIndex += 1;
		$sheet->setCellValue ( 'B' . $rowIndex, '(Ký tên)' );
		$helpExport->setStyle_13_TNR_I_C ( $sheet, 'B' . $rowIndex, 'B' . $rowIndex );
		$objPHPExcel->getActiveSheet ()->setTitle ( 'Người in phiếu' );
		
		$f = 'example.html';
		$objWriter = PHPExcel_IOFactory::createWriter ( $objPHPExcel, 'HTML' );
		$objWriter->save ( 'public/media/temp/' . $f );
		echo file_get_contents ( 'public/media/temp/' . $f );
	}
	
	/**
	 * Phadh
	 * Tao file xem truoc bao cao
	 * Danh sach sinh san
	 */
	public function printviewdssinhsanAction() {
		$this->_helper->layout ()->disableLayout ();
		$helpExport = new HelpFuncExportExcel ();
		$objReader = PHPExcel_IOFactory::createReader ( "Excel5" );
		$colIndex = '';
		$rowIndex = 0;
		$sThonto = $this->_getParam ( 'sThonto' );
		
		$Nguoibenh = $this->_getParam ( 'Nguoibenh' );
		$Ngaysinh = $this->_getParam ( 'Ngaysinh' );
		$Nguoikham = $this->_getParam ( 'Nguoikham' );
		$Noide = $this->_getParam ( 'Noide' );
		$Hinhthuc = $this->_getParam ( 'Hinhthuc' );
		
		if ($Ngaysinh != '') {
			$Ngaysinh = $this->convertDateSearch ( $Ngaysinh );
		}
		$objPHPExcel = new PHPExcel ();
		$sheet = $objPHPExcel->getActiveSheet ();
		/*
		 * Bắt đầu set các giá trị
		 */
		$sheet->setCellValue ( 'A1', $this->TblThongtincoquanbyId [0] ['Tencoquan'] );
		$sheet->mergeCellsByColumnAndRow ( 0, 1, 5, 1 );
		$helpExport->setStyle_12_TNR_B_L ( $sheet, 'A1', 'D1' );
		$sheet->setCellValue ( 'A2', 'DANH SÁCH SINH SẢN TẠI CƠ SỞ' );
		$sheet->mergeCellsByColumnAndRow ( 0, 2, 5, 2 );
		$sheet->setCellValue ( 'A3', 'Năm ' . $this->_Namhoatdong );
		$sheet->mergeCellsByColumnAndRow ( 0, 3, 5, 3 );
		$helpExport->setStyle_12_TNR_B_C ( $sheet, 'A2', 'A4' );
		
		$rowStart = 4;
		$colStart = 'A';
		$rowIndex = $rowStart;
		$colIndex = $colStart;
		$sheet = $objPHPExcel->getActiveSheet ();
		// BEGIN set width for columns
		$sheet->getColumnDimension ( 'A' )->setWidth ( 5 );
		$sheet->getColumnDimension ( 'B' )->setWidth ( 20 );
		$sheet->getColumnDimension ( 'C' )->setWidth ( 13 );
		$sheet->getColumnDimension ( 'D' )->setWidth ( 10 );
		$sheet->getColumnDimension ( 'E' )->setWidth ( 20 );
		$sheet->getColumnDimension ( 'F' )->setWidth ( 15 );
		// END set width for columns
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'STT', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Họ tên', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Ngày sinh', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Nơi sinh', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Cán bộ đỡ đẻ', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Được quản lý', $colIndex );
		
		$helpExport->setStyle_11_TNR_B_C ( $sheet, $colStart . $rowIndex, $colIndex . ($rowIndex + 1) );
		$rowIndex += 1;
		$colIndex = $colStart;
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, '1', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, '2', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, '3', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, '4', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, '5', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, '6', $colIndex );
		$helpExport->setStyle_10_TNR_I_C ( $sheet, $colStart . $rowIndex, $colIndex . $rowIndex );
		// Lấy dữ liệu
		$jsonObj = $this->_MSinhsan->getdsssObj ( $sThonto, $Nguoibenh, $Ngaysinh, $Noide, $Nguoikham, $Hinhthuc, $this->_ThongtincoquanId, $this->_Namhoatdong );
		// $data = array ();
		// $rowCount = count ( $jsonObj );
		if (count ( $jsonObj ) > 0) {
			$stt = 0;
			foreach ( $jsonObj as $row ) {
				$stt ++;
				$rowIndex += 1;
				$colIndex = $colStart;
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $stt, $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Hoten'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Ngaysinhsan'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['CSYT'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Nhansu'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Duocquanly'], $colIndex );
				$helpExport->setStyle_11_TNR_N_C ( $sheet, $colStart . $rowIndex, $colIndex . ($rowIndex + 1) );
			}
		}
		
		$sheet->getStyle ( 'A' . $rowStart . ':' . 'F' . $rowIndex )->getBorders ()->getOutline ()->setBorderStyle ( PHPExcel_Style_Border::BORDER_THIN );
		$sheet->getStyle ( 'A' . $rowStart . ':' . 'F' . $rowIndex )->getBorders ()->getInside ()->setBorderStyle ( PHPExcel_Style_Border::BORDER_THIN );
		
		$rowIndex += 2;
		$sheet->setCellValue ( 'E' . $rowIndex, 'Tổng số : ' . (count ( $jsonObj )) );
		$helpExport->setStyle_12_TNR_B_L ( $sheet, 'E' . ($rowIndex - 1), 'E' . $rowIndex );
		$sheet->mergeCellsByColumnAndRow ( 4, $rowIndex, 5, $rowIndex );
		// $helpExport->setStyle_10_TNR_I_L ( $sheet, 'A' . $rowIndex, 'R' .
		// $rowIndex );
		$objPHPExcel->getActiveSheet ()->setTitle ( 'Page 1' );
		
		/*
		 * Set active sheet index to the first sheet, so Excel opens this as the
		 * first sheet
		 */
		$objPHPExcel->setActiveSheetIndex ( 0 );
		/* Redirect output to a clientâ€™s web browser (Excel5) */
		$objPHPExcel->getActiveSheet ()->getPageSetup ()->setOrientation ( PHPExcel_Worksheet_PageSetup::ORIENTATION_PORTRAIT );
		$objPHPExcel->getActiveSheet ()->getPageSetup ()->setPaperSize ( PHPExcel_Worksheet_PageSetup::PAPERSIZE_A4 );
		$pageMargin = $sheet->getPageMargins ();
		$pageMargin->setTop ( .5 );
		$pageMargin->setLeft ( .5 );
		$pageMargin->setRight ( .5 );
		
		$f = 'example.html';
		$objWriter = PHPExcel_IOFactory::createWriter ( $objPHPExcel, 'HTML' );
		$objWriter->save ( 'public/media/temp/' . $f );
		echo file_get_contents ( 'public/media/temp/' . $f );
	}
	
	/**
	 * Phadh
	 * Tao flie xem truoc bao cao
	 * Chi tiet sinh san
	 */
	public function printviewchitietsinhsanAction() {
		$this->_helper->layout ()->disableLayout ();
		$helpExport = new HelpFuncExportExcel ();
		$id = $this->_getParam ( 'Id' );
		// $hoten = $this->_getParam('Hoten');
		$objReader = PHPExcel_IOFactory::createReader ( "Excel5" );
		$colIndex = '';
		$rowIndex = 0;
		$tencoquan = $this->TblThongtincoquanbyId [0] ['Tencoquan'];
		
		$objPHPExcel = new PHPExcel ();
		$sheet = $objPHPExcel->getActiveSheet ();
		
		$data = array ();
		$jsonObj = $this->_MSinhsan->getctssObj ( $id, $this->_ThongtincoquanId, $this->_Namhoatdong );
		
		// Bắt đầu sét các giá trị
		$sheet->setCellValue ( 'A1', '' . $tencoquan );
		$sheet->mergeCellsByColumnAndRow ( 0, 1, 2, 1 );
		$sheet->setCellValue ( 'A2', 'Năm: ' . $this->_Namhoatdong );
		$helpExport->setStyle_13_TNR_B_L ( $sheet, 'A1', 'A2' );
		
		$sheet->setCellValue ( 'A5', 'THÔNG TIN CHI TIẾT SINH SẢN CỦA SẢN PHỤ' );
		$sheet->mergeCellsByColumnAndRow ( 0, 5, 5, 5 );
		$sheet->setCellValue ( 'A6', $jsonObj [0] ['Hoten'] );
		/*
		 * $sheet->setCellValue('A7', ' fg' . ($data[0] = array( '',
		 * $jsonObj[0]['Hoten'])) );
		 */
		$sheet->mergeCellsByColumnAndRow ( 0, 6, 5, 6 );
		$helpExport->setStyle_15_TNR_B_C ( $sheet, 'A5', 'A6' );
		
		$rowStart = 7;
		$colStart = 'A';
		$rowIndex = $rowStart;
		$colIndex = $colStart;
		$sheet = $objPHPExcel->getActiveSheet ();
		// BEGIN set Width for colums
		$sheet->getColumnDimension ( 'A' )->setWidth ( 30 );
		$sheet->getColumnDimension ( 'B' )->setWidth ( 30 );
		$sheet->getColumnDimension ( 'C' )->setWidth ( 30 );
		$sheet->getColumnDimension ( 'D' )->setWidth ( 30 );
		$sheet->getColumnDimension ( 'E' )->setWidth ( 30 );
		$sheet->getColumnDimension ( 'F' )->setWidth ( 30 );
		// END set width for colums
		// Lấy dữ liệu
		
		$formatIndex = $rowIndex + 1;
		if (count ( $jsonObj ) > 0) {
			$data [0] = array (
					'Họ và tên:',
					$jsonObj [0] ['Hoten'] 
			);
			$data [1] = array (
					'Ngày sinh sản:',
					$jsonObj [0] ['Ngaysinhsan'],
					'Ghi bằng chữ:',
					'.......................................................' 
			);
			$data [2] = array (
					'Nơi sinh:',
					$jsonObj [0] ['Diadiem'] 
			);
			
			$data [3] = array (
					'Cán bộ đỡ đẻ:',
					$jsonObj [0] ['Nhansu'] 
			);
			$data [4] = array (
					'Hình thức SS:',
					$jsonObj [0] ['Hinhthucsinhsan'],
					'Tai biến SS:',
					$jsonObj [0] ['Taibiensinhsan'] 
			);
			$data [5] = array (
					'Tiêm UV đủ liều:',
					$jsonObj [0] ['Tiemuvdulieu'],
					'Được quản lý:',
					$jsonObj [0] ['Duocquanly'],
					'Tiêm K1:',
					$jsonObj [0] ['Tiemk1'] 
			);
			$data [6] = array (
					'Cân nặng:',
					$jsonObj [0] ['Cannang'],
					'Khám tuần đầu:',
					$jsonObj [0] ['Khamtuandau'] 
			);
			
			$data [7] = array (
					'Bú mẹ trong giờ đầu:',
					$jsonObj [0] ['Bumetronggiodau'],
					'Số lần có thai:',
					$jsonObj [0] ['Solancothai'] 
			);
			
			$data [8] = array (
					'KT 3 thời kỳ:',
					$jsonObj [0] ['Kiemtrabathoiky'],
					'Số con hiện có:',
					$jsonObj [0] ['Soconhienco'] 
			);
			
			$data [9] = array (
					'Khám 7->42:',
					$jsonObj [0] ['Kham7den42'],
					'Số lần đẻ:',
					$jsonObj [0] ['Solande'] 
			);
		} else {
			$data [0] = array (
					'Họ và tên:',
					'................................................................................................................' 
			);
			$data [1] = array (
					'Ngày sinh sản:',
					'..............................................................................',
					'Ghi bằng chữ:',
					'..............................................................................' 
			);
			$data [2] = array (
					'Nơi sinh:',
					'................................................................................................................' 
			);
			
			$data [3] = array (
					'Cán bộ đỡ đẻ:',
					'................................................................................................................' 
			);
			$data [4] = array (
					'Hình thức SS:',
					'..............................................................................',
					'Tai biến SS:',
					'..............................................................................' 
			);
			$data [5] = array (
					'Tiêm UV đủ liều:',
					'..............................................................................',
					'Được quản lý:',
					'..............................................................................',
					'Tiêm K1:',
					'..............................................................................' 
			);
			$data [6] = array (
					'Cân nặng:',
					'..............................................................................',
					'Khám tuần đầu:',
					'..............................................................................' 
			);
			
			$data [7] = array (
					'Bú mẹ trong giờ đầu:',
					'..............................................................................',
					'Số lần có thai:',
					'..............................................................................' 
			);
			
			$data [8] = array (
					'KT 3 thời kỳ:',
					'..............................................................................',
					'Số con hiện có:',
					'..............................................................................' 
			);
			
			$data [9] = array (
					'Khám 7->42:',
					'..............................................................................',
					'Số lần đẻ:',
					'..............................................................................' 
			);
		}
		$rowIndex = $this->initRow ( $sheet, $helpExport, $data, $rowIndex, 7 );
		$helpExport->setStyle_13_TNR ( $sheet, 'A' . $formatIndex, 'F' . $rowIndex );
		
		$rowIndex += 3;
		$sheet->setCellValue ( 'D' . $rowIndex, 'Ngày... tháng... năm...' . $this->TblThongtincoquanbyId [0] ['Namhoatdong'] );
		$sheet->mergeCellsByColumnAndRow ( 3, $rowIndex, 5, $rowIndex );
		$helpExport->setStyle_13_TNR ( $sheet, 'D' . $rowIndex, 'F' . $rowIndex );
		
		$rowIndex += 1;
		$sheet->setCellValue ( 'A' . $rowIndex, 'Người thực hiện' );
		$sheet->mergeCellsByColumnAndRow ( 3, $rowIndex, 5, $rowIndex );
		$sheet->setCellValue ( 'D' . $rowIndex, 'Người ký' );
		$helpExport->setStyle_13_TNR_B_C ( $sheet, 'A' . $rowIndex, 'F' . $rowIndex );
		$sheet->mergeCellsByColumnAndRow ( 3, $rowIndex, 5, $rowIndex );
		// $helpExport->setStyle_12_TNR_B_C($sheet, 'D23', 'F23');
		
		$rowIndex += 1;
		$sheet->setCellValue ( 'A' . $rowIndex, '(Đã ký)' );
		$sheet->mergeCellsByColumnAndRow ( 1, $rowIndex, 1, $rowIndex );
		$helpExport->setStyle_13_TNR_I_C ( $sheet, 'A' . $rowIndex, 'F' . $rowIndex );
		
		$sheet->setCellValue ( 'D' . $rowIndex, '(Đã ký)' );
		$sheet->mergeCellsByColumnAndRow ( 3, $rowIndex, 5, $rowIndex );
		
		$objPHPExcel->getActiveSheet ()->setTitle ( 'Page 1' );
		
		$f = 'example.html';
		$objWriter = PHPExcel_IOFactory::createWriter ( $objPHPExcel, 'HTML' );
		$objWriter->save ( 'public/media/temp/' . $f );
		echo file_get_contents ( 'public/media/temp/' . $f );
	}
	
	/**
	 * Phadh
	 * Tao file xem truoc bao cao
	 * Dnah sach ke hoach hoa gia dinh
	 */
	public function printviewdskhhgdAction() {
		$sort = isset ( $_POST ['sort'] ) ? strval ( $_POST ['sort'] ) : 'Id';
		$order = isset ( $_POST ['order'] ) ? strval ( $_POST ['order'] ) : 'desc';
		$this->_helper->layout ()->disableLayout ();
		$helpExport = new HelpFuncExportExcel ();
		$objReader = PHPExcel_IOFactory::createReader ( "Excel5" );
		$colIndex = '';
		$rowIndex = 0;
		
		$sgioitinh = $this->_getParam ( 'sgioitinh' );
		$sThonto = $this->_getParam ( 'sThonto' );
		
		$shoten = $this->_getParam ( 'sHt' );
		$sngaypha = $this->_getParam ( 'sNp' );
		$ssocon = $this->_getParam ( 'sSc' );
		if ($sngaypha != '') {
			$sngaypha = $this->convertDateSearch ( $sngaypha );
		}
		$objPHPExcel = new PHPExcel ();
		$sheet = $objPHPExcel->getActiveSheet ();
		/*
		 * Bắt đầu set các giá trị, căn chỉnh style Bắt đầu set các giá trị
		 * tĩnh.
		 */
		$sheet->setCellValue ( 'A2', $this->TblThongtincoquanbyId [0] ['Tencoquan'] );
		$sheet->mergeCellsByColumnAndRow ( 0, 2, 4, 2 );
		$helpExport->setStyle_13_TNR_B_L ( $sheet, 'A2' . $colIndex, 'A2' . $colIndex );
		$sheet->setCellValue ( 'A4', 'DANH SÁCH KẾ HOẠCH HÓA GIA ĐÌNH' );
		$helpExport->setStyle_15_TNR_B_C ( $sheet, 'A4' . $colIndex, 'A4' . $colIndex );
		$sheet->mergeCellsByColumnAndRow ( 0, 4, 4, 4 );
		
		$sheet->setCellValue ( 'A5', '' );
		$sheet->mergeCellsByColumnAndRow ( 0, 5, 4, 5 );
		
		$rowStart = 6;
		$colStart = 'A';
		$rowIndex = $rowStart;
		$colIndex = $colStart;
		$sheet = $objPHPExcel->getActiveSheet ();
		// BEGIN set width for column
		$sheet->getColumnDimension ( 'A' )->setWidth ( 5 );
		$sheet->getColumnDimension ( 'B' )->setWidth ( 25 );
		$sheet->getColumnDimension ( 'C' )->setWidth ( 20 );
		$sheet->getColumnDimension ( 'D' )->setWidth ( 20 );
		$sheet->getColumnDimension ( 'E' )->setWidth ( 20 );
		
		// END set width for column
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'STT', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Họ tên', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Ngày tháng', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Số con hiện có', $colIndex );
		$helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Bác sĩ khám', $colIndex );
		$helpExport->setStyle_11_TNR_B_C ( $sheet, $colStart . $rowIndex, $colIndex . ($rowIndex + 1) );
		
		// Lấy dữ liệu
		$sort = isset ( $_POST ['sort'] ) ? strval ( $_POST ['sort'] ) : 'Id';
		$order = isset ( $_POST ['order'] ) ? strval ( $_POST ['order'] ) : 'desc';
		$jsonObj = $this->_MKHHGD->getFetDs ( $sgioitinh, $sThonto, $shoten, $sngaypha, $ssocon, $sort, $order, $this->TblThongtincoquanbyId [0] ['Id'], $this->TblThongtincoquanbyId [0] ['Namhoatdong'] );
		// $tong = $this->_MKHHGD->tong ( $sgioitinh, $sThonto, $shoten,
		// $sngaypha, $ssocon, $this->TblThongtincoquanbyId [0] ['Id'],
		// $this->TblThongtincoquanbyId [0] ['Namhoatdong'] );
		
		if (count ( $jsonObj ) > 0) {
			$tempIndex = $rowIndex + 1;
			foreach ( $jsonObj as $row ) {
				$rowIndex += 1;
				$colIndex = $colStart;
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $rowIndex - $rowStart, $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Nhankhau'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Ngaythang'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Soconhienco'], $colIndex );
				$helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Hoten'], $colIndex );
				$helpExport->setStyle_11_TNR_N_C ( $sheet, $colStart . $rowIndex, $colIndex . ($rowIndex + 1) );
			}
		}
		
		$sheet->getStyle ( 'A' . $rowStart . ':' . 'E' . $rowIndex )->getBorders ()->getOutline ()->setBorderStyle ( PHPExcel_Style_Border::BORDER_THIN );
		$sheet->getStyle ( 'A' . $rowStart . ':' . 'E' . $rowIndex )->getBorders ()->getInside ()->setBorderStyle ( PHPExcel_Style_Border::BORDER_THIN );
		
		$rowIndex += 2;
		$sheet->setCellValue ( 'E' . $rowIndex, 'Tổng số người mắc bệnh: ' . (count ( $jsonObj )) );
		$helpExport->setStyle_12_TNR_B_L ( $sheet, 'E' . ($rowIndex - 1), 'E' . $rowIndex );
		$rowIndex += 2;
		$sheet->setCellValue ( 'E' . $rowIndex, 'Nhân viên in phiếu:' );
		$sheet->mergeCellsByColumnAndRow ( 5, $rowIndex, 6, $rowIndex );
		$rowIndex += 1;
		$sheet->setCellValue ( 'E' . $rowIndex, 'Ký tên' );
		$sheet->mergeCellsByColumnAndRow ( 5, $rowIndex, 6, $rowIndex );
		$helpExport->setStyleTitleTable ( $sheet, 'E' . ($rowIndex - 1), 'E' . $rowIndex );
		$objPHPExcel->getActiveSheet ()->setTitle ( 'Người in phiếu' );
		$f = 'example.html';
		$objWriter = PHPExcel_IOFactory::createWriter ( $objPHPExcel, 'HTML' );
		$objWriter->save ( 'public/media/temp/' . $f );
		echo file_get_contents ( 'public/media/temp/' . $f );
	}
	
	/**
	 * Phadh
	 * Tao file xem truoc bao cao
	 * Chi tiet ke hoach hoa gia dinh
	 */
	public function printviewchitietkhhgdAction() {
		$this->_helper->layout ()->disableLayout ();
		$helpExport = new HelpFuncExportExcel ();
		$manhansu = $this->_getParam ( 'Id' );
		$objReader = PHPExcel_IOFactory::createReader ( "Excel5" );
		$colIndex = '';
		$rowIndex = 0;
		$objPHPExcel = new PHPExcel ();
		$sheet = $objPHPExcel->getActiveSheet ();
		$this->_Ctkhhgd = new Model_Kehoachhoagiadinh ();
		$jsonObj = $this->_Ctkhhgd->getObjById ( $manhansu, $this->TblThongtincoquanbyId [0] ['Id'] );
		/*
		 * Bắt đầu set các giá trị, căn chỉnh style Bắt đầu set các giá trị
		 * tĩnh.
		 */
		$sheet->setCellValue ( 'A2', $this->TblThongtincoquanbyId [0] ['Tencoquan'] );
		$sheet->mergeCellsByColumnAndRow ( 0, 2, 1, 2 );
		$helpExport->setStyle_13_TNR_B_L ( $sheet, 'A2' . $colIndex, 'A2' . $colIndex );
		$sheet->setCellValue ( 'A4', 'CHI TIẾT PHIẾU KẾ HOẠCH HÓA GIA ĐÌNH' );
		$helpExport->setStyle_15_TNR_B_C ( $sheet, 'A4' . $colIndex, 'A4' . $colIndex );
		$sheet->mergeCellsByColumnAndRow ( 0, 4, 1, 4 );
		
		$rowStart = 6;
		$colStart = 'A';
		$rowIndex = $rowStart;
		$colIndex = $colStart;
		$sheet = $objPHPExcel->getActiveSheet ();
		// BEGIN set width for column
		$sheet->getColumnDimension ( 'A' )->setWidth ( 40 );
		$sheet->getColumnDimension ( 'B' )->setWidth ( 40 );
		
		// Lấy dữ liệu
		$formatIndex = $rowIndex + 1;
		if (count ( $jsonObj ) > 0) {
			$data [0] = array (
					'Họ và tên: ' . $jsonObj [0] ['Hoten'],
					'Giới tính: ' . $jsonObj [0] ['Gioitinh'] . '             Sinh năm: ' . $jsonObj [0] ['Ngaysinh'] 
			);
			$data [1] = array (
					'Địa chỉ:  ' . $jsonObj [0] ['Diachi'] . ', ' . $jsonObj [0] ['Tenthonto'] 
			);
			$data [2] = array (
					'..................................................' 
			);
			$data [3] = array (
					'Ngày kế hoạch:  ' . $jsonObj [0] ['Ngaythang'],
					'Số con hiện có:  ' . $jsonObj [0] ['Soconhienco'] 
			);
			$data [4] = array (
					'Cán bộ phụ trách:  ' . $jsonObj [0] ['Nhansu'] 
			);
			$data [5] = array (
					'....................................................' 
			);
			$data [6] = array (
					'Dạng thuốc:  ' . $jsonObj [0] ['Dangthuoc'],
					'Đặt DCTC:  ' . $jsonObj [0] ['DatDCTC'] 
			);
			$data [7] = array (
					'Bao cao su:  ' . $jsonObj [0] ['Baocaosu'],
					'Triệt sản:  ' . $jsonObj [0] ['Trietsan'] 
			);
			$data [8] = array (
					'Tai biến:  ' . $jsonObj [0] ['Taibien'],
					'Chuyển tuyến:  ' . $jsonObj [0] ['Chuyentuyen'] . '           Chết:  ' . $jsonObj [0] ['Chet'] 
			);
			$data [9] = array (
					'Ghi chú:  ' . $jsonObj [0] ['Ghichu'] 
			);
			$data [10] = array (
					'.......................................' 
			);
		} else {
			$data [0] = array (
					'Họ và tên: ' . '.....................................................',
					'Giới tính: ' . '...............' . 'Sinh năm: ' . '...................' 
			);
			$data [1] = array (
					'Địa chỉ:  ' . '..............................' . ', ' . '.............................................................................................' 
			);
			$data [2] = array (
					'........................................................................................................................................' 
			);
			$data [3] = array (
					'Ngày kế hoạch:  ' . '..........................................',
					'Số con hiện có:  ' . '........................................' 
			);
			$data [4] = array (
					'Cán bộ phụ trách:  ' . '...........................................................................................................' 
			);
			$data [5] = array (
					'...........................................................................................................................................' 
			);
			$data [6] = array (
					'Dạng thuốc:  ' . '...............................................',
					'Đặt DCTC:  ' . '...............................................' 
			);
			$data [7] = array (
					'Bao cao su:  ' . '................................................',
					'Triệt sản:  ' . '...................................................' 
			);
			$data [8] = array (
					'Tai biến:  ' . '....................................................',
					'Chuyển tuyến:  ' . '..................' . 'Chết:  ' . '...............' 
			);
			$data [9] = array (
					'Ghi chú:  ' . '..........................................................................................................................' 
			);
			$data [10] = array (
					'..........................................................................................................................................' 
			);
		}
		
		$rowIndex = $this->initRow ( $sheet, $helpExport, $data, $rowIndex, 7 );
		$helpExport->setStyle_13_TNR ( $sheet, 'A' . $formatIndex, 'B' . $rowIndex );
		
		// $sheet->getStyle ( 'A' . $rowStart . ':' . 'B' . $rowIndex
		// )->getBorders ()->getOutline ()->setBorderStyle (
		// PHPExcel_Style_Border::BORDER_THIN );
		// $sheet->getStyle ( 'A' . $rowStart . ':' . 'B' . $rowIndex
		// )->getBorders ()->getInside ()->setBorderStyle (
		// PHPExcel_Style_Border::BORDER_THIN );
		
		$rowIndex += 2;
		$sheet->setCellValue ( 'B' . $rowIndex, 'Ngày... tháng... năm ' . $this->TblThongtincoquanbyId [0] ['Namhoatdong'] );
		$helpExport->setStyle_13_TNR_N_C ( $sheet, 'B' . $rowIndex, 'B' . $rowIndex );
		$rowIndex += 1;
		$sheet->setCellValue ( 'B' . $rowIndex, 'Nhân viên in phiếu' );
		$helpExport->setStyleTitleTable ( $sheet, 'B' . $rowIndex, 'B' . $rowIndex );
		$helpExport->setStyle_13_TNR_B_C ( $sheet, 'B' . $rowIndex, 'B' . $rowIndex );
		$rowIndex += 1;
		$sheet->setCellValue ( 'B' . $rowIndex, '(Ký tên)' );
		$helpExport->setStyle_13_TNR_I_C ( $sheet, 'B' . $rowIndex, 'B' . $rowIndex );
		$objPHPExcel->getActiveSheet ()->setTitle ( 'Người in phiếu' );
		
		$f = 'example.html';
		$objWriter = PHPExcel_IOFactory::createWriter ( $objPHPExcel, 'HTML' );
		$objWriter->save ( 'public/media/temp/' . $f );
		echo file_get_contents ( 'public/media/temp/' . $f );
	}
	
	/**
	 * Phadh
	 * Tao file xem truoc bao cao
	 * Chi tiet uon van
	 */
	public function printviewuonvanAction() {
		$this->_helper->layout ()->disableLayout ();
		$helpExport = new HelpFuncExportExcel ();
		$maphieuuonvan = $this->_getParam ( 'Id' );
		$objReader = PHPExcel_IOFactory::createReader ( "Excel5" );
		$colIndex = '';
		$rowIndex = 0;
		
		$objPHPExcel = new PHPExcel ();
		$sheet = $objPHPExcel->getActiveSheet ();
		$uonvan = $this->_MUonvan->getCt ( $maphieuuonvan, $this->_ThongtincoquanId, $this->_Namhoatdong );
		/*
		 * Bắt đầu set các giá trị, căn chỉnh style Bắt đầu set các giá trị
		 * tĩnh.
		 */
		$sheet->setCellValue ( 'A1', $this->TblThongtincoquanbyId [0] ['Tencoquan'] );
		$helpExport->setStyle_13_TNR_B_L ( $sheet, 'A1', 'A1' );
		$sheet->mergeCellsByColumnAndRow ( 0, 1, 3, 1 );
		$sheet->setCellValue ( 'A2', 'PHIẾU TIÊM UỐN VÁN' );
		$helpExport->setStyle_15_TNR_B_C ( $sheet, 'A2', 'A2' );
		$sheet->mergeCellsByColumnAndRow ( 0, 2, 3, 2 );
		
		$sheet->setCellValue ( 'A4', 'Họ tên: ' . $uonvan [0] ['Hoten'] );
		$sheet->mergeCellsByColumnAndRow ( 0, 4, 3, 4 );
		$sheet->setCellValue ( 'A5', 'Địa chỉ: ' . $uonvan [0] ['Diachi'] );
		$sheet->mergeCellsByColumnAndRow ( 0, 5, 3, 5 );
		$sheet->setCellValue ( 'A6', 'Nơi tiêm: ' . $this->TblThongtincoquanbyId [0] ['Tencoquan'] );
		$sheet->mergeCellsByColumnAndRow ( 0, 6, 3, 6 );
		$helpExport->setStyle_13_TNR ( $sheet, 'A4' . $colIndex, 'D6' . $colIndex );
		
		$rowStart = 7;
		$colStart = 'A';
		$rowIndex = $rowStart;
		$colIndex = $colStart;
		$sheet = $objPHPExcel->getActiveSheet ();
		// BEGIN set width for column
		$sheet->getColumnDimension ( 'A' )->setWidth ( 8 );
		$sheet->getColumnDimension ( 'B' )->setWidth ( 20 );
		$sheet->getColumnDimension ( 'C' )->setWidth ( 20 );
		$sheet->getColumnDimension ( 'D' )->setWidth ( 20 );
		
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'STT', $colIndex );
		$sheet->mergeCellsByColumnAndRow ( 0, $rowIndex, 0, $rowIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Ngày tiêm', $colIndex );
		$sheet->mergeCellsByColumnAndRow ( 0, $rowIndex, 0, $rowIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Lần tiêm', $colIndex );
		$sheet->mergeCellsByColumnAndRow ( 2, $rowIndex, 2, $rowIndex );
		$helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Tháng thai', $colIndex );
		$sheet->mergeCellsByColumnAndRow ( 3, $rowIndex, 3, $rowIndex );
		
		$helpExport->setStyle_13_TNR_B_C ( $sheet, $colStart . $rowIndex, $colIndex . $rowIndex );
		
		$rowIndex += 1;
		$colIndex = $colStart;
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, '1', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, '2', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, '3', $colIndex );
		$helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, '4', $colIndex );
		$helpExport->setStyle_13_TNR_I_C ( $sheet, $colStart . $rowIndex, $colIndex . $rowIndex );
		
		// lấy dữ liệu
		$jsonObj = $this->_MUonvan->getDetailUonVan ( $maphieuuonvan, $this->_ThongtincoquanId, $this->_Namhoatdong );
		$data = array ();
		$i = 0;
		$data [$i] = array (
				'1',
				$jsonObj [$i] ['Ngaythangtiem'],
				'Lần 1',
				$jsonObj [$i] ['Thangthai'] 
		);
		for($j = 1; $j < count ( $jsonObj ); $j ++) {
			$data [$j] = array (
					$j + 1,
					$jsonObj [$j] ['Ngaythangtiem'],
					'Lần ' . ($j + 1),
					$jsonObj [$j] ['Thangthai'] 
			);
			// $helpExport->setStyle_13_TNR( $sheet, $colStart . $rowIndex,
			// $colIndex . $rowIndex );
		}
		$rowIndex = $this->initRow1 ( $sheet, $helpExport, $data, $rowIndex, 6 );
		// $helpExport->setStyle_13_TNR ( $sheet, $colStart . $rowIndex,
		// $colIndex . $rowIndex );
		
		$sheet->getStyle ( 'A' . $rowStart . ':' . 'D' . $rowIndex )->getBorders ()->getOutline ()->setBorderStyle ( PHPExcel_Style_Border::BORDER_THIN );
		$sheet->getStyle ( 'A' . $rowStart . ':' . 'D' . $rowIndex )->getBorders ()->getInside ()->setBorderStyle ( PHPExcel_Style_Border::BORDER_THIN );
		$objPHPExcel->getActiveSheet ()->setTitle ( 'Chi tiết Uốn ván' );
		$rowIndex += 2;
		$sheet->setCellValue ( 'C' . $rowIndex, 'Nhân viên in phiếu:' );
		$sheet->mergeCellsByColumnAndRow ( 2, $rowIndex, 3, $rowIndex );
		$helpExport->setStyle_13_TNR_B_C ( $sheet, 'C' . ($rowIndex - 1), 'D' . $rowIndex );
		$rowIndex += 1;
		$sheet->setCellValue ( 'C' . $rowIndex, '(Ký tên)' );
		$sheet->mergeCellsByColumnAndRow ( 2, $rowIndex, 3, $rowIndex );
		$helpExport->setStyle_13_TNR_I_C ( $sheet, 'C' . $rowIndex, 'D' . $rowIndex );
		$objPHPExcel->getActiveSheet ()->setTitle ( 'Phiếu tiêm Uốn ván' );
		$f = 'example.html';
		$objWriter = PHPExcel_IOFactory::createWriter ( $objPHPExcel, 'HTML' );
		$objWriter->save ( 'public/media/temp/' . $f );
		echo file_get_contents ( 'public/media/temp/' . $f );
	}
	public function initRow1($_sheet, $_helpExport, $_data, $_rowIndex, $_numCol) {
		$helpExport = $_helpExport;
		$sheet = $_sheet;
		$rowIndex = $_rowIndex;
		$data = $_data;
		$numCol = $_numCol;
		foreach ( $data as $item ) {
			$rowIndex += 1;
			$colIndex = 'A';
			for($i = 0; $i < $numCol; $i ++) {
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, (isset ( $item [$i] ) ? $item [$i] : ""), $colIndex );
			}
			$helpExport->setStyle_13_TNR_N_C ( $sheet, 'A' . $rowIndex, 'D' . $rowIndex );
		}
		return $rowIndex;
	}
	
	/**
	 * Phadh
	 * Tao file xem truoc bao cao
	 * Danh sach tiem chung mien dich
	 */
	public function printviewmiendichAction() {
		$this->_helper->layout ()->disableLayout ();
		$helpExport = new HelpFuncExportExcel ();
		$objReader = PHPExcel_IOFactory::createReader ( "Excel5" );
		$colIndex = '';
		$rowIndex = 0;
		
		$Hoten = $this->_getParam ( 'Hoten' );
		$Muctiemchung = $this->_getParam ( 'Muctiemchung' );
		$Ngaytiembcg = $this->_getParam ( 'Ngaytiembcg' );
		$sgioitinh = $this->_getParam ( 'sgioitinh' );
		$sThonto = $this->_getParam ( 'sThonto' );
		if ($Ngaytiembcg != '') {
			$Ngaytiembcg = $this->convertDateSearch ( $Ngaytiembcg );
		}
		
		$objPHPExcel = new PHPExcel ();
		$sheet = $objPHPExcel->getActiveSheet ();
		/*
		 * Bắt đầu set các giá trị
		 */
		$sheet->setCellValue ( 'A1', $this->TblThongtincoquanbyId [0] ['Tencoquan'] );
		$sheet->mergeCellsByColumnAndRow ( 0, 1, 5, 1 );
		$helpExport->setStyle_13_TNR_B_L ( $sheet, 'A1', 'A1' );
		$sheet->setCellValue ( 'A3', 'Danh sách nhân khẩu tiêm chủng miễn dịch tại cơ sở' );
		$sheet->mergeCellsByColumnAndRow ( 0, 3, 5, 3 );
		$helpExport->setStyle_15_TNR_B_C ( $sheet, 'A2', 'A4' );
		
		$rowStart = 6;
		$colStart = 'A';
		$rowIndex = $rowStart;
		$colIndex = $colStart;
		$sheet = $objPHPExcel->getActiveSheet ();
		// Begin set width for columns
		$sheet->getColumnDimension ( 'A' )->setWidth ( 6 );
		$sheet->getColumnDimension ( 'B' )->setWidth ( 25 );
		$sheet->getColumnDimension ( 'C' )->setWidth ( 13 );
		$sheet->getColumnDimension ( 'D' )->setWidth ( 15 );
		$sheet->getColumnDimension ( 'E' )->setWidth ( 13 );
		$sheet->getColumnDimension ( 'F' )->setWidth ( 20 );
		// END set width for colums
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'STT', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Họ tên', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Ngày sinh', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Giới tính', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Địa chỉ', $colIndex );
		$helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Ghi chú', $colIndex );
		
		$helpExport->setStyle_13_TNR_B_C ( $sheet, $colStart . $rowIndex, $colIndex . $rowIndex );
		$rowIndex += 1;
		$colIndex = $colStart;
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, '1', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, '2', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, '3', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, '4', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, '5', $colIndex );
		$helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, '6', $colIndex );
		$helpExport->setStyle_13_TNR_I_C ( $sheet, $colStart . $rowIndex, $colIndex . $rowIndex );
		// Lấy dữ liệu
		$jsonObj = $this->_MMiendich->getdstcmd ( $Hoten, $Muctiemchung, $Ngaytiembcg, $sgioitinh, $sThonto, $this->_ThongtincoquanId, $this->_Namhoatdong );
		$data = array ();
		$rowCount = count ( $jsonObj );
		if (count ( $jsonObj ) > 0) {
			for($i = 0; $i < $rowCount; $i ++) {
				$data [$i] = array (
						($i + 1),
						$jsonObj [$i] ['Hoten'],
						$jsonObj [$i] ['Ngaysinh'],
						$jsonObj [$i] ['Gioitinh'],
						$jsonObj [$i] ['Diachi'] 
				);
			}
		}
		$rowIndex = $this->initRow2 ( $sheet, $helpExport, $data, $rowIndex, 10 );
		$sheet->getStyle ( 'A' . $rowStart . ':' . 'F' . $rowIndex )->getBorders ()->getOutline ()->setBorderStyle ( PHPExcel_Style_Border::BORDER_THIN );
		$sheet->getStyle ( 'A' . $rowStart . ':' . 'F' . $rowIndex )->getBorders ()->getInside ()->setBorderStyle ( PHPExcel_Style_Border::BORDER_THIN );
		$rowIndex += 2;
		$sheet->setCellValue ( 'F' . $rowIndex, 'Tổng số: ' . (count ( $jsonObj )) );
		$helpExport->setStyle_12_TNR_B_L ( $sheet, 'F' . ($rowIndex - 1), 'F' . $rowIndex );
		$rowIndex += 2;
		$sheet->setCellValue ( 'E' . $rowIndex, 'Ngày... tháng... năm ' . $this->_Namhoatdong );
		$sheet->mergeCellsByColumnAndRow ( 4, $rowIndex, 5, $rowIndex );
		$helpExport->setStyle_13_TNR_N_C ( $sheet, $colStart . $rowIndex, $colIndex . $rowIndex );
		$rowIndex += 1;
		$sheet->setCellValue ( 'E' . $rowIndex, 'Người in' );
		$sheet->mergeCellsByColumnAndRow ( 4, $rowIndex, 5, $rowIndex );
		$helpExport->setStyle_13_TNR_B_C ( $sheet, $colStart . $rowIndex, $colIndex . $rowIndex );
		$rowIndex += 1;
		$sheet->setCellValue ( 'E' . $rowIndex, '(Ký ghi rõ họ tên)' );
		$sheet->mergeCellsByColumnAndRow ( 4, $rowIndex, 5, $rowIndex );
		$helpExport->setStyle_13_TNR_I_C ( $sheet, $colStart . $rowIndex, $colIndex . $rowIndex );
		
		// $helpExport->setStyle_10_TNR_NO_L ( $sheet, 'A8', $colIndex .
		// $rowIndex );
		// $helpExport->setStyle_10_TNR_I_L ( $sheet, 'A' . $rowIndex, 'J' .
		// $rowIndex );
		$objPHPExcel->getActiveSheet ()->setTitle ( 'Page 1' );
		
		$f = 'example.html';
		$objWriter = PHPExcel_IOFactory::createWriter ( $objPHPExcel, 'HTML' );
		$objWriter->save ( 'public/media/temp/' . $f );
		echo file_get_contents ( 'public/media/temp/' . $f );
	}
	public function initRow2($_sheet, $_helpExport, $_data, $_rowIndex, $_numCol) {
		$helpExport = $_helpExport;
		$sheet = $_sheet;
		$rowIndex = $_rowIndex;
		$data = $_data;
		$numCol = $_numCol;
		foreach ( $data as $item ) {
			$rowIndex += 1;
			$colIndex = 'A';
			for($i = 0; $i < $numCol; $i ++) {
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, (isset ( $item [$i] ) ? $item [$i] : ""), $colIndex );
			}
			$helpExport->setStyle_13_TNR ( $sheet, 'A' . $rowIndex, 'F' . $rowIndex );
		}
		return $rowIndex;
	}
	
	/**
	 * Phadh
	 * Tao file xem truoc bao cao
	 * Danh sach tiem chung mo rong
	 */
	public function printviewmorongAction() {
		$this->_helper->layout ()->disableLayout ();
		$helpExport = new HelpFuncExportExcel ();
		$Hoten = $this->_getParam ( 'Hoten' );
		
		$Lantiem = $this->_getParam ( 'Lantiem' );
		$Muctiem = $this->_getParam ( 'Muctiem' );
		$Ngaytiem = $this->_getParam ( 'Ngaytiem' );
		$sgioitinh = $this->_getParam ( 'sgioitinh' );
		$sThonto = $this->_getParam ( 'sThonto' );
		
		if ($Ngaytiem != '') {
			$Ngaytiem = $this->convertDateSearch ( $Ngaytiem );
		}
		$objReader = PHPExcel_IOFactory::createReader ( "Excel5" );
		$colIndex = '';
		$rowIndex = 0;
		
		$objPHPExcel = new PHPExcel ();
		$sheet = $objPHPExcel->getActiveSheet ();
		
		/*
		 * Bắt đầu set các giá trị
		 */
		$sheet->setCellValue ( 'A1', $this->TblThongtincoquanbyId [0] ['Tencoquan'] );
		$sheet->mergeCellsByColumnAndRow ( 0, 1, 6, 1 );
		$helpExport->setStyle_13_TNR_B_L ( $sheet, 'A1', 'A1' );
		$sheet->setCellValue ( 'A3', 'Danh sách nhân khẩu tiêm chủng mở rộng tại cơ sở ' );
		$sheet->mergeCellsByColumnAndRow ( 0, 3, 6, 3 );
		$helpExport->setStyle_15_TNR_B_C ( $sheet, 'A3', 'A3' );
		
		$rowStart = 5;
		$colStart = 'A';
		$rowIndex = $rowStart;
		$colIndex = $colStart;
		$sheet = $objPHPExcel->getActiveSheet ();
		// Begin set width for columns
		$sheet->getColumnDimension ( 'A' )->setWidth ( 5 );
		$sheet->getColumnDimension ( 'B' )->setWidth ( 22 );
		$sheet->getColumnDimension ( 'C' )->setWidth ( 10 );
		$sheet->getColumnDimension ( 'D' )->setWidth ( 15 );
		$sheet->getColumnDimension ( 'E' )->setWidth ( 22 );
		$sheet->getColumnDimension ( 'F' )->setWidth ( 25 );
		$sheet->getColumnDimension ( 'G' )->setWidth ( 25 );
		// END set width for colums
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'STT', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Họ tên', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Giới tính', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Ngày sinh', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Người tiêm', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Địa chỉ', $colIndex );
		$helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Ghi chú', $colIndex );
		
		$helpExport->setStyle_13_TNR_B_C ( $sheet, $colStart . $rowIndex, $colIndex . ($rowIndex + 1) );
		$rowIndex += 1;
		$colIndex = $colStart;
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, '1', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, '2', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, '3', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, '4', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, '5', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, '6', $colIndex );
		$helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, '7', $colIndex );
		$helpExport->setStyle_13_TNR_I_C ( $sheet, $colStart . $rowIndex, $colIndex . $rowIndex );
		// Lấy dữ liệu
		
		$jsonObj = $this->_MMorong->getdstcmrObj ( $Hoten, $Ngaytiem, $Lantiem, $Muctiem, $sgioitinh, $sThonto, $this->_ThongtincoquanId, $this->_Namhoatdong );
		$data = array ();
		$rowCount = count ( $jsonObj );
		if (count ( $jsonObj ) > 0) {
			for($i = 0; $i < $rowCount; $i ++) {
				$data [$i] = array (
						($i + 1),
						$jsonObj [$i] ['Nhankhau'],
						$jsonObj [$i] ['Gioitinh'],
						$jsonObj [$i] ['Ngaysinh'],
						$jsonObj [$i] ['Hoten'],
						$jsonObj [$i] ['Diachi'] 
				);
			}
		}
		$rowIndex = $this->initRow3 ( $sheet, $helpExport, $data, $rowIndex, 7 );
		
		$sheet->getStyle ( 'A' . $rowStart . ':' . 'G' . $rowIndex )->getBorders ()->getOutline ()->setBorderStyle ( PHPExcel_Style_Border::BORDER_THIN );
		$sheet->getStyle ( 'A' . $rowStart . ':' . 'G' . $rowIndex )->getBorders ()->getInside ()->setBorderStyle ( PHPExcel_Style_Border::BORDER_THIN );
		$rowIndex += 2;
		$sheet->setCellValue ( 'G' . $rowIndex, 'Tổng số: ' . (count ( $jsonObj )) );
		$helpExport->setStyle_12_TNR_B_L ( $sheet, 'G' . ($rowIndex - 1), 'G' . $rowIndex );
		$rowIndex += 2;
		$sheet->setCellValue ( 'F' . $rowIndex, 'Ngày... tháng... năm ' . $this->_Namhoatdong );
		$sheet->mergeCellsByColumnAndRow ( 5, $rowIndex, 6, $rowIndex );
		$helpExport->setStyle_13_TNR_N_C ( $sheet, $colStart . $rowIndex, $colIndex . $rowIndex );
		$rowIndex += 1;
		$sheet->setCellValue ( 'F' . $rowIndex, 'Người in' );
		$sheet->mergeCellsByColumnAndRow ( 5, $rowIndex, 6, $rowIndex );
		$helpExport->setStyle_13_TNR_B_C ( $sheet, $colStart . $rowIndex, $colIndex . $rowIndex );
		$rowIndex += 1;
		$sheet->setCellValue ( 'F' . $rowIndex, '(Ký ghi rõ họ tên)' );
		$sheet->mergeCellsByColumnAndRow ( 5, $rowIndex, 6, $rowIndex );
		$helpExport->setStyle_13_TNR_I_C ( $sheet, $colStart . $rowIndex, $colIndex . $rowIndex );
		
		$objPHPExcel->getActiveSheet ()->setTitle ( 'Page 1' );
		
		$f = 'example.html';
		$objWriter = PHPExcel_IOFactory::createWriter ( $objPHPExcel, 'HTML' );
		$objWriter->save ( 'public/media/temp/' . $f );
		echo file_get_contents ( 'public/media/temp/' . $f );
	}
	public function initRow3($_sheet, $_helpExport, $_data, $_rowIndex, $_numCol) {
		$helpExport = $_helpExport;
		$sheet = $_sheet;
		$rowIndex = $_rowIndex;
		$data = $_data;
		$numCol = $_numCol;
		foreach ( $data as $item ) {
			$rowIndex += 1;
			$colIndex = 'A';
			for($i = 0; $i < $numCol; $i ++) {
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, (isset ( $item [$i] ) ? $item [$i] : ""), $colIndex );
			}
			$helpExport->setStyle_13_TNR ( $sheet, 'A' . $rowIndex, $colIndex . $rowIndex );
		}
		return $rowIndex;
	}
	
	/**
	 * Phadh
	 * Tao fiel xem truoc bao cao
	 * Danh sach chuye vien
	 */
	public function printviewdschuyenvienAction() {
		$this->_helper->layout ()->disableLayout ();
		$helpExport = new HelpFuncExportExcel ();
		$Phieukham = $this->_getParam ( 'Phieukham' );
		$Nhansu = $this->_getParam ( 'Nhansu' );
		$Noiden = $this->_getParam ( 'Noiden' );
		$Ngaychuyen = $this->_getParam ( 'Ngaychuyenvien' );
		if ($Ngaychuyen != '') {
			$Ngaychuyen = $this->convertDateSearch ( $Ngaychuyen );
		}
		$objReader = PHPExcel_IOFactory::createReader ( "Excel5" );
		$colIndex = '';
		$rowIndex = 0;
		
		$objPHPExcel = new PHPExcel ();
		$sheet = $objPHPExcel->getActiveSheet ();
		/*
		 * Bắt đầu set các giá trị
		 */
		
		$sheet->setCellValue ( 'A1', $this->TblThongtincoquanbyId [0] ['Tencoquan'] );
		$sheet->mergeCellsByColumnAndRow ( 0, 1, 1, 1 );
		$sheet->setCellValue ( 'A2', 'DANH SÁCH BỆNH NHÂN CHUYỂN VIỆN' );
		$sheet->mergeCellsByColumnAndRow ( 0, 2, 5, 2 );
		$sheet->setCellValue ( 'A3', 'Năm ' . $this->_Namhoatdong );
		$sheet->mergeCellsByColumnAndRow ( 0, 3, 5, 3 );
		$helpExport->setStyle_15_TNR_B_C ( $sheet, 'A2', 'A3' );
		$helpExport->setStyle_13_TNR_B_L ( $sheet, 'A1', 'A1' );
		
		$rowStart = 5;
		$colStart = 'A';
		$rowIndex = $rowStart;
		$colIndex = $colStart;
		$sheet = $objPHPExcel->getActiveSheet ();
		// Begin set width for columns
		$sheet->getColumnDimension ( 'A' )->setWidth ( 6 );
		$sheet->getColumnDimension ( 'B' )->setWidth ( 20 );
		$sheet->getColumnDimension ( 'C' )->setWidth ( 13 );
		$sheet->getColumnDimension ( 'D' )->setWidth ( 15 );
		$sheet->getColumnDimension ( 'E' )->setWidth ( 15 );
		$sheet->getColumnDimension ( 'F' )->setWidth ( 15 );
		$sheet->getRowDimension ( '2' )->setRowHeight ( 30 );
		// End set width for columns'
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'STT', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Họ tên', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Ngày chuyển viện', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Nơi đến', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Người duyệt', $colIndex );
		$helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Lý do chuyển', $colIndex );
		
		$helpExport->setStyle_11_TNR_B_C ( $sheet, $colStart . $rowIndex, $colIndex . $rowIndex );
		$rowIndex += 1;
		$colIndex = $colStart;
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, '1', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, '2', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, '3', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, '4', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, '5', $colIndex );
		$helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, '6', $colIndex );
		$helpExport->setStyle_10_TNR_I_C ( $sheet, $colStart . $rowIndex, $colIndex . $rowIndex );
		// lấy dữ liệu
		$jsonObj = $this->_MChuyenvien->getdscvObj ( $Phieukham, $Nhansu, $Noiden, $Ngaychuyen, $this->_ThongtincoquanId, $this->_Namhoatdong );
		$data = array ();
		$rowCount = count ( $jsonObj );
		if ($rowCount > 0) {
			for($i = 0; $i < $rowCount; $i ++) {
				$data [$i] = array (
						($i + 1),
						$jsonObj [$i] ['Benhnhan'],
						$jsonObj [$i] ['Ngaychuyenvien'],
						$jsonObj [$i] ['Noiden'],
						$jsonObj [$i] ['Nhansu'],
						$jsonObj [$i] ['Lydochuyen'] 
				);
			}
		}
		// $rowIndex += 1;
		$rowIndex = $this->initRow4 ( $sheet, $helpExport, $data, $rowIndex, 6 );
		$helpExport->setStyle_11_TNR_N_C ( $sheet, $colStart . ($rowIndex - ($rowCount - 1)), $colIndex . $rowIndex );
		// $helpExport->setStyle_13_TNR ( $sheet, 'A' . $rowIndex, 'F' .
		// $rowIndex );
		
		$sheet->getStyle ( 'A' . $rowStart . ':' . 'F' . $rowIndex )->getBorders ()->getOutline ()->setBorderStyle ( PHPExcel_Style_Border::BORDER_THIN );
		$sheet->getStyle ( 'A' . $rowStart . ':' . 'F' . $rowIndex )->getBorders ()->getInside ()->setBorderStyle ( PHPExcel_Style_Border::BORDER_THIN );
		$rowIndex += 2;
		$sheet->setCellValue ( 'F' . $rowIndex, 'Tổng số: ' . (count ( $jsonObj )) );
		$helpExport->setStyle_12_TNR_B_L ( $sheet, 'F' . ($rowIndex - 1), 'F' . $rowIndex );
		$objPHPExcel->getActiveSheet ()->setTitle ( 'Page 1' );
		
		/*
		 * Set active sheet index to the first sheet, so Excel opens this as the
		 * first sheet
		 */
		$objPHPExcel->setActiveSheetIndex ( 0 );
		/* Redirect output to a clientâ€™s web browser (Excel5) */
		$objPHPExcel->getActiveSheet ()->getPageSetup ()->setOrientation ( PHPExcel_Worksheet_PageSetup::ORIENTATION_PORTRAIT );
		$objPHPExcel->getActiveSheet ()->getPageSetup ()->setPaperSize ( PHPExcel_Worksheet_PageSetup::PAPERSIZE_A4 );
		$pageMargin = $sheet->getPageMargins ();
		$pageMargin->setTop ( .5 );
		$pageMargin->setLeft ( .61 );
		$pageMargin->setRight ( .37 );
		$f = 'example.html';
		$objWriter = PHPExcel_IOFactory::createWriter ( $objPHPExcel, 'HTML' );
		$objWriter->save ( 'public/media/temp/' . $f );
		echo file_get_contents ( 'public/media/temp/' . $f );
	}
	public function initRow4($_sheet, $_helpExport, $_data, $_rowIndex, $_numCol) {
		$helpExport = $_helpExport;
		$sheet = $_sheet;
		$rowIndex = $_rowIndex;
		$data = $_data;
		$numCol = $_numCol;
		foreach ( $data as $item ) {
			$rowIndex += 1;
			$colIndex = 'A';
			for($i = 0; $i < $numCol; $i ++) {
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, (isset ( $item [$i] ) ? $item [$i] : ""), $colIndex );
			}
		}
		return $rowIndex;
	}
	
	/**
	 * Phadh
	 * Tao file xem truoc bao cao
	 * Giay chuyen vien
	 */
	public function printviewchitietchuyenvienAction() {
		$this->_helper->layout ()->disableLayout ();
		$helpExport = new HelpFuncExportExcel ();
		$id = $this->_getParam ( 'id' );
		$objReader = PHPExcel_IOFactory::createReader ( "Excel5" );
		$colIndex = '';
		$rowIndex = 0;
		
		$objPHPExcel = new PHPExcel ();
		$sheet = $objPHPExcel->getActiveSheet ();
		
		$jsonObj = $this->_MGiaychuyenvien->getFetObj ( $id, $this->_ThongtincoquanId, $this->_Namhoatdong );
		$objPHPExcel = $objReader->load ( "public/media/temp/giaychuyenvien.xls" );
		$sheet = $objPHPExcel->getActiveSheet ();
		
		foreach ( $jsonObj as $row ) {
			$sheet->setCellValue ( "A" . "1", $this->TblThongtincoquanbyId [0] ['Tencoquan'] );
			$sheet->setCellValue ( "A" . "2", $jsonObj [0] ['Tencoquan'] );
			$sheet->setCellValue ( "C" . "7", $jsonObj [0] ['Noiden'] );
			$sheet->setCellValue ( "C" . "11", $jsonObj [0] ['Hoten'] );
			$sheet->setCellValue ( "G" . "11", $jsonObj [0] ['Namsinh'] );
			$sheet->setCellValue ( "I" . "11", $jsonObj [0] ['Gioitinh'] );
			$sheet->setCellValue ( "C" . "12", $jsonObj [0] ['Dantoc'] );
			$sheet->setCellValue ( "C" . "13", $jsonObj [0] ['Nghenghiep'] );
			$sheet->setCellValue ( "H" . "14", "Số : " . $jsonObj [0] ['Sobaohiem'] );
			$sheet->setCellValue ( "C" . "15", $jsonObj [0] ['Thonto'] . "-" . $jsonObj [0] ['Tenxa'] . "-" . $jsonObj [0] ['Tenhuyen'] . "-" . $jsonObj [0] ['Tentinh'] );
			$sheet->setCellValue ( "D" . "16", $this->TblThongtincoquanbyId [0] ['Tencoquan'] );
			$sheet->setCellValue ( "B" . "17", $jsonObj [0] ['Ngayvaovien'] );
			$sheet->setCellValue ( "F" . "17", $jsonObj [0] ['Ngaychuyenvien'] );
			$sheet->setCellValue ( "C" . "20", $jsonObj [0] ['Dauhieulamsang'] );
			
			$sheet->setCellValue ( "C" . "21", $jsonObj [0] ['Tenmucxetnghiem'] );
			$sheet->setCellValue ( "E" . "24", $jsonObj [0] ['Tinhtranglucchuyen'] );
			$sheet->setCellValue ( "D" . "28", $jsonObj [0] ['Phuongtien'] );
			
			$sheet->setCellValue ( "C" . "22", $jsonObj [0] ['Chuandoan'] );
			$sheet->setCellValue ( "C" . "23", $jsonObj [0] ['Tenthuoc'] );
			$sheet->setCellValue ( "C" . "25", $jsonObj [0] ['Lydochuyen'] );
			$sheet->setCellValue ( "E" . "27", $jsonObj [0] ['Ngay'] );
			$sheet->setCellValue ( "G" . "27", $jsonObj [0] ['Thang'] );
			$sheet->setCellValue ( "I" . "27", $jsonObj [0] ['Nam'] );
			$sheet->setCellValue ( "B" . "35", $jsonObj [0] ['Nhansu'] );
			$sheet->setCellValue ( "A" . "10", $jsonObj [0] ['Tencoquan'] . " Xin trân trọng giới thiệu" );
		}
		
		$f = 'example.html';
		$objWriter = PHPExcel_IOFactory::createWriter ( $objPHPExcel, 'HTML' );
		$objWriter->save ( 'public/media/temp/' . $f );
		echo file_get_contents ( 'public/media/temp/' . $f );
	}
	public function initRow5($_sheet, $_helpExport, $_data, $_rowIndex, $_numCol) {
		$helpExport = $_helpExport;
		$sheet = $_sheet;
		$rowIndex = $_rowIndex;
		$data = $_data;
		$numCol = $_numCol;
		foreach ( $data as $item ) {
			$rowIndex += 1;
			$colIndex = 'A';
			for($i = 0; $i < $numCol; $i ++) {
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, (isset ( $item [$i] ) ? $item [$i] : ""), $colIndex );
			}
		}
		return $rowIndex;
	}
	
	/**
	 * Phadh
	 * tao file xem truoc bao cao
	 * Chi tiet giay khai tu
	 */
	
	/**
	 * Phadh
	 * Tao file xem truoc bao cao
	 * danh sach dao tao can bo y te
	 */
	public function printviewdaotaonhansuAction(){
		$this->_helper->layout ()->disableLayout ();
		$helpExport = new HelpFuncExportExcel ();
		$objReader = PHPExcel_IOFactory::createReader ( "Excel5" );
		$shoten = $this->_getParam('shoten');
		$sTungay = $this->_getParam('sTungay');
		$sDenngay = $this->_getParam('sDenngay');
		$sNoidung = $this->_getParam('sNoidung');
		$sNoidaotao = $this->_getParam('sNoidaotao');
		if($sTungay != ''){
			$sTungay = $this->convertDateSearch($sTungay);
		}
		if($sDenngay != ''){
			$sDenngay = $this->convertDateSearch($sDenngay);
		}
		$colIndex = '0';
		$rowIndex = '';
		$objPHPExcel = new PHPExcel ();
		$sheet = $objPHPExcel->getActiveSheet ();
		/* Set cac gia tri tinh*/
		$sheet->setCellValue('A1', $this->TblThongtincoquanbyId[0]['Tencoquan']);
		$sheet->mergeCellsByColumnAndRow(0, 1, 3, 1);
		$helpExport->setStyle_13_TNR_B_L($sheet, 'A1', 'A1');
		$sheet->setCellValue('A3', 'DANH SÁCH TẠO CÁN BỘ Y TÊ');
		$sheet->mergeCellsByColumnAndRow(0, 3, 7, 3);
		$helpExport->setStyle_15_TNR_B_C($sheet, 'A3', 'A3');
		
		$rowStart = 5;
		$colStart = 'A';
		$rowIndex = $rowStart;
		$colIndex = $colStart;
		$sheet = $objPHPExcel->getActiveSheet ();
		// BEGIN set width for column
		$sheet->getColumnDimension ( 'A' )->setWidth ( 5 );
		$sheet->getColumnDimension ( 'B' )->setWidth ( 15 );
		$sheet->getColumnDimension ( 'C' )->setWidth ( 15 );
		$sheet->getColumnDimension ( 'D' )->setWidth ( 15 );
		$sheet->getColumnDimension ( 'E' )->setWidth ( 20 );
		$sheet->getColumnDimension ( 'F' )->setWidth ( 20 );
		$sheet->getColumnDimension ( 'G' )->setWidth ( 20 );
		$sheet->getColumnDimension ( 'H' )->setWidth ( 20 );
		
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'STT', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Họ và tên', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Từ ngày', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Đến ngày', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Nội dung', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Kết quả', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Nơi đào tạo', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Ghi chú', $colIndex );
		$helpExport->setStyle_11_TNR_B_C ( $sheet, $colStart . $rowIndex, $colIndex . ($rowIndex + 1) );
		
		$jsonObj = $this->_MDaotaonhansu->getds($shoten, $sTungay, $sDenngay, $sNoidung, $sNoidaotao, $this->_ThongtincoquanId, $this->_Namhoatdong);
		if(count($jsonObj) > 0){
			$stt = 0;
			foreach ($jsonObj as $row){
				$stt ++;
				$rowIndex += 1;
				$colIndex = $colStart;
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $stt, $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Nhansu'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Tungay'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Denngay'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Noidung'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Ketqua'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Noidaotao'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Ghichu'], $colIndex );
				$helpExport->setStyle_11_TNR_N_L ( $sheet, $colStart . $rowIndex, $colIndex . $rowIndex );
				$helpExport->setStyle_Align_Center ( $sheet, 'A' . $rowIndex, 'A' . $rowIndex );
				$helpExport->setStyle_Align_Center ( $sheet, 'C' . $rowIndex, 'D' . $rowIndex );
			}
		}
		
		$sheet->getStyle ( 'A' . $rowStart . ':' . 'H' . $rowIndex )->getBorders ()->getOutline ()->setBorderStyle ( PHPExcel_Style_Border::BORDER_THIN );
		$sheet->getStyle ( 'A' . $rowStart . ':' . 'H' . $rowIndex )->getBorders ()->getInside ()->setBorderStyle ( PHPExcel_Style_Border::BORDER_THIN );
		
		$objPHPExcel->getActiveSheet ()->getPageSetup ()->setOrientation ( PHPExcel_Worksheet_PageSetup::ORIENTATION_LANDSCAPE );
		$objPHPExcel->getActiveSheet ()->getPageSetup ()->setPaperSize ( PHPExcel_Worksheet_PageSetup::PAPERSIZE_A4 );
		$pageMargin = $sheet->getPageMargins ();
		$pageMargin->setTop ( .5 );
		$pageMargin->setLeft ( .7 );
		$pageMargin->setRight ( .7 );
		$f = 'example.html';
		$objWriter = PHPExcel_IOFactory::createWriter ( $objPHPExcel, 'HTML' );
		$objWriter->save ( 'public/media/temp/' . $f );
		echo file_get_contents ( 'public/media/temp/' . $f );
	}
	
	/**
	 * Phadh
	 * tao file xem truoc bao cao
	 * danh sach thuoc du tru bao hiem
	 */
	public function printviewdutruthuocAction(){
		$this->_helper->layout ()->disableLayout ();
		$helpExport = new HelpFuncExportExcel ();
		$objReader = PHPExcel_IOFactory::createReader ( "Excel5" );
		$sTenthuoc = $this->_getParam('sTenthuoc');
		$sNgaydutru = $this->_getParam('sNgaydutru');
		$sNuocsanxuat = $this->_getParam('sNuocsanxuat');
		if($sNgaydutru != ''){
			$sNgaydutru = $this->convertDateSearch($sNgaydutru);
		}
		$colIndex = '0';
		$rowIndex = '';
		$objPHPExcel = new PHPExcel ();
		$sheet = $objPHPExcel->getActiveSheet ();
		/* Set cac gia tri tinh*/
		$sheet->setCellValue('A1', $this->TblThongtincoquanbyId[0]['Tencoquan']);
		$sheet->mergeCellsByColumnAndRow(0, 1, 3, 1);
		$helpExport->setStyle_13_TNR_B_L($sheet, 'A1', 'A1');
		$sheet->setCellValue('A3', 'DANH SÁCH DỰ TRÙ THUỐC BẢO HIỂM');
		$sheet->mergeCellsByColumnAndRow(0, 3, 6, 3);
		$helpExport->setStyle_15_TNR_B_C($sheet, 'A3', 'A3');
		
		$rowStart = 5;
		$colStart = 'A';
		$rowIndex = $rowStart;
		$colIndex = $colStart;
		$sheet = $objPHPExcel->getActiveSheet ();
		// BEGIN set width for column
		$sheet->getColumnDimension ( 'A' )->setWidth ( 5 );
		$sheet->getColumnDimension ( 'B' )->setWidth ( 15 );
		$sheet->getColumnDimension ( 'C' )->setWidth ( 15 );
		$sheet->getColumnDimension ( 'D' )->setWidth ( 20 );
		$sheet->getColumnDimension ( 'E' )->setWidth ( 12 );
		$sheet->getColumnDimension ( 'F' )->setWidth ( 17.71 );
		$sheet->getColumnDimension ( 'G' )->setWidth ( 14.14 );
		
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'STT', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Tên thuốc', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Số lượng', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Số lượng duyệt', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Ngày dự trù', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Nước sản xuất', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Ghi chú', $colIndex );
		$helpExport->setStyle_11_TNR_B_C ( $sheet, $colStart . $rowIndex, $colIndex . ($rowIndex + 1) );
		
		$jsonObj = $this->_MDutruthuocbaohiem->getds($sTenthuoc, $sNgaydutru, $sNuocsanxuat, $this->_ThongtincoquanId, $this->_Namhoatdong);
		if(count($jsonObj) > 0){
			$stt = 0;
			foreach ($jsonObj as $row){
				$stt ++;
				$rowIndex += 1;
				$colIndex = $colStart;
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $stt, $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Thuoc'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Soluong'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Soluongduyet'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Ngaydutru'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Nuocsanxuat'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Ghichu'], $colIndex );
				$helpExport->setStyle_11_TNR_N_L ( $sheet, $colStart . $rowIndex, $colIndex . $rowIndex );
				$helpExport->setStyle_Align_Center ( $sheet, 'A' . $rowIndex, 'A' . $rowIndex );
				$helpExport->setStyle_Align_Center ( $sheet, 'E' . $rowIndex, 'F' . $rowIndex );
				$helpExport->setStyle_Align_Right ( $sheet, 'C' . $rowIndex, 'D' . $rowIndex );
			}
		}
		
		$sheet->getStyle ( 'A' . $rowStart . ':' . 'G' . $rowIndex )->getBorders ()->getOutline ()->setBorderStyle ( PHPExcel_Style_Border::BORDER_THIN );
		$sheet->getStyle ( 'A' . $rowStart . ':' . 'G' . $rowIndex )->getBorders ()->getInside ()->setBorderStyle ( PHPExcel_Style_Border::BORDER_THIN );
		
		$objPHPExcel->getActiveSheet ()->getPageSetup ()->setOrientation ( PHPExcel_Worksheet_PageSetup::ORIENTATION_PORTRAIT );
		$objPHPExcel->getActiveSheet ()->getPageSetup ()->setPaperSize ( PHPExcel_Worksheet_PageSetup::PAPERSIZE_A4 );
		$pageMargin = $sheet->getPageMargins ();
		$pageMargin->setTop ( .5 );
		$pageMargin->setLeft ( .45 );
		$pageMargin->setRight ( .2 );
		$f = 'example.html';
		$objWriter = PHPExcel_IOFactory::createWriter ( $objPHPExcel, 'HTML' );
		$objWriter->save ( 'public/media/temp/' . $f );
		echo file_get_contents ( 'public/media/temp/' . $f );
	}
	
	/**
	 * Phadh
	 * Tao file xem truoc bao cao
	 * Danh sach tai lieu chuyen mon
	 */
	public function printviewtailieuchuyenmonAction(){
		$this->_helper->layout ()->disableLayout ();
		$helpExport = new HelpFuncExportExcel ();
		$objReader = PHPExcel_IOFactory::createReader ( "Excel5" );
		$sTentailieu = $this->_getParam('sTentailieu');
		$sNgaycap = $this->_getParam('sNgaycap');
		$sDonvicap = $this->_getParam('sDonvicap');
		$sNhaxuatban = $this->_getParam('sNhaxuatban');
		if($sNgaycap != ''){
			$sNgaycap = $this->convertDateSearch($sNgaycap);
		}
		$colIndex = '0';
		$rowIndex = '';
		$objPHPExcel = new PHPExcel ();
		$sheet = $objPHPExcel->getActiveSheet ();
		/* Set cac gia tri tinh*/
		$sheet->setCellValue('A1', $this->TblThongtincoquanbyId[0]['Tencoquan']);
		$sheet->mergeCellsByColumnAndRow(0, 1, 3, 1);
		$helpExport->setStyle_13_TNR_B_L($sheet, 'A1', 'A1');
		$sheet->setCellValue('A3', 'DANH SÁCH TÀI LIỆU CHUYÊN MÔN');
		$sheet->mergeCellsByColumnAndRow(0, 3, 7, 3);
		$helpExport->setStyle_15_TNR_B_C($sheet, 'A3', 'A3');
		
		$rowStart = 5;
		$colStart = 'A';
		$rowIndex = $rowStart;
		$colIndex = $colStart;
		$sheet = $objPHPExcel->getActiveSheet ();
		// BEGIN set width for column
		$sheet->getColumnDimension ( 'A' )->setWidth ( 5 );
		$sheet->getColumnDimension ( 'B' )->setWidth ( 15 );
		$sheet->getColumnDimension ( 'C' )->setWidth ( 10 );
		$sheet->getColumnDimension ( 'D' )->setWidth ( 12.14 );
		$sheet->getColumnDimension ( 'E' )->setWidth ( 8 );
		$sheet->getColumnDimension ( 'F' )->setWidth ( 17.71 );
		$sheet->getColumnDimension ( 'G' )->setWidth ( 14.14 );
		$sheet->getColumnDimension ( 'H' )->setWidth ( 14.14 );
		
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'STT', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Tên tài liệu', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Đơn vị tính', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Ngày cấp', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Số lượng', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Đơn vị cấp', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Nhà xuất bản', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Ghi chú', $colIndex );
		$helpExport->setStyle_11_TNR_B_C ( $sheet, $colStart . $rowIndex, $colIndex . ($rowIndex + 1) );
		
		$jsonObj = $this->_MTailieu->getds($sTentailieu, $sNgaycap, $sDonvicap, $sNhaxuatban, $this->_ThongtincoquanId, $this->_Namhoatdong);
		if(count($jsonObj) > 0){
			$stt = 0;
			foreach ($jsonObj as $row){
				$stt ++;
				$rowIndex += 1;
				$colIndex = $colStart;
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $stt, $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Tentailieu'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Donvitinh'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Ngaycap'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Soluong'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Donvicap'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Nhaxuatban'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Ghichu'], $colIndex );
				$helpExport->setStyle_11_TNR_N_L ( $sheet, $colStart . $rowIndex, $colIndex . $rowIndex );
				$helpExport->setStyle_Align_Center ( $sheet, 'A' . $rowIndex, 'A' . $rowIndex );
				$helpExport->setStyle_Align_Center ( $sheet, 'C' . $rowIndex, 'D' . $rowIndex );
				$helpExport->setStyle_Align_Right ( $sheet, 'E' . $rowIndex, 'E' . $rowIndex );
			}
		}
		
		$sheet->getStyle ( 'A' . $rowStart . ':' . 'H' . $rowIndex )->getBorders ()->getOutline ()->setBorderStyle ( PHPExcel_Style_Border::BORDER_THIN );
		$sheet->getStyle ( 'A' . $rowStart . ':' . 'H' . $rowIndex )->getBorders ()->getInside ()->setBorderStyle ( PHPExcel_Style_Border::BORDER_THIN );
		
		$objPHPExcel->getActiveSheet ()->getPageSetup ()->setOrientation ( PHPExcel_Worksheet_PageSetup::ORIENTATION_PORTRAIT );
		$objPHPExcel->getActiveSheet ()->getPageSetup ()->setPaperSize ( PHPExcel_Worksheet_PageSetup::PAPERSIZE_A4 );
		$pageMargin = $sheet->getPageMargins ();
		$pageMargin->setTop ( .5 );
		$pageMargin->setLeft ( .3 );
		$pageMargin->setRight ( .2 );
		$f = 'example.html';
		$objWriter = PHPExcel_IOFactory::createWriter ( $objPHPExcel, 'HTML' );
		$objWriter->save ( 'public/media/temp/' . $f );
		echo file_get_contents ( 'public/media/temp/' . $f );
	}
	
	/**
	 * Phadh
	 * Tao file xem truoc bao cao
	 * Danh sach giam sat ve sinh an toan thuc pham co so kinh doanh
	 */
	public function printviewgiamsatAction(){
		$this->_helper->layout ()->disableLayout ();
		$helpExport = new HelpFuncExportExcel ();
		$objReader = PHPExcel_IOFactory::createReader ( "Excel5" );
		$sTencoso = $this->_getParam('sTencoso');
		$sLoaihinhKD = $this->_getParam('sLoaihinhKD');
		$sKetqua = $this->_getParam('sKetqua');
		$sNgaykiemtra = $this->_getParam('sNgaykiemtra');
		if($sNgaykiemtra != ''){
			$sNgaykiemtra = $this->convertDateSearch($sNgaykiemtra);
		}
		$colIndex = '0';
		$rowIndex = '';
		$objPHPExcel = new PHPExcel ();
		$sheet = $objPHPExcel->getActiveSheet ();
		/* Set cac gia tri tinh*/
		$sheet->setCellValue('A1', $this->TblThongtincoquanbyId[0]['Tencoquan']);
		$sheet->mergeCellsByColumnAndRow(0, 1, 3, 1);
		$helpExport->setStyle_13_TNR_B_L($sheet, 'A1', 'A1');
		$sheet->setCellValue('A3', 'DANH SÁCH GIÁM SÁT VỆ SINH AN TOÀN THỰC PHẨM CÁC CƠ SỞ KINH DOANH THỰC PHẨM');
		$sheet->mergeCellsByColumnAndRow(0, 3, 10, 3);
		$helpExport->setStyle_14_TNR_B_C($sheet, 'A3', 'A3');
		
		$rowStart = 5;
		$colStart = 'A';
		$rowIndex = $rowStart;
		$colIndex = $colStart;
		$sheet = $objPHPExcel->getActiveSheet ();
		// BEGIN set width for column
		$sheet->getColumnDimension ( 'A' )->setWidth ( 5 );
		$sheet->getColumnDimension ( 'B' )->setWidth ( 15 );
		$sheet->getColumnDimension ( 'C' )->setWidth ( 15 );
		$sheet->getColumnDimension ( 'D' )->setWidth ( 15 );
		$sheet->getColumnDimension ( 'E' )->setWidth ( 12 );
		$sheet->getColumnDimension ( 'F' )->setWidth ( 17.71 );
		$sheet->getColumnDimension ( 'G' )->setWidth ( 14.14 );
		$sheet->getColumnDimension ( 'H' )->setWidth ( 6.68 );
		$sheet->getColumnDimension ( 'I' )->setWidth ( 14.14 );
		$sheet->getColumnDimension ( 'J' )->setWidth ( 14.14 );
		$sheet->getColumnDimension ( 'K' )->setWidth ( 14.14 );
		
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'STT', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Tên cơ sở', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Địa chỉ', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Chủ sở hữu', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Loại hình KD', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Kết quả', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Ngày kiểm tra', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Phạt', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Số tiền', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Người phạt', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Ghi chú', $colIndex );
		$helpExport->setStyle_11_TNR_B_C ( $sheet, $colStart . $rowIndex, $colIndex . ($rowIndex + 1) );
		
		$jsonObj = $this->_MGiamsat->getds($sTencoso, $sLoaihinhKD, $sKetqua, $sNgaykiemtra, $this->_ThongtincoquanId, $this->_Namhoatdong);
		if(count($jsonObj) > 0){
			$stt = 0;
			foreach ($jsonObj as $row){
				$stt ++;
				$rowIndex += 1;
				$colIndex = $colStart;
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $stt, $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Tencoso'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Diachi'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Chusohuu'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Loaihinhkinhdoanh'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Ketqua'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Ngaykiemtra'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Phattien'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, number_format($row ['Sotienphat'], "0", ",", ","), $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Nguoiphat'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Ghichu'], $colIndex );
				$helpExport->setStyle_11_TNR_N_L ( $sheet, $colStart . $rowIndex, $colIndex . $rowIndex );
				$helpExport->setStyle_Align_Center ( $sheet, 'A' . $rowIndex, 'A' . $rowIndex );
				$helpExport->setStyle_Align_Center ( $sheet, 'G' . $rowIndex, 'H' . $rowIndex );
				$helpExport->setStyle_Align_Right ( $sheet, 'I' . $rowIndex, 'I' . $rowIndex );
			}
		}
		
		$sheet->getStyle ( 'A' . $rowStart . ':' . 'K' . $rowIndex )->getBorders ()->getOutline ()->setBorderStyle ( PHPExcel_Style_Border::BORDER_THIN );
		$sheet->getStyle ( 'A' . $rowStart . ':' . 'K' . $rowIndex )->getBorders ()->getInside ()->setBorderStyle ( PHPExcel_Style_Border::BORDER_THIN );
		
		$objPHPExcel->getActiveSheet ()->getPageSetup ()->setOrientation ( PHPExcel_Worksheet_PageSetup::ORIENTATION_LANDSCAPE );
		$objPHPExcel->getActiveSheet ()->getPageSetup ()->setPaperSize ( PHPExcel_Worksheet_PageSetup::PAPERSIZE_A4 );
		$pageMargin = $sheet->getPageMargins ();
		$pageMargin->setTop ( .5 );
		$pageMargin->setLeft ( .2 );
		$pageMargin->setRight ( .2 );
		$f = 'example.html';
		$objWriter = PHPExcel_IOFactory::createWriter ( $objPHPExcel, 'HTML' );
		$objWriter->save ( 'public/media/temp/' . $f );
		echo file_get_contents ( 'public/media/temp/' . $f );
	}
	
	/**
	 * Phadh
	 * Tao file xem truoc bao cao
	 * Danh sach cong viec truyen thong giao duc suc khoe
	 */
	public function printviewtruyenthongAction(){
		$this->_helper->layout ()->disableLayout ();
		$helpExport = new HelpFuncExportExcel ();
		$objReader = PHPExcel_IOFactory::createReader ( "Excel5" );
		$sNoidung = $this->_getParam('sNoidung');
		$sDiadiem = $this->_getParam('sDiadiem');
		$sNguoithuchien = $this->_getParam('sNguoithuchien');
		$sNgaybatdau = $this->_getParam('sNgaybatdau');
		$sNgayketthuc = $this->_getParam('sNgayketthuc');
		$sDang = $this->_getParam('sDang');
		if($sNgaybatdau != ''){
			$sNgaybatdau = $this->convertDateSearch($sNgaybatdau);
		}
		if($sNgayketthuc != ''){
			$sNgayketthuc = $this->convertDateSearch($sNgayketthuc);
		}
		$colIndex = '0';
		$rowIndex = '';
		$objPHPExcel = new PHPExcel ();
		$sheet = $objPHPExcel->getActiveSheet ();
		/* Set cac gia tri tinh*/
		$sheet->setCellValue('A1', $this->TblThongtincoquanbyId[0]['Tencoquan']);
		$sheet->mergeCellsByColumnAndRow(0, 1, 3, 1);
		$helpExport->setStyle_13_TNR_B_L($sheet, 'A1', 'A1');
		$sheet->setCellValue('A3', 'TRUYỀN THÔNG GIÁO DỤC SỨA KHỎE');
		$sheet->mergeCellsByColumnAndRow(0, 3, 10, 3);
		$helpExport->setStyle_15_TNR_B_C($sheet, 'A3', 'A3');
		
		$rowStart = 5;
		$colStart = 'A';
		$rowIndex = $rowStart;
		$colIndex = $colStart;
		$sheet = $objPHPExcel->getActiveSheet ();
		// BEGIN set width for column
		$sheet->getColumnDimension ( 'A' )->setWidth ( 5 );
		$sheet->getColumnDimension ( 'B' )->setWidth ( 15 );
		$sheet->getColumnDimension ( 'C' )->setWidth ( 15 );
		$sheet->getColumnDimension ( 'D' )->setWidth ( 15 );
		$sheet->getColumnDimension ( 'E' )->setWidth ( 12 );
		$sheet->getColumnDimension ( 'F' )->setWidth ( 10.14 );
		$sheet->getColumnDimension ( 'G' )->setWidth ( 14.14 );
		$sheet->getColumnDimension ( 'H' )->setWidth ( 14.14 );
		$sheet->getColumnDimension ( 'I' )->setWidth ( 14.14 );
		$sheet->getColumnDimension ( 'J' )->setWidth ( 14.14 );
		$sheet->getColumnDimension ( 'K' )->setWidth ( 14.14 );
		
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'STT', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Nội dung', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Đối tượng', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Số người tham dự', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Thời lượng', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Số lần thực hiện', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Địa điểm', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Ngày bắt đầu', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Ngày kết thúc', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Người thực hiện', $colIndex );
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Dạng', $colIndex );
		$helpExport->setStyle_11_TNR_B_C ( $sheet, $colStart . $rowIndex, $colIndex . ($rowIndex + 1) );
		
		$jsonObj = $this->_MTruyenthong->getds($sNoidung, $sDiadiem, $sNguoithuchien, $sNgaybatdau, $sNgayketthuc, $sDang, $this->_ThongtincoquanId, $this->_Namhoatdong);
		if(count($jsonObj) > 0){
			$stt = 0;
			foreach ($jsonObj as $row){
				$stt ++;
				$rowIndex += 1;
				$colIndex = $colStart;
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $stt, $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Noidung'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Doituong'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Uoctinh_soluongthamdu'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Thoiluong'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Solanthuchien'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Diadiem'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Ngaybatdau'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Ngayketthuc'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Nguoithuchien'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row ['Dang_tg'], $colIndex );
				$helpExport->setStyle_11_TNR_N_L ( $sheet, $colStart . $rowIndex, $colIndex . $rowIndex );
				$helpExport->setStyle_Align_Center ( $sheet, 'A' . $rowIndex, 'A' . $rowIndex );
				$helpExport->setStyle_Align_Center ( $sheet, 'H' . $rowIndex, 'I' . $rowIndex );
				$helpExport->setStyle_Align_Right ( $sheet, 'D' . $rowIndex, 'F' . $rowIndex );
			}
		}
		
		$sheet->getStyle ( 'A' . $rowStart . ':' . 'K' . $rowIndex )->getBorders ()->getOutline ()->setBorderStyle ( PHPExcel_Style_Border::BORDER_THIN );
		$sheet->getStyle ( 'A' . $rowStart . ':' . 'K' . $rowIndex )->getBorders ()->getInside ()->setBorderStyle ( PHPExcel_Style_Border::BORDER_THIN );
		
		$objPHPExcel->getActiveSheet ()->getPageSetup ()->setOrientation ( PHPExcel_Worksheet_PageSetup::ORIENTATION_LANDSCAPE );
		$objPHPExcel->getActiveSheet ()->getPageSetup ()->setPaperSize ( PHPExcel_Worksheet_PageSetup::PAPERSIZE_A4 );
		$pageMargin = $sheet->getPageMargins ();
		$pageMargin->setTop ( .5 );
		$pageMargin->setLeft ( .2 );
		$pageMargin->setRight ( .2 );
		$f = 'example.html';
		$objWriter = PHPExcel_IOFactory::createWriter ( $objPHPExcel, 'HTML' );
		$objWriter->save ( 'public/media/temp/' . $f );
		echo file_get_contents ( 'public/media/temp/' . $f );
	}
	public function printviewdschantaymiengAction()
	{
		$this->_helper->layout ()->disableLayout ();
		$helpExport = new HelpFuncExportExcel ();
		$objReader = PHPExcel_IOFactory::createReader ( "Excel5" );
		$sgioitinh = $this->_getParam ( 'sGioitinh' );
		$sthonto = $this->_getParam ( 'sThonto' );
		$sloaicabenh=$this->_getParam('sLoaicabenh');
		$snguoibenh = $this->_getParam ( 'sTnb' );
		$snguoikham = $this->_getParam ( 'sNs' );
		$sngaynhapvien = $this->_getParam ( 'sNgaynhapvien' );
	
		if ($sngaynhapvien != '') {
			$sngaynhapvien = $this->convertDateSearch ( $sngaynhapvien );
		}
		$colIndex = '';
		$rowIndex = 0;
	
		$objPHPExcel = new PHPExcel ();
		$sheet = $objPHPExcel->getActiveSheet ();
		/*
		 * Bắt đầu set các giá trị, căn chỉnh style Bắt đầu set các giá trị
		* tĩnh.
		*/
		$sheet->setCellValue ( 'A1', $this->TblThongtincoquanbyId [0] ['Tencoquan'] );
		$sheet->mergeCellsByColumnAndRow ( 0, 1, 4, 1 );
		$helpExport->setStyle_13_TNR_B_L ( $sheet, 'A1', 'A1' );
		$sheet->setCellValue ( 'F1', 'Mẫu số 2 ban hành kèm theo Quyết định số 581/QĐ-BYT ngày 24/02/2012 của Bộ Y tế' );
		$sheet->mergeCellsByColumnAndRow ( 5, 1, 17, 1 );
		$helpExport->setStyle_11_TNR_B_C ( $sheet, 'A1', 'A1' );
		$sheet->setCellValue ( 'B3','DANH SÁCH CÁC BỆNH NHÂN TAY CHÂN MIỆNG '. $this->TblThongtincoquanbyId [0] ['Namhoatdong'] );
		$sheet->mergeCellsByColumnAndRow ( 1, 3, 17, 3 );
		$helpExport->setStyleTitleDoc ( $sheet, 'B3', 'B3' );
	
		$rowStart = 4;
		$colStart = 'A';
		$rowIndex = $rowStart;
		$colIndex = $colStart;
		$sheet = $objPHPExcel->getActiveSheet ();
		// BEGIN set width for column
		$sheet->getColumnDimension ( 'A' )->setWidth ( 5 );
		$sheet->getColumnDimension ( 'B' )->setWidth ( 11 );
		$sheet->getColumnDimension ( 'C' )->setWidth ( 6.8 );
		$sheet->getColumnDimension ( 'D' )->setWidth ( 5.3 );
		$sheet->getColumnDimension ( 'E' )->setWidth ( 5 );
		$sheet->getColumnDimension ( 'F' )->setWidth ( 7 );
		$sheet->getColumnDimension ( 'G' )->setWidth ( 8 );
		$sheet->getColumnDimension ( 'H' )->setWidth ( 7.71 );
		$sheet->getColumnDimension ( 'I' )->setWidth ( 7.14 );
		$sheet->getColumnDimension ( 'J' )->setWidth ( 7.86 );
		$sheet->getColumnDimension ( 'K' )->setWidth ( 7.29 );
		$sheet->getColumnDimension ( 'L' )->setWidth ( 10.57 );
		$sheet->getColumnDimension ( 'M' )->setWidth ( 5.71 );
		$sheet->getColumnDimension ( 'N' )->setWidth ( 8 );
		$sheet->getColumnDimension ( 'O' )->setWidth ( 7.3 );
		$sheet->getColumnDimension ( 'P' )->setWidth ( 8 );
		$sheet->getColumnDimension ( 'Q' )->setWidth ( 7.14 );
		$sheet->getColumnDimension ( 'R' )->setWidth ( 7.3 );
	
		// END set width for column
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'STT', $colIndex );
		$sheet->mergeCellsByColumnAndRow(0, $rowIndex, 0, ($rowIndex + 1));
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Họ và tên bệnh nhân', $colIndex );
		$sheet->mergeCellsByColumnAndRow(1, $rowIndex, 1, ($rowIndex + 1));
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Tuổi', 'D' );
		$sheet->mergeCellsByColumnAndRow(2, $rowIndex, 3, ($rowIndex ));
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Giới tính', $colIndex );
		$sheet->mergeCellsByColumnAndRow(4, $rowIndex, 4, ($rowIndex + 1));
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Địa chỉ nơi khởi phát', 'I' );
		$sheet->mergeCellsByColumnAndRow(5, $rowIndex, 8, ($rowIndex ));
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Ngày khởi phát', $colIndex );
		$sheet->mergeCellsByColumnAndRow(9, $rowIndex, 9, ($rowIndex + 1));
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Ngày nhập viện', $colIndex );
		$sheet->mergeCellsByColumnAndRow(10, $rowIndex, 10, $rowIndex+1);
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Nơi điều trị (Tại nhà hoặc tên CSYT)', $colIndex );
		$sheet->mergeCellsByColumnAndRow(11, $rowIndex, 11, ($rowIndex + 1));
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Phân độ LS (b)', $colIndex );
		$sheet->mergeCellsByColumnAndRow(12, $rowIndex, 12, ($rowIndex + 1));
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Có đi học (c)', $colIndex );
		$sheet->mergeCellsByColumnAndRow(13, $rowIndex, 13, ($rowIndex + 1));
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Loại ca bệnh (d)', $colIndex );
		$sheet->mergeCellsByColumnAndRow(14, $rowIndex, 14, ($rowIndex + 1));
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Lấy mẫu và KQXN (e)', $colIndex );
		$sheet->mergeCellsByColumnAndRow(15, $rowIndex, 15, ($rowIndex + 1));
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Ngày ra viện/ Tử vong', $colIndex );
		$sheet->mergeCellsByColumnAndRow(16, $rowIndex, 16, ($rowIndex + 1));
		$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, 'Kết quả điều trị (f)', $colIndex );
		$sheet->mergeCellsByColumnAndRow(17, $rowIndex, 17, ($rowIndex + 1));
		$helpExport->setStyle_11_TNR_B_C ( $sheet, $colStart . $rowIndex, $colIndex . ($rowIndex + 1) );
		$sheet->getRowDimension('5')->setRowHeight(60);
		$sheet->setCellValue('C5', 'Tháng');
		$sheet->setCellValue('D5', 'Năm');
		$sheet->setCellValue('F5', 'Số nhà/ đường');
		$sheet->setCellValue('G5', 'Xã/ Phường');
		$sheet->setCellValue('H5', 'Huyện/ Quận');
		$sheet->setCellValue('I5', 'Tỉnh/ Thành phố');
		$helpExport->setStyle_11_TNR_B_C($sheet, 'C5', 'D5');
		$helpExport->setStyle_11_TNR_B_C($sheet, 'F5', 'I5');
		// Lấy dữ liệu
		$jsonObj = $this->_MChantaymieng->printviewdschantaymieng($this->TblTinhbytramId[0]['Tentinh'],$this->TblTinhbytramId[0]['Tenhuyen'],$this->TblTinhbytramId[0]['Tenxa'],$this->TblThongtincoquanbyId [0] ['Id'], $this->TblThongtincoquanbyId [0] ['Namhoatdong']);
		$rowIndex+=1;
		if (count ( $jsonObj ) > 0) {
			$stt=0;
			// $tempIndex = $rowIndex + 1;
			foreach ( $jsonObj as $row ) {
				$rowIndex += 1;
				$stt ++;
				$colIndex = $colStart;
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $stt, $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row['Nhankhau'], $colIndex );
				if($row['Thang']==NULL)
				{
					$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, '', $colIndex );
				}
				else
				{
					$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row['Thang'], $colIndex );
				}
				if($row['Nam']==NULL)
				{
					$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, '', $colIndex );
				}
				else
				{
					$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row['Nam'], $colIndex );
				}
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row['Gioitinh'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row['Diachi'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row['Xa'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row['Huyen'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row['Tinh'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row['Ngaykhoiphat'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row['Ngaynhapvien'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row['Noidieutri'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row['PhandoLS'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row['Codihoc'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row['Loaicabenh'], $colIndex );
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row['Laymauvakqxn'], $colIndex );
				if($row['Ngayravien']=="00/00/0000")
				{
					$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, '', $colIndex );
				}
				else
				{
					$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row['Ngayravien'], $colIndex );
				}
				$colIndex = $helpExport->setValueForSheet ( $sheet, $colIndex . $rowIndex, $row['Ketqua'], $colIndex );
	
				$helpExport->setStyle_11_TNR_N_L ( $sheet, $colStart . $rowIndex, $colIndex . $rowIndex );
				$helpExport->setStyle_Align_Center ( $sheet, 'A' . $rowIndex, 'A' . $rowIndex );
				$helpExport->setStyle_Align_Center ( $sheet, 'C' . $rowIndex, 'E' . $rowIndex );
				$helpExport->setStyle_Align_Center ( $sheet, 'M' . $rowIndex, 'M' . $rowIndex );
			}
		}
		$sheet->getStyle ( 'A' . $rowStart . ':' . 'R' . $rowIndex )->getBorders ()->getOutline ()->setBorderStyle ( PHPExcel_Style_Border::BORDER_THIN );
		$sheet->getStyle ( 'A' . $rowStart . ':' . 'R' . $rowIndex )->getBorders ()->getInside ()->setBorderStyle ( PHPExcel_Style_Border::BORDER_THIN );
		$objPHPExcel->getActiveSheet ()->setTitle ( 'Page 1' );
	
		$f = 'example.html';
		$objWriter = PHPExcel_IOFactory::createWriter ( $objPHPExcel, 'HTML' );
		$objWriter->save ( 'public/media/temp/' . $f );
		echo file_get_contents ( 'public/media/temp/' . $f );
	}
	public function printviewchitietchantaymiengAction()
	{
		$this->_helper->layout ()->disableLayout ();
		$helpExport = new HelpFuncExportExcel ();
		$maphieu = $this->_getParam ( 'Id' );
		$objReader = PHPExcel_IOFactory::createReader ( "Excel5" );
		$colIndex = '';
		$rowIndex = 0;
		$jsonObj = $this->_MChantaymieng->getCT($maphieu,$this->TblTinhbytramId[0]['Tentinh'],$this->TblTinhbytramId[0]['Tenhuyen'],$this->TblTinhbytramId[0]['Tenxa'], $this->_ThongtincoquanId, $this->_Namhoatdong );
		$objPHPExcel = new PHPExcel ();
		$objPHPExcel = $objReader->load ( "public/media/temp/chitietctm.xls" );
		$sheet = $objPHPExcel->getActiveSheet ();
		/*
		 * Bắt đầu set các giá trị, căn chỉnh style Bắt đầu set các giá trị
		* tĩnh.
		*/
		foreach ( $jsonObj as $row ) {
			$sheet->setCellValue ( "A" . "1", $this->TblThongtincoquanbyId [0] ['Tencoquan'] );
					$sheet->setCellValue ( "B" . "4", $jsonObj [0] ['Mahodan'] );
					$sheet->setCellValue ( "B" . "5", $jsonObj [0] ['Nhankhau'] );
					$sheet->setCellValue ( "B" . "6", $jsonObj [0] ['Diachi'].' - '.$jsonObj[0]['Xa'].' - '.$jsonObj[0]['Huyen'].' - '.$jsonObj[0]['Tinh'] );
					$sheet->setCellValue ( "B" . "7", $jsonObj [0] ['Codihoc'] );
					$sheet->setCellValue ( "G" . "7", $jsonObj [0] ['Gioitinh'] );
					$sheet->setCellValue ( "B" . "8", $jsonObj [0] ['Ngaykhoiphat'] );
					$sheet->setCellValue ( "G" . "8", $jsonObj [0] ['Ngaysinh'] );
					$sheet->setCellValue ( "B" . "9", $jsonObj [0] ['Ngaynhapvien'] );
					$sheet->setCellValue ( "G" . "9", $jsonObj [0] ['Loaicabenh'] );
					$sheet->setCellValue ( "B" . "10", $jsonObj [0] ['Noidieutri'] );
					$sheet->setCellValue ( "G" . "10", $jsonObj [0] ['PhandoLS'] );
					$sheet->setCellValue ( "B" . "11", $jsonObj [0] ['Laymauvakqxn'] );
					$sheet->setCellValue ( "B" . "12", $jsonObj [0] ['Hoten'] );
					if($row['Ngayravien']=="00/00/0000")
					{
						$sheet->setCellValue ( "B" . "13", '' );
					}
					else
					{
						$sheet->setCellValue ( "B" . "13", $jsonObj [0] ['Ngayravien'] );
					}
					$sheet->setCellValue ( "B" . "14", $jsonObj [0] ['Ketqua'] );
		}
		
		$f = 'example.html';
		$objWriter = PHPExcel_IOFactory::createWriter ( $objPHPExcel, 'HTML' );
		$objWriter->save ( 'public/media/temp/' . $f );
		echo file_get_contents ( 'public/media/temp/' . $f );
	}
}